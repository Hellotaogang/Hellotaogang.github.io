<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  
  <title>Flask项目之个性化微电影网站的实战开发（二） | TG&#39;S BLOG</title>
  
  
  <meta name="description" content="该篇文章是博主一字一码编写的，实属不易，请尊重原创，谢谢大家！">
  

  

  <meta name="HandheldFriendly" content="True">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <!-- meta -->
  

  <!-- link -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.css">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.10.1/css/all.min.css">
  

  
  <link rel="shortcut icon" type="image/x-icon" href="https://cdn.jsdelivr.net/gh/Hellotaogang/cdn@4.3/images/favicon.ico">
  

  
    <link rel="stylesheet" href="/style.css">
  

  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>

  
  
</head>

<body>
  
  
  <div class="cover-wrapper">
    <cover class='cover post half'>
      
        
  <img class='logo' src='https://cdn.jsdelivr.net/gh/Hellotaogang/cdn@4.5.6/images/logo_2.png'/>


  <div class="m_search">
    <form name="searchform" class="form u-search-form">
      <input type="text" class="input u-search-input" placeholder="" />
      <i class="icon fas fa-search fa-fw"></i>
    </form>
  </div>

<div class='menu navgation'>
  <ul class='h-list'>
    
      
        <li>
          <a class="nav home" href="/"
            
            
            id="home">
            <i class='fas fa-home fa-fw'></i>&nbsp;主页
          </a>
        </li>
      
        <li>
          <a class="nav home" href="/categories/"
            
            
            id="categories">
            <i class='fas fa-folder-open fa-fw'></i>&nbsp;分类
          </a>
        </li>
      
        <li>
          <a class="nav home" href="/tags/"
            
              rel="nofollow"
            
            
            id="tags">
            <i class='fas fa-tags fa-fw'></i>&nbsp;标签
          </a>
        </li>
      
        <li>
          <a class="nav home" href="/love/"
            
              rel="nofollow"
            
            
            id="love">
            <i class='fas fa-heart fa-fw'></i>&nbsp;记录
          </a>
        </li>
      
        <li>
          <a class="nav home" href="/about/"
            
              rel="nofollow"
            
            
            id="about">
            <i class='fas fa-info-circle fa-fw'></i>&nbsp;关于
          </a>
        </li>
      
    
  </ul>
</div>

      
    </cover>
    <header class="l_header pure">
  <div id="loading-bar-wrapper">
    <div id="loading-bar" class="pure"></div>
  </div>

	<div class='wrapper'>
		<div class="nav-main container container--flex">
      <a class="logo flat-box" href='/' >
        
          TG'S BLOG
        
      </a>
			<div class='menu navgation'>
				<ul class='h-list'>
          
  					
  						<li>
								<a class="nav flat-box" href="/"
                  
                  
                  id="home">
									<i class='fas fa-home fa-fw'></i>&nbsp;主页
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/categories/"
                  
                    rel="nofollow"
                  
                  
                  id="categories">
									<i class='fas fa-folder-open fa-fw'></i>&nbsp;分类
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/tags/"
                  
                    rel="nofollow"
                  
                  
                  id="tags">
									<i class='fas fa-tags fa-fw'></i>&nbsp;标签
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/archives/"
                  
                    rel="nofollow"
                  
                  
                  id="archives">
									<i class='fas fa-archive fa-fw'></i>&nbsp;归档
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/love/"
                  
                    rel="nofollow"
                  
                  
                  id="love">
									<i class='fas fa-heart fa-fw'></i>&nbsp;记录
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/about/"
                  
                    rel="nofollow"
                  
                  
                  id="about">
									<i class='fas fa-info-circle fa-fw'></i>&nbsp;关于
								</a>
							</li>
      			
      		
				</ul>
			</div>

			
				<div class="m_search">
					<form name="searchform" class="form u-search-form">
						<input type="text" class="input u-search-input" placeholder="搜索" />
						<i class="icon fas fa-search fa-fw"></i>
					</form>
				</div>
			
			<ul class='switcher h-list'>
				
					<li class='s-search'><a class="fas fa-search fa-fw" href='javascript:void(0)'></a></li>
				
				<li class='s-menu'><a class="fas fa-bars fa-fw" href='javascript:void(0)'></a></li>
			</ul>
		</div>

		<div class='nav-sub container container--flex'>
			<a class="logo flat-box"></a>
			<ul class='switcher h-list'>
				<li class='s-comment'><a class="flat-btn fas fa-comments fa-fw" href='javascript:void(0)'></a></li>
        
          <li class='s-toc'><a class="flat-btn fas fa-list fa-fw" href='javascript:void(0)'></a></li>
        
			</ul>
		</div>
	</div>
</header>
	<aside class="menu-phone">
    <header>
		<nav class="menu navgation">
      <ul>
        
          
            <li>
							<a class="nav flat-box" href="/"
                
                
                id="home">
								<i class='fas fa-clock fa-fw'></i>&nbsp;近期文章
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/blog/archives/"
                
                  rel="nofollow"
                
                
                id="blogarchives">
								<i class='fas fa-archive fa-fw'></i>&nbsp;文章归档
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/projects/"
                
                
                id="projects">
								<i class='fas fa-code-branch fa-fw'></i>&nbsp;开源项目
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/friends/"
                
                  rel="nofollow"
                
                
                id="friends">
								<i class='fas fa-link fa-fw'></i>&nbsp;我的友链
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="https://xaoxuu.com/wiki/material-x/"
                
                  rel="nofollow"
                
                
                id="https:xaoxuu.comwikimaterial-x">
								<i class='fas fa-book fa-fw'></i>&nbsp;主题文档
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/about/"
                
                  rel="nofollow"
                
                
                id="about">
								<i class='fas fa-info-circle fa-fw'></i>&nbsp;关于小站
							</a>
            </li>
          
       
      </ul>
		</nav>
    </header>
	</aside>
<script>setLoadingBarProgress(40);</script>

  </div>


  <div class="l_body">
    <div class='body-wrapper'>
      <div class='l_main'>
  

  <article id="post" class="post white-box article-type-post" itemscope itemprop="blogPost">
    


  <section class='meta'>
    
    
      <a title='Flask项目之个性化微电影网站的实战开发（二）' href='/2019/11/11/Flask项目之个性化微电影网站的实战开发（二）/'><img class='thumbnail' src='https://cdn.jsdelivr.net/gh/Hellotaogang/cdn@4.5.3/images/flask.png'></a>
    
    <div class="meta" id="header-meta">
      
        
  
    <h1 class="title">
      <a href="/2019/11/11/Flask项目之个性化微电影网站的实战开发（二）/">
        Flask项目之个性化微电影网站的实战开发（二）
      </a>
    </h1>
  


      
      <div class='new-meta-box'>
        
          
        
          
            
  <div class='new-meta-item author'>
    
      <a href="/" rel="nofollow">
        
          <img src="https://cdn.jsdelivr.net/gh/Hellotaogang/cdn@4.4.3/images/avatar_4.png">
        
        <p>cdtaogang</p>
      </a>
    
  </div>


          
        
          
            <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt" aria-hidden="true"></i>
    <p>2019-11-11</p>
  </a>
</div>

          
        
          
            
  
  <div class='new-meta-item category'>
    <a href='/categories/Flask开发/' rel="nofollow">
      <i class="fas fa-folder-open" aria-hidden="true"></i>
      <p>Flask开发</p>
    </a>
  </div>


          
        
          
            
  
    <div class="new-meta-item browse busuanzi">
      <a class='notlink'>
        <i class="fas fa-eye" aria-hidden="true"></i>
        <p>
          <span id="busuanzi_value_page_pv">
            <i class="fas fa-spinner fa-spin fa-fw" aria-hidden="true"></i>
          </span>
        </p>
      </a>
    </div>
  


          
        
          
            

          
        
      </div>
      
        <hr>
      
    </div>
  </section>


    <section class="article typo">
      <div class="article-entry" itemprop="articleBody">
        <p>该篇文章是博主一字一码编写的，实属不易，请尊重原创，谢谢大家！<br><font style="color:red">温馨提示：需要项目源码的朋友，请添加博主微信进行获取！</font></p>
<div style="color:#fb651b"><i class="fas fa-list fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;本文目录</div>
<li class="toc-item toc-level-1"><a style=" text-decoration:none;" href="#一丶搭建后台页面"><span style="color:#4ea1db">一丶搭建后台页面</span></a></li>
<li class="toc-item toc-level-1"><a style=" text-decoration:none;" href="#二丶后台管理（管理员登录及退出）"><span style="color:#4ea1db">二丶后台管理（管理员登录及退出）</span></a></li>
<li class="toc-item toc-level-1"><a style=" text-decoration:none;" href="#三丶后台管理（标签管理）"><span style="color:#4ea1db">三丶后台管理（标签管理）</span></a></li>
<li class="toc-item toc-level-1"><a style=" text-decoration:none;" href="#四丶后台管理（电影管理）"><span style="color:#4ea1db">四丶后台管理（电影管理）</span></a></li>
<li class="toc-item toc-level-1"><a style=" text-decoration:none;" href="#五丶后台管理（预告管理）"><span style="color:#4ea1db">五丶后台管理（预告管理）</span></a></li>
<a id="more"></a>

<h1 id="一丶搭建后台页面"><a href="#一丶搭建后台页面" class="headerlink" title="一丶搭建后台页面"></a>一丶搭建后台页面</h1><p><strong>1.</strong>管理员登录和退出页面搭建</p>
<ul>
<li>在admin/views中定义视图函数</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 登录</span></span><br><span class="line"><span class="meta">@admin.route('/login/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"admin/login.html"</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 登出</span></span><br><span class="line"><span class="meta">@admin.route('/logout/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logout</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">'admin.login'</span>))</span><br></pre></td></tr></table></figure>

<ul>
<li>复制static/tpl/3-admin目录下的login.html模板文件到templates/admin目录下，并修改模板中使用的静态资源路径</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"shortcut icon"</span> <span class="attr">href</span>=<span class="string">"&#123;&#123; url_for('static',filename='base/images/logo.png')&#125;&#125;"</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>测试管理员登录与登出</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190416221728850.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<p><strong>2.</strong>管理员页面搭建（后台主页）</p>
<ul>
<li>定义视图函数</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@admin.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"admin/index.html"</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>复制static/tpl/3-admin目录下的admin.html模板文件到templates/admin目录下，修改静态资源地址以及定义数据块（三处）</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190416225108229.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<ul>
<li>在templates/admin目录下创建grid.html模板，将admin.html模板中管理菜单标签内容剪贴到grid.html模板文件中（复用比较多的内容），并在admin.html模板中将grid.html模板包含进来</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% include "admin/grid.html"%&#125;</span><br></pre></td></tr></table></figure>

<p>-在templates/admin目录下创建index.html模板文件，继承与admin.html，并填写数据块content内容，用于显示后台管理页面</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends "admin/admin.html"%&#125;</span><br><span class="line">&#123;% block content%&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>hello admin<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>测试显示后台管理页面</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/2019041622595242.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<p><strong>3.</strong>修改密码丶控制面板丶标签管理页面搭建</p>
<p><strong>修改密码</strong></p>
<ul>
<li>定义视图函数</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@admin.route('/pwd/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pwd</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"admin/pwd.html"</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>定义模板文件</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190416234005727.png" alt></p>
<ul>
<li>测试显示修改密码页面</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190416234036110.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<p><strong>控制面板（也就是后台主页面index.html）</strong></p>
<ul>
<li>定义模板文件</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190416235120898.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<ul>
<li>定义控制面板按钮激活active，编辑grid.html管理菜单模块，给li块添加id属性</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"treeview"</span> <span class="attr">id</span>=<span class="string">"g-1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-home"</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"label label-primary pull-right"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"treeview-menu"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">id</span>=<span class="string">"g-1-1"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;&#123;url_for('admin.index')&#125;&#125;"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-circle-o"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 控制面板</span><br><span class="line">            <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>在admin/index.html模板下方添加js代码</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    $(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        $(<span class="string">'#g-1'</span>).addClass(<span class="string">'active'</span>)</span><br><span class="line">        $(<span class="string">'#g-1-1'</span>).addClass(<span class="string">'active'</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>测试控制面板页面（主页面内容）</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/2019041700074259.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<p><strong>标签管理</strong>（添加标签以及标签列表）</p>
<ul>
<li>定义视图函数</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 添加标签</span><br><span class="line">@admin.route(<span class="string">'/tag/add'</span>)</span><br><span class="line">def tag_add():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"admin/tag_add.html"</span>)</span><br><span class="line"> </span><br><span class="line"># 标签列表</span><br><span class="line">@admin.route(<span class="string">'/tag/list'</span>)</span><br><span class="line">def tag_list():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"admin/tag_list.html"</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>修改grid.html模板中的地址以及添加li块的id属性</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190417003220643.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<ul>
<li>定义模板文件（tag_add.html以及tag_list.html）</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190417003038381.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<p><img src="https://img-blog.csdnimg.cn/20190417003310545.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<ul>
<li>测试标签管理页面</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190417003759390.gif" alt></fancybox></p>
<p><strong>4.</strong>电影管理以及预告管理页面搭建</p>
<p><strong>电影管理</strong>（添加电影以及电影列表）</p>
<ul>
<li>定义视图函数</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加电影</span></span><br><span class="line"><span class="meta">@admin.route('/movie/add')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">movie_add</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"admin/movie_add.html"</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 电影列表</span></span><br><span class="line"><span class="meta">@admin.route('/movie/list')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">movie_list</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"admin/movie_list.html"</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>修改grid.html模板中的地址以及添加li块的id属性</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190417005948142.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<ul>
<li>定义模板文件（movie_add.html以及movie_list.html）</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190417005754109.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<p><img src="https://img-blog.csdnimg.cn/20190417005842412.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<ul>
<li>测试电影管理页面</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190417010609275.gif" alt><fancybox></fancybox></fancybox></p>
<p><strong>预告管理</strong>（添加预告以及预告列表）</p>
<ul>
<li>定义视图函数</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加预告</span></span><br><span class="line"><span class="meta">@admin.route('/preview/add')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">preview_add</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"admin/preview_add.html"</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 预告列表</span></span><br><span class="line"><span class="meta">@admin.route('/preview/list')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">preview_list</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"admin/preview_list.html"</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>修改grid.html模板中的地址以及添加li块的id属性</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190417011839738.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<ul>
<li>定义模板文件（preview_add.html以及preview_list.html）</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190417011920617.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<p><img src="https://img-blog.csdnimg.cn/20190417011956857.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<ul>
<li>测试预告管理页面</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190417012258565.gif" alt></fancybox></p>
<p><strong>5.</strong>会员管理丶评论管理以及收藏管理页面搭建</p>
<p><strong>会员管理</strong>（会员列表以及会员信息）</p>
<ul>
<li>定义视图函数</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 会员列表</span></span><br><span class="line"><span class="meta">@admin.route('/user/list')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_list</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"admin/user_list.html"</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 会员信息</span></span><br><span class="line"><span class="meta">@admin.route('/user/view')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_view</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"admin/user_view.html"</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>修改grid.html模板中的地址以及添加li块的id属性</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190417103837731.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<ul>
<li>定义模板文件（user_list.html以及user_view.html）</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190417103917340.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<p><img src="https://img-blog.csdnimg.cn/20190417103950140.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<ul>
<li>测试会员管理页面</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190417110841984.gif" alt></fancybox></p>
<p><strong>评论管理</strong></p>
<ul>
<li>定义视图函数</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 评论管理</span></span><br><span class="line"><span class="meta">@admin.route('/comment/list')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">comment_list</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"admin/comment_list.html"</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>修改grid.html模板中的地址以及添加li块的id属性</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190417111217878.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<ul>
<li>定义模板文件（comment_list.html）</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190417111248430.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<ul>
<li>测试评论管理页面</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190417111114878.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<p><strong>收藏管理</strong></p>
<ul>
<li>定义视图函数</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 收藏管理</span></span><br><span class="line"><span class="meta">@admin.route('/moviecol/list')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">moviecol_list</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"admin/moviecol_list.html"</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>修改grid.html模板中的地址以及添加li块的id属性</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/2019041711203160.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<ul>
<li>定义模板文件（moviecol_list.html）</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190417112108140.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<ul>
<li>测试收藏管理页面</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190417112202345.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<p><strong>6.</strong>日志管理丶权限管理丶角色管理页面搭建</p>
<p><strong>日志管理</strong>（操作日志列表和管理员登录日志列表以及会员登录日志列表）</p>
<ul>
<li>定义视图函数</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 操作日志列表</span></span><br><span class="line"><span class="meta">@admin.route('/oplog/list')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">oplog_list</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"admin/oplog_list.html"</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 管理员登录日志列表</span></span><br><span class="line"><span class="meta">@admin.route('/adminloginlog/list')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">adminloginlog_list</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"admin/adminloginlog_list.html"</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 会员登录日志列表</span></span><br><span class="line"><span class="meta">@admin.route('/userloginlog/list')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">userloginlog_list</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"admin/userloginlog_list.html"</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>修改grid.html模板中的地址以及添加li块的id属性</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190417121146239.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<ul>
<li>定义模板文件（oplog_list.html和adminloginlog_list.html以及userloginlog_list.html）</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190417121314395.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<p><img src="https://img-blog.csdnimg.cn/20190417121324758.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<p><img src="https://img-blog.csdnimg.cn/20190417121338869.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<ul>
<li>测试日志管理页面</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/201904171215599.gif" alt></fancybox></p>
<p><strong>权限管理</strong>（添加权限以及权限列表）</p>
<ul>
<li>定义视图函数</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加权限</span></span><br><span class="line"><span class="meta">@admin.route('/auth/add')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">auth_add</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"admin/auth_add.html"</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 权限列表</span></span><br><span class="line"><span class="meta">@admin.route('/auth/list')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">auth_list</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"admin/auth_list.html"</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>修改grid.html模板中的地址以及添加li块的id属性</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190417122901695.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<ul>
<li>定义模板文件（auth_add.html以及auth_list.html）</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190417122949325.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<p><img src="https://img-blog.csdnimg.cn/2019041712295959.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<ul>
<li>测试权限管理页面</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190417123437443.gif" alt></fancybox></p>
<p><strong>角色管理</strong>（添加角色以及角色列表）</p>
<ul>
<li>定义视图函数</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加角色</span></span><br><span class="line"><span class="meta">@admin.route('/role/add')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">role_add</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"admin/role_add.html"</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 角色列表</span></span><br><span class="line"><span class="meta">@admin.route('/role/list')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">role_list</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"admin/role_list.html"</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>修改grid.html模板中的地址以及添加li块的id属性</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190417124553164.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<ul>
<li>定义模板文件（auth_add.html以及auth_list.html）</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190417124508852.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<p><img src="https://img-blog.csdnimg.cn/20190417124522683.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<ul>
<li>测试角色管理页面</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190417131316320.gif" alt></fancybox></p>
<p><strong>7.</strong>管理员管理页面搭建（添加管理员以及管理员列表）</p>
<ul>
<li>定义视图函数</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加管理员</span></span><br><span class="line"><span class="meta">@admin.route('/admin/add')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">admin_add</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"admin/admin_add.html"</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 管理员列表</span></span><br><span class="line"><span class="meta">@admin.route('/admin/list')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">admin_list</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"admin/admin_list.html"</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>修改grid.html模板中的地址以及添加li块的id属性</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190417132406493.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<ul>
<li>定义模板文件（admin_add.html以及admin_list.html）</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190417132452311.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<p><img src="https://img-blog.csdnimg.cn/20190417132513752.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<ul>
<li>测试管理员管理页面</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190417132814681.gif" alt></fancybox></p>
<h1 id="二丶后台管理（管理员登录及退出）"><a href="#二丶后台管理（管理员登录及退出）" class="headerlink" title="二丶后台管理（管理员登录及退出）"></a>二丶后台管理（管理员登录及退出）</h1><p><strong>1.</strong>管理员登录</p>
<ul>
<li>代码优化，将models模块中的导入数据库连接配置放在<strong>init</strong>初始化文件中，在models模块中只需要导入db对象即可</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190417142627588.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<ul>
<li>在admin/forms.py文件中创建管理员登录表单</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginForm</span><span class="params">(FlaskForm)</span>:</span></span><br><span class="line">    <span class="string">"""管理员登录表单"""</span></span><br><span class="line">    account = StringField(</span><br><span class="line">        label=<span class="string">"账号"</span>,</span><br><span class="line">        validators=[</span><br><span class="line">            DataRequired(<span class="string">"请输入账号！"</span>)</span><br><span class="line">        ],</span><br><span class="line">        description=<span class="string">"账号"</span>,</span><br><span class="line">        render_kw=&#123;</span><br><span class="line">            <span class="string">"class"</span>: <span class="string">"form-control"</span>,</span><br><span class="line">            <span class="string">"placeholder"</span>: <span class="string">"请输入账号！"</span>,</span><br><span class="line">            <span class="string">"required"</span>: <span class="string">"required"</span></span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">    pwd = PasswordField(</span><br><span class="line">        label=<span class="string">"密码"</span>,</span><br><span class="line">        validators=[</span><br><span class="line">            DataRequired(<span class="string">"请输入密码！"</span>)</span><br><span class="line">        ],</span><br><span class="line">        description=<span class="string">"密码"</span>,</span><br><span class="line">        render_kw=&#123;</span><br><span class="line">            <span class="string">"class"</span>: <span class="string">"form-control"</span>,</span><br><span class="line">            <span class="string">"placeholder"</span>: <span class="string">"请输入密码！"</span>,</span><br><span class="line">            <span class="string">"required"</span>: <span class="string">"required"</span></span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">    submit = SubmitField(</span><br><span class="line">        <span class="string">'登录'</span>,</span><br><span class="line">        render_kw=&#123;</span><br><span class="line">            <span class="string">"class"</span>: <span class="string">"btn btn-primary btn-block btn-flat"</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<ul>
<li>在admin/views下的login视图中创建form对象，并传递给模板中</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@admin.route('/login/', methods=['GET', 'POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">()</span>:</span></span><br><span class="line">    form = LoginForm()</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"admin/login.html"</span>, form=form)</span><br></pre></td></tr></table></figure>

<ul>
<li>替换登录模板中表单数据账号密码以及提交所在的标签为LoginFrom类的account和pwd以及sublime实例属性；修改form表单提交方式为POST</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span>  <span class="attr">method</span>=<span class="string">"POST"</span> <span class="attr">id</span>=<span class="string">"form-data"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group has-feedback"</span>&gt;</span></span><br><span class="line">        &#123;&#123; form.account &#125;&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"glyphicon glyphicon-envelope form-control-feedback"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-md-12"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group has-feedback"</span>&gt;</span></span><br><span class="line">        &#123;&#123; form.pwd &#125;&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"glyphicon glyphicon-lock form-control-feedback"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-md-12"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-xs-8"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-xs-4"</span>&gt;</span></span><br><span class="line">            &#123;&#123; form.submit &#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>设置SECRET_KEY用户表单提交免受CSRF威胁，并在模板中填写{{ form.csrf_token }}</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.config[<span class="string">"SECRET_KEY"</span>] = <span class="string">'*#%cnusadq***cdtaogang8a9dwqn'</span></span><br></pre></td></tr></table></figure>

<ul>
<li>刷新页面成功显示登录页</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190417154519288.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<ul>
<li>在models/Admin模型类中定义check_pwd方法用于检查判断用户密码输入是否正确，正确则返回True否则返回False</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_pwd</span><span class="params">(self, pwd)</span>:</span></span><br><span class="line">    <span class="keyword">from</span> werkzeug.security <span class="keyword">import</span> check_password_hash</span><br><span class="line">    <span class="keyword">return</span> check_password_hash(self.pwd, pwd)</span><br></pre></td></tr></table></figure>

<ul>
<li>在视图函数中获取表单提交参数，通过调用Admin类中的check_pwd方法来判断用户输入的密码与数据库中模型类中密码是否一致，验证成功返回True可根据返回结果进行重定向到不同的地址，flash闪现显示错误提示信息 ，验证通过将用户对象信息保存在session会话中</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@admin.route('/login/', methods=['GET', 'POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">()</span>:</span></span><br><span class="line">    form = LoginForm()</span><br><span class="line">    <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">        data = form.data</span><br><span class="line">        admin =Admin.query.filter_by(name=data[<span class="string">'account'</span>]).first()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> admin.check_pwd(data[<span class="string">'pwd'</span>]):</span><br><span class="line">            flash(<span class="string">"密码错误！"</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">'admin.login'</span>))</span><br><span class="line">        session[<span class="string">'admin'</span>] = data[<span class="string">'account'</span>]</span><br><span class="line">        <span class="keyword">return</span> redirect(request.args.get(<span class="string">'next'</span>) <span class="keyword">or</span> url_for(<span class="string">'admin.index'</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"admin/login.html"</span>, form=form)</span><br></pre></td></tr></table></figure>

<ul>
<li>要在页面显示flash闪现信息，需要在模板文件中进行遍历显示</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for msg in get_flashed_messages() %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"login-box-msg"</span> <span class="attr">style</span>=<span class="string">"color:red;"</span>&gt;</span>&#123;&#123; msg &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>测试后台管理员登录</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190417160105529.gif" alt></fancybox></p>
<p><strong>2.</strong>管理员退出 </p>
<ul>
<li>在logout视图函数中删除session会话中的用户信息</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@admin.route('/logout/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logout</span><span class="params">()</span>:</span></span><br><span class="line">    session.pop(<span class="string">"admin"</span>, <span class="literal">None</span>)</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">'admin.login'</span>))</span><br></pre></td></tr></table></figure>

<ul>
<li>测试管理员退出</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190417161008917.gif" alt></fancybox></p>
<ul>
<li>在浏览器中直接访问<a href="http://127.0.0.1:5000/admin/" target="_blank" rel="noopener">http://127.0.0.1:5000/admin/</a>一样可以进入管理页面并且管理菜单的标签是可以进行查看的，所以需要定义装饰器来控制页面的访问</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 登录装饰器</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">admin_login_required</span><span class="params">(f)</span>:</span></span><br><span class="line"><span class="meta">    @wraps(f)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decorated_function</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">"admin"</span> <span class="keyword">not</span> <span class="keyword">in</span> session:</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">"admin.login"</span>, next=request.url))</span><br><span class="line">        <span class="keyword">return</span> f(*args, **kwargs)</span><br><span class="line">    <span class="keyword">return</span> decorated_function</span><br></pre></td></tr></table></figure>

<ul>
<li>后台管理页面中除了登录页都需要添加验证登录装饰器</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@admin.route('/')</span></span><br><span class="line"><span class="meta">@admin_login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"admin/index.html"</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>测试页面访问控制</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190417164011415.gif" alt></fancybox></p>
<h1 id="三丶后台管理（标签管理）"><a href="#三丶后台管理（标签管理）" class="headerlink" title="三丶后台管理（标签管理）"></a>三丶后台管理（标签管理）</h1><p><strong>1.</strong>添加标签</p>
<ul>
<li>在forms.py文件中定义添加标签表单类</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TagFrom</span><span class="params">(FlaskForm)</span>:</span></span><br><span class="line">    <span class="string">"""添加标签表单"""</span></span><br><span class="line">    name = StringField(</span><br><span class="line">        label=<span class="string">"名称"</span>,</span><br><span class="line">        validators=[</span><br><span class="line">            DataRequired(<span class="string">"请输入标签！"</span>)</span><br><span class="line">        ],</span><br><span class="line">        description=<span class="string">"标签"</span>,</span><br><span class="line">        render_kw=&#123;</span><br><span class="line">            <span class="string">"class"</span>: <span class="string">"form-control"</span>,</span><br><span class="line">            <span class="string">"id"</span>: <span class="string">"input_name"</span>,</span><br><span class="line">            <span class="string">"placeholder"</span>: <span class="string">"请输入标签名称！"</span></span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">    submit = SubmitField(</span><br><span class="line">        <span class="string">'提交'</span>,</span><br><span class="line">        render_kw=&#123;</span><br><span class="line">            <span class="string">"class"</span>: <span class="string">"btn btn-primary"</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<ul>
<li>在tag_add.html模板中替换表单中的name以及submit</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">role</span>=<span class="string">"form"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"box-body"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"input_name"</span>&gt;</span>&#123;&#123;form.name.label&#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            &#123;&#123;form.name&#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"box-footer"</span>&gt;</span></span><br><span class="line">        &#123;&#123;form.submit&#125;&#125;</span><br><span class="line">        &#123;&#123;form.csrf_token&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>在视图函数中向模板传递表单form对象 </li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加标签</span></span><br><span class="line"><span class="meta">@admin.route('/tag/add')</span></span><br><span class="line"><span class="meta">@admin_login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tag_add</span><span class="params">()</span>:</span></span><br><span class="line">    form = TagFrom()</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"admin/tag_add.html"</span>, form=form)</span><br></pre></td></tr></table></figure>

<ul>
<li>刷新页面添加标签页面显示正常</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190417172752487.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<ul>
<li>在视图函数tag_add中进行逻辑处理，根据管理员输入的标签名到数据库表中查询记录，记录不存在时，则保存到数据库中，并闪现成功消息，反之错误则提示用户失败信息，逻辑很简单</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加标签</span></span><br><span class="line"><span class="meta">@admin.route('/tag/add', methods=['GET', 'POST'])</span></span><br><span class="line"><span class="meta">@admin_login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tag_add</span><span class="params">()</span>:</span></span><br><span class="line">    form = TagFrom()</span><br><span class="line">    <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">        data = form.data</span><br><span class="line">        tag = Tag.query.filter_by(name=data[<span class="string">"name"</span>]).count()</span><br><span class="line">        <span class="keyword">if</span> tag == <span class="number">1</span>:</span><br><span class="line">            flash(<span class="string">"名称已经存在！"</span>, <span class="string">"err"</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">'admin.tag_add'</span>))</span><br><span class="line">        tag = Tag(</span><br><span class="line">            name=data[<span class="string">"name"</span>]</span><br><span class="line">        )</span><br><span class="line">        db.session.add(tag)</span><br><span class="line">        db.session.commit()</span><br><span class="line">        flash(<span class="string">"添加标签成功！"</span>, <span class="string">"ok"</span>)</span><br><span class="line">        redirect(url_for(<span class="string">'admin.tag_add'</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"admin/tag_add.html"</span>, form=form)</span><br></pre></td></tr></table></figure>

<ul>
<li>紧接着在tag_add.html模板中定义正确提示信息以及错误提示信息，需要注意的是需使用flash分类闪现操作</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for msg in get_flashed_messages(category_filter=["ok"]) %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"alert alert-success alert-dismissible"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"close"</span> <span class="attr">data-dismiss</span>=<span class="string">"alert"</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span>×</span><br><span class="line">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h4</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"icon fa fa-check"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 操作成功<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">        &#123;&#123; msg &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line">&#123;% for msg in get_flashed_messages(category_filter=["err"]) %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"alert alert-danger alert-dismissible"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"close"</span> <span class="attr">data-dismiss</span>=<span class="string">"alert"</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span>×</span><br><span class="line">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h4</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"icon fa fa-ban"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 操作失败<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">        &#123;&#123; msg &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>测试添加标签功能</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190417184031644.gif" alt></fancybox></p>
<ul>
<li>查看数据库tag表数据</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190417184234756.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<p><strong>2.</strong>标签列表数据显示</p>
<ul>
<li>在视图函数tag_list中，定义路由接收页码page参数，从数据中查询tag表数据并按照添加时间倒序排序，将查询结果通过sqlalchemy中的paginate方法进行分页，最终将分页结果集传递给前端模板</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 标签列表</span></span><br><span class="line"><span class="meta">@admin.route('/tag/list/&lt;int:page&gt;/', methods=['GET'])</span></span><br><span class="line"><span class="meta">@admin_login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tag_list</span><span class="params">(page=None)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> page <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        page = <span class="number">1</span></span><br><span class="line">    page_data = Tag.query.order_by(Tag.addtime.desc()).paginate(page=page, per_page=<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"admin/tag_list.html"</span>, page_data=page_data)</span><br></pre></td></tr></table></figure>

<ul>
<li>在模板文件中遍历后端传递的结果集，获取每个tag对象，填写模板数据</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for t in page_data.items%&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;t.id&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;t.name&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;t.addtime&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"label label-success"</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        &amp;nbsp;</span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"label label-danger"</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>因为视图函数tag_list修改了路由，所以需要在grid.html模板中修改标签列表的地址，传递page参数</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;&#123;url_for('admin.tag_list', page=1)&#125;&#125;"</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>测试标签列表页</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190417202335492.gif" alt></fancybox></p>
<ul>
<li>目前只能根据请求地址中page参数来控制页面数据的显示，而页面中的分页点击没有任何作用，所以需要进行修改，因为网站页面中所有的分页都是一样的，所以这里将tag_list模板中的分页代码剪切出来，在templates目录下新建ui目录，在该目录下创建admin_page.html文件，将剪切出来的代码拷贝至此，进行如下编写，请参考分页文档</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;% macro page(data, url) %&#125;</span><br><span class="line">&#123;% if data %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"pagination pagination-sm no-margin pull-right"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;&#123;url_for(url, page=1)&#125;&#125;"</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    &#123;% if data.has_prev %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;&#123;url_for(url, page=data.prev_num)&#125;&#125;"</span>&gt;</span>上一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    &#123;% else%&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"disabled"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>上一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line"> </span><br><span class="line">    &#123;% for p in data.iter_pages() %&#125;</span><br><span class="line">        &#123;% if p == data.page %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"active"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>&#123;&#123;p&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        &#123;% else %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;&#123;url_for(url, page=p)&#125;&#125;"</span>&gt;</span>&#123;&#123;p&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        &#123;% endif %&#125;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line"> </span><br><span class="line">    &#123;% if data.has_next %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;&#123;url_for(url, page=data.next_num)&#125;&#125;"</span>&gt;</span>下一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    &#123;% else%&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"disabled"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>下一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;&#123;url_for(url, page=data.pages)&#125;&#125;"</span>&gt;</span>尾页<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">&#123;% endmacro %&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>回到tag_list模板中，调用上一步写的分页，该分页需接收两个参数一个是数据库查询的分页集数据，另一个是页面地址</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"box-footer clearfix"</span>&gt;</span></span><br><span class="line">    &#123;&#123;pg.page(page_data, 'admin.tag_list')&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>测试标签列表页分页显示数据</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190417210814375.gif" alt></fancybox></p>
<p><strong>3.</strong>删除标签</p>
<ul>
<li>在views中定义删除标签视图函数，需要接收前端传递商品的id，使用flask sqlalchemy 删除方法，查看参考文档，以及视图查询中的first_or_404方法，捕获404页面，删除标签成功，跳转到标签列表页，需要注意列表页需要传递page参数，否则报错</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@admin.route('/tag/del/&lt;int:id&gt;/', methods=['GET'])</span></span><br><span class="line"><span class="meta">@admin_login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tag_del</span><span class="params">(id=None)</span>:</span></span><br><span class="line">    tag = Tag.query.filter_by(id=id).first_or_404()</span><br><span class="line">    db.session.delete(tag)</span><br><span class="line">    db.session.commit()</span><br><span class="line">    flash(<span class="string">"删除标签成功！"</span>, <span class="string">"ok"</span>)</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">'admin.tag_list'</span>, page=<span class="number">1</span>))</span><br></pre></td></tr></table></figure>

<ul>
<li>在tag_list模板文件中需要编写删除按钮的地址，以及模板中删除成功信息提示框（跟添加标签时一样）</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;&#123;url_for('admin.tag_del', id=t.id)&#125;&#125;"</span> <span class="attr">class</span>=<span class="string">"label label-danger"</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">&#123;% for msg in get_flashed_messages(category_filter=["ok"]) %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"alert alert-success alert-dismissible"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"close"</span> <span class="attr">data-dismiss</span>=<span class="string">"alert"</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span>×</span><br><span class="line">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h4</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"icon fa fa-check"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 操作成功<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">        &#123;&#123; msg &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>测试删除标签功能（说明博主这里将tag_list视图函数中分页数据显示为5条）</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190417213248619.gif" alt></fancybox></p>
<p><strong>4.</strong>修改标签</p>
<ul>
<li>同样在视图中定义修改标签的视图函数，跟添加标签逻辑大同小异，首先获取前端传递过来的标签id，在后端根据该标签id从数据表中查询到对应的标签对象tag；当管理员点击提交按钮则获取表单数据，根据表单数据中的name属性的值从数据库获取对应的结果数，判断当结果数为1并且数据库中对象的name值与管理员填写的name值一致，则表示名称已存在数据库；反之则设置tag对象的name属性值为管理员修改的name值，保存至数据库，<font style="color:red">需要注意的是在调用tag_update视图函数需要传递id值</font></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改标签</span></span><br><span class="line"><span class="meta">@admin.route('/tag/update/&lt;int:id&gt;', methods=['GET', 'POST'])</span></span><br><span class="line"><span class="meta">@admin_login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tag_update</span><span class="params">(id)</span>:</span></span><br><span class="line">    tag = Tag.query.get_or_404(id)</span><br><span class="line">    form = TagFrom()</span><br><span class="line">    <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">        data = form.data</span><br><span class="line">        tag_count = Tag.query.filter_by(name=data[<span class="string">"name"</span>]).count()</span><br><span class="line">        <span class="keyword">if</span> tag_count == <span class="number">1</span> <span class="keyword">and</span> tag.name == data[<span class="string">'name'</span>]:</span><br><span class="line">            flash(<span class="string">"名称已经存在！"</span>, <span class="string">"err"</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">'admin.tag_update'</span>, id=id))</span><br><span class="line">        tag.name = data[<span class="string">'name'</span>]</span><br><span class="line">        db.session.add(tag)</span><br><span class="line">        db.session.commit()</span><br><span class="line">        flash(<span class="string">"添加标签成功！"</span>, <span class="string">"ok"</span>)</span><br><span class="line">        redirect(url_for(<span class="string">'admin.tag_update'</span>, id=id))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"admin/tag_update.html"</span>, form=form, tag=tag)</span><br></pre></td></tr></table></figure>

<ul>
<li>在admin目录下创建tag_update.html模板文件，用于进行修改标签页面显示，需要将标签对象的name值赋值到此模板中input name value中，用于显示将要修改的标签名，将tag_add.html模板内容复制到tag_update.html中，需要将添加标签标题修改为修改标签以及在模板中input框name值需要赋值</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;form.name(value=tag.name)&#125;&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>测试修改标签功能</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190418095913384.gif" alt></fancybox></p>
<h1 id="四丶后台管理（电影管理）"><a href="#四丶后台管理（电影管理）" class="headerlink" title="四丶后台管理（电影管理）"></a>四丶后台管理（电影管理）</h1><p><strong>1.</strong>添加电影</p>
<ul>
<li>创建form表单类</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MovieForm</span><span class="params">(FlaskForm)</span>:</span></span><br><span class="line">    <span class="string">"""添加电影表单"""</span></span><br><span class="line">    title = StringField(</span><br><span class="line">        label=<span class="string">"片名"</span>,</span><br><span class="line">        validators=[</span><br><span class="line">            DataRequired(<span class="string">"片名不能为空"</span>)</span><br><span class="line">        ],</span><br><span class="line">        description=<span class="string">"片名"</span>,</span><br><span class="line">        render_kw=&#123;</span><br><span class="line">            <span class="string">"class"</span>: <span class="string">"form-control"</span>,</span><br><span class="line">            <span class="string">"id"</span>: <span class="string">"input_title"</span>,</span><br><span class="line">            <span class="string">"placeholder"</span>: <span class="string">"请输入片名！！"</span></span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">    url = FileField(</span><br><span class="line">        label=<span class="string">"文件"</span>,</span><br><span class="line">        validators=[</span><br><span class="line">            DataRequired(<span class="string">"请上传文件！"</span>)</span><br><span class="line">        ],</span><br><span class="line">        description=<span class="string">"文件"</span>,</span><br><span class="line">    )</span><br><span class="line">    info = TextAreaField(</span><br><span class="line">        label=<span class="string">"简介"</span>,</span><br><span class="line">        validators=[</span><br><span class="line">            DataRequired(<span class="string">"简介不能为空"</span>)</span><br><span class="line">        ],</span><br><span class="line">        description=<span class="string">"简介"</span>,</span><br><span class="line">        render_kw=&#123;</span><br><span class="line">            <span class="string">"class"</span>: <span class="string">"form-control"</span>,</span><br><span class="line">            <span class="string">"rows"</span>: <span class="number">5</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">    logo = FileField(</span><br><span class="line">        label=<span class="string">"封面"</span>,</span><br><span class="line">        validators=[</span><br><span class="line">            DataRequired(<span class="string">"请上传封面！"</span>)</span><br><span class="line">        ],</span><br><span class="line">        description=<span class="string">"封面"</span>,</span><br><span class="line">    )</span><br><span class="line">    star = SelectField(</span><br><span class="line">        label=<span class="string">"星级"</span>,</span><br><span class="line">        validators=[</span><br><span class="line">            DataRequired(<span class="string">"请选择星级！"</span>)</span><br><span class="line">        ],</span><br><span class="line">        <span class="comment"># 星级是整数型</span></span><br><span class="line">        coerce=int,</span><br><span class="line">        <span class="comment"># 采用下拉选择的方式进行星级的选择</span></span><br><span class="line">        choices=[(<span class="number">1</span>, <span class="string">"1星级"</span>), (<span class="number">2</span>, <span class="string">"2星级"</span>), (<span class="number">3</span>, <span class="string">"3星级"</span>), (<span class="number">4</span>, <span class="string">"4星级"</span>), (<span class="number">5</span>, <span class="string">"5星级"</span>)],</span><br><span class="line">        description=<span class="string">"星级"</span>,</span><br><span class="line">        render_kw=&#123;</span><br><span class="line">            <span class="string">"class"</span>: <span class="string">"form-control"</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">    tag_id = SelectField(</span><br><span class="line">        label=<span class="string">"所属标签"</span>,</span><br><span class="line">        validators=[</span><br><span class="line">            DataRequired(<span class="string">"请选择标签！"</span>)</span><br><span class="line">        ],</span><br><span class="line">        <span class="comment"># 标签id也是整数型</span></span><br><span class="line">        coerce=int,</span><br><span class="line">        <span class="comment"># 采用列表递归式来取出所有的标签</span></span><br><span class="line">        choices=[(t.id, t.name)<span class="keyword">for</span> t <span class="keyword">in</span> Tag.query.all()],</span><br><span class="line">        description=<span class="string">"标签"</span>,</span><br><span class="line">        render_kw=&#123;</span><br><span class="line">            <span class="string">"class"</span>: <span class="string">"form-control"</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">    area = StringField(</span><br><span class="line">        label=<span class="string">"上映地区"</span>,</span><br><span class="line">        validators=[</span><br><span class="line">            DataRequired(<span class="string">"请输入地区！"</span>)</span><br><span class="line">        ],</span><br><span class="line">        description=<span class="string">"地区"</span>,</span><br><span class="line">        render_kw=&#123;</span><br><span class="line">            <span class="string">"class"</span>: <span class="string">"form-control"</span>,</span><br><span class="line">            <span class="string">"id"</span>: <span class="string">"input_area"</span>,</span><br><span class="line">            <span class="string">"placeholder"</span>: <span class="string">"请输入地区！"</span></span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">    length = StringField(</span><br><span class="line">        label=<span class="string">"电影片长"</span>,</span><br><span class="line">        validators=[</span><br><span class="line">            DataRequired(<span class="string">"请输入片长！"</span>)</span><br><span class="line">        ],</span><br><span class="line">        description=<span class="string">"片长"</span>,</span><br><span class="line">        render_kw=&#123;</span><br><span class="line">            <span class="string">"class"</span>: <span class="string">"form-control"</span>,</span><br><span class="line">            <span class="string">"id"</span>: <span class="string">"input_length"</span>,</span><br><span class="line">            <span class="string">"placeholder"</span>: <span class="string">"请输入片长！"</span></span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">    release_time = StringField(</span><br><span class="line">        label=<span class="string">"上映时间"</span>,</span><br><span class="line">        validators=[</span><br><span class="line">            DataRequired(<span class="string">"请输入上映时间！"</span>)</span><br><span class="line">        ],</span><br><span class="line">        description=<span class="string">"上映时间"</span>,</span><br><span class="line">        render_kw=&#123;</span><br><span class="line">            <span class="string">"class"</span>: <span class="string">"form-control"</span>,</span><br><span class="line">            <span class="string">"id"</span>: <span class="string">"input_release_time"</span>,</span><br><span class="line">            <span class="string">"placeholder"</span>: <span class="string">"请输入上映时间！"</span></span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">    submit = SubmitField(</span><br><span class="line">        <span class="string">'编辑'</span>,</span><br><span class="line">        render_kw=&#123;</span><br><span class="line">            <span class="string">"class"</span>: <span class="string">"btn btn-primary"</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<ul>
<li>修改movie_add.html模板文件（也就是替换表单数据）</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">role</span>=<span class="string">"form"</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"box-body"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"input_title"</span>&gt;</span>&#123;&#123;form.title.label&#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            &#123;&#123;form.title&#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"input_url"</span>&gt;</span>&#123;&#123;form.url.label&#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            &#123;&#123;form.url&#125;&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"margin-top:5px;"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"moviecontainer"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"input_info"</span>&gt;</span>&#123;&#123;form.info.label&#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            &#123;&#123;form.info&#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"input_logo"</span>&gt;</span>&#123;&#123;form.logo.label&#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            &#123;&#123;form.logo&#125;&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">data-src</span>=<span class="string">"holder.js/262x166"</span> <span class="attr">style</span>=<span class="string">"margin-top:5px;"</span> <span class="attr">class</span>=<span class="string">"img-responsive"</span></span></span><br><span class="line"><span class="tag">                 <span class="attr">alt</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"input_star"</span>&gt;</span>&#123;&#123;form.star.label&#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            &#123;&#123;form.star&#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"input_tag_id"</span>&gt;</span>&#123;&#123;form.tag_id.label&#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            &#123;&#123;form.tag_id&#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"input_area"</span>&gt;</span>&#123;&#123;form.area.label&#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            &#123;&#123;form.area&#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"input_length"</span>&gt;</span>&#123;&#123;form.length.label&#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            &#123;&#123;form.length&#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"input_release_time"</span>&gt;</span>&#123;&#123;form.release_time.label&#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            &#123;&#123;form.release_time&#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"box-footer"</span>&gt;</span></span><br><span class="line">        &#123;&#123;form.submit&#125;&#125;</span><br><span class="line">        &#123;&#123;form.csrf_token&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>测试显示添加电影页面</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190418111306267.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<ul>
<li>在views/movie_add视图函数中获取表单数据字段并添加到Movie数据表中，url表示视图链接地址logo表示视频封面图片</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加电影</span></span><br><span class="line"><span class="meta">@admin.route('/movie/add', methods=['GET', 'POST'])</span></span><br><span class="line"><span class="meta">@admin_login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">movie_add</span><span class="params">()</span>:</span></span><br><span class="line">    form = MovieForm()</span><br><span class="line">    <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">        data = form.data</span><br><span class="line">        movie = Movie(</span><br><span class="line">            title=data[<span class="string">"title"</span>],</span><br><span class="line">            url=url,</span><br><span class="line">            info=data[<span class="string">"info"</span>],</span><br><span class="line">            logo=logo,</span><br><span class="line">            star=int(data[<span class="string">"star"</span>]),</span><br><span class="line">            playnum=<span class="number">0</span>,</span><br><span class="line">            commentnum=<span class="number">0</span>,</span><br><span class="line">            tag_id=int(data[<span class="string">"tag_id"</span>]),</span><br><span class="line">            area=data[<span class="string">'area'</span>],</span><br><span class="line">            release_time=data[<span class="string">"release_time"</span>],</span><br><span class="line">            length=data[<span class="string">"length"</span>],</span><br><span class="line">        )</span><br><span class="line">        db.session.add(movie)</span><br><span class="line">        db.session.commit()</span><br><span class="line">        flash(<span class="string">"添加电影成功！"</span>, <span class="string">"ok"</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">"admin.movie_add"</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"admin/movie_add.html"</span>, form=form)</span><br></pre></td></tr></table></figure>

<ul>
<li>在配置文件app/<strong>init</strong>.py中配置电影文件上传的路径为static/uploads目录下，添加当前配置文件所在的绝对路径在path中（就是<strong>init</strong>.py文件所在路径，改路径与static目录路径同级都是在app目录下）</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.config[<span class="string">"UP_DIR"</span>] = os.path.join(os.path.abspath(os.path.dirname(__file__)), <span class="string">"static/uploads/"</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>从werkzeug.utils工具中导入secure_filename方法，该方法可以将上传文件名修改为合法名（返回的ASCII码的文件名），在movie_add视图函数中通过表单对象url中的data数据中的filename来获取上传的电影文件名，同理获取上传的图片文件名</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">file_url = secure_filename(form.url.data.filename)  <span class="comment"># 获取上传的电影文件名</span></span><br><span class="line">file_logo = secure_filename(form.logo.data.filename) <span class="comment"># 获取上传图片文件名</span></span><br></pre></td></tr></table></figure>

<ul>
<li>在views中定义change_filename方法，用于对上传的文件名进行加密（也就是在原有的文件名中加上当前的年月日时分秒和随机uuid的值）</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change_filename</span><span class="params">(filename)</span>:</span></span><br><span class="line">    fileinfo = os.path.splitext(filename)</span><br><span class="line">    filename = datetime.datetime.now().strftime(<span class="string">"%Y%m%d%H%M%S"</span>) + str(uuid.uuid4().hex) + fileinfo[<span class="number">-1</span>]  <span class="comment"># 文件后缀</span></span><br><span class="line">    <span class="keyword">return</span> filename</span><br></pre></td></tr></table></figure>

<ul>
<li>回到movie_add视图函数中，调用change_filename方法，返回加密后的文件名，通过form表单对象url字段和logo字段data数据写入到/static/uploads目录下的filename文件中</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加电影</span></span><br><span class="line"><span class="meta">@admin.route('/movie/add', methods=['GET', 'POST'])</span></span><br><span class="line"><span class="meta">@admin_login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">movie_add</span><span class="params">()</span>:</span></span><br><span class="line">    form = MovieForm()</span><br><span class="line">    <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">        data = form.data</span><br><span class="line">        file_url = secure_filename(form.url.data.filename)  <span class="comment"># 获取上传的电影文件名</span></span><br><span class="line">        file_logo = secure_filename(form.logo.data.filename) <span class="comment"># 获取上传图片文件名</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(app.config[<span class="string">"UP_DIR"</span>]):  <span class="comment"># 文件夹不存在</span></span><br><span class="line">            os.makedirs(app.config[<span class="string">"UP_DIR"</span>])  <span class="comment"># 创建多级目录</span></span><br><span class="line">            os.chmod(app.config[<span class="string">"UP_DIR"</span>], <span class="string">"rw"</span>)  <span class="comment"># 赋予文件读写的权限</span></span><br><span class="line">        url = change_filename(file_url)  <span class="comment"># 返回加密后的电影文件名</span></span><br><span class="line">        logo = change_filename(file_logo)  <span class="comment"># 返回加密后的图片文件名</span></span><br><span class="line">        <span class="comment"># 将url和logo数据写入到static/uploads/目录的filename文件中</span></span><br><span class="line">        form.url.data.save(app.config[<span class="string">"UP_DIR"</span>] + url)</span><br><span class="line">        form.logo.data.save(app.config[<span class="string">"UP_DIR"</span>] + logo)</span><br><span class="line">        movie = Movie(</span><br><span class="line">            title=data[<span class="string">"title"</span>],</span><br><span class="line">            url=url,</span><br><span class="line">            info=data[<span class="string">"info"</span>],</span><br><span class="line">            logo=logo,</span><br><span class="line">            star=int(data[<span class="string">"star"</span>]),</span><br><span class="line">            playnum=<span class="number">0</span>,</span><br><span class="line">            commentnum=<span class="number">0</span>,</span><br><span class="line">            tag_id=int(data[<span class="string">"tag_id"</span>]),</span><br><span class="line">            area=data[<span class="string">'area'</span>],</span><br><span class="line">            release_time=data[<span class="string">"release_time"</span>],</span><br><span class="line">            length=data[<span class="string">"length"</span>],</span><br><span class="line">        )</span><br><span class="line">        db.session.add(movie)</span><br><span class="line">        db.session.commit()</span><br><span class="line">        flash(<span class="string">"添加电影成功！"</span>, <span class="string">"ok"</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">"admin.movie_add"</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"admin/movie_add.html"</span>, form=form)</span><br></pre></td></tr></table></figure>

<ul>
<li>测试添加电影功能</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190418133950957.gif" alt></fancybox></p>
<ul>
<li>查看数据库movie表数据（X战警为博主前面测试添加的）</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190418133740471.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<ul>
<li>查看项目static目录下生成的数据</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190418134113982.png" alt></p>
<ul>
<li>补充添加电影失败（即片名一致）跟添加标签一样，只需要在movie_add视图函数中，添加如下代码即可</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">movie_count = Movie.query.filter_by(title=data[<span class="string">"title"</span>]).count()</span><br><span class="line"><span class="keyword">if</span> movie_count == <span class="number">1</span>:</span><br><span class="line">    flash(<span class="string">"名称已经存在！"</span>, <span class="string">"err"</span>)</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">'admin.movie_add'</span>))</span><br></pre></td></tr></table></figure>

<p><strong>2.</strong>电影列表数据显示</p>
<ul>
<li>在视图函数movie_list中编写逻辑代码，逻辑和标签列表基本一样，唯一不同的就是这里查询时涉及到关联查询（movie表和tag表），关联查询使用的是filter而不是filter_by</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@admin.route('/movie/list/&lt;int:page&gt;/', methods=['GET'])</span></span><br><span class="line"><span class="meta">@admin_login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">movie_list</span><span class="params">(page)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> page <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        page = <span class="number">1</span></span><br><span class="line">    page_data = Movie.query.join(Tag).filter(Movie.tag_id==Tag.id).order_by(Movie.addtime.desc()).paginate(page=page, per_page=<span class="number">5</span>)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"admin/movie_list.html"</span>, page_data=page_data)</span><br></pre></td></tr></table></figure>

<ul>
<li>在grid.html模板文件中更新电影列表的链接地址</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">id</span>=<span class="string">"g-3-2"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;&#123;url_for('admin.movie_list', page=1)&#125;&#125;"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-circle-o"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 电影列表</span><br><span class="line">    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>在movie_add.html模板文件中获取后端传递的movie表的分页数据集，并进行表数据和页面分页数据替换</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for m in page_data.items%&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;m.id&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;m.title&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;m.length&#125;&#125;分钟<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;m.tag.name&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;m.area&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;m.star&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;m.playnum&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;m.commentnum&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;m.release_time&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"label label-success"</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                &amp;nbsp;</span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"label label-danger"</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"box-footer clearfix"</span>&gt;</span></span><br><span class="line">    &#123;&#123;pg.page(page_data, 'admin.movie_list')&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>测试电影列表页分页数据显示（数据只有两天，所以只显示1页）</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190418145517668.gif" alt></fancybox></p>
<p><strong>3.</strong>删除电影</p>
<ul>
<li>定义删除电影视图函数，该函数代码逻辑简单与删除标签视图一致</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除电影</span></span><br><span class="line"><span class="meta">@admin.route('/movie/del/&lt;int:id&gt;/', methods=['GET'])</span></span><br><span class="line"><span class="meta">@admin_login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">movie_del</span><span class="params">(id=None)</span>:</span></span><br><span class="line">    movie = Movie.query.filter_by(id=id).first_or_404()</span><br><span class="line">    db.session.delete(movie)</span><br><span class="line">    db.session.commit()</span><br><span class="line">    flash(<span class="string">"删除电影成功！"</span>, <span class="string">"ok"</span>)</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">'admin.movie_list'</span>, page=<span class="number">1</span>))</span><br></pre></td></tr></table></figure>

<ul>
<li>设置删除按钮超链接地址</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;&#123;url_for('admin.movie_del', id=m.id)&#125;&#125;"</span> <span class="attr">class</span>=<span class="string">"label label-danger"</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>测试删除电影功能</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190418150134983.gif" alt></fancybox></p>
<p><strong>4.</strong>修改电影</p>
<ul>
<li>定义修改电影视图函数，接收要修改电影的id编号，根据id编号从数据库中获取对应movie对象；获取电影表单数据对象form，返回movie_update模板</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改电影</span></span><br><span class="line"><span class="meta">@admin.route('/movie/update/&lt;int:id&gt;/', methods=['GET', 'POST'])</span></span><br><span class="line"><span class="meta">@admin_login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">movie_update</span><span class="params">(id)</span>:</span></span><br><span class="line">    form = MovieForm()</span><br><span class="line">    movie = Movie.query.get_or_404(id)</span><br><span class="line">    <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">        data = form.data</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"admin/movie_update.html"</span>, form=form, movie=movie)</span><br></pre></td></tr></table></figure>

<ul>
<li>在grid.html模板中更新编辑功能跳转链接地址</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;&#123;url_for('admin.movie_update', id=m.id)&#125;&#125;"</span> <span class="attr">class</span>=<span class="string">"label label-success"</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>在admin目录下创建movie_update.html模板文件，将movie_add.html模板中数据拷贝到此模板中，进行如下修改（部分代码演示，数据比较多），主要是三个点，在修改电影页面输入框选择框初始值显示，url（电影）显示，logo（海报）显示</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;form.title(value=movie.title)&#125;&#125;  # 添加初始值</span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"&#123;&#123;url_for('static', filename='uploads/'+movie.logo)&#125;&#125;"</span> <span class="attr">width</span>=<span class="string">"200"</span>  <span class="attr">style</span>=<span class="string">"margin-top:5px;"</span> <span class="attr">class</span>=<span class="string">"img-responsive"</span>&gt;</span>  # logo</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span>  # url</span><br><span class="line"><span class="actionscript">    jwplayer(<span class="string">"moviecontainer"</span>).setup(&#123;</span></span><br><span class="line"><span class="actionscript">        flashplayer: <span class="string">"&#123;&#123;url_for('static', filename='jwplayer/jwplayer.flash.swf')&#125;&#125;"</span>,</span></span><br><span class="line">        playlist: [&#123;</span><br><span class="line"><span class="actionscript">            file: <span class="string">"&#123;&#123;url_for('static', filename='uploads/'+movie.url)&#125;&#125;"</span>,</span></span><br><span class="line"><span class="actionscript">            title: <span class="string">"&#123;&#123;movie.title&#125;&#125;"</span></span></span><br><span class="line">        &#125;],</span><br><span class="line">        modes: [&#123;</span><br><span class="line"><span class="actionscript">            type: <span class="string">"html5"</span></span></span><br><span class="line">        &#125;, &#123;</span><br><span class="line"><span class="actionscript">            type: <span class="string">"flash"</span>,</span></span><br><span class="line"><span class="actionscript">            src: <span class="string">"&#123;&#123;url_for('static', filename='jwplayer/jwplayer.flash.swf')&#125;&#125;"</span></span></span><br><span class="line">        &#125;, &#123;</span><br><span class="line"><span class="actionscript">            type: <span class="string">"download"</span></span></span><br><span class="line">        &#125;],</span><br><span class="line">        skin: &#123;</span><br><span class="line"><span class="actionscript">            name: <span class="string">"vapor"</span></span></span><br><span class="line">        &#125;,</span><br><span class="line"><span class="actionscript">        <span class="string">"playlist.position"</span>: <span class="string">"left"</span>,</span></span><br><span class="line"><span class="actionscript">        <span class="string">"playlist.size"</span>: <span class="number">200</span>,</span></span><br><span class="line">        height: 400,</span><br><span class="line">        width: 800,</span><br><span class="line">    &#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>测试修改页面数据显示（页面上的电影简介和星级以及标签是错误的）</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/2019041816001813.gif" alt></fancybox></p>
<ul>
<li>在movie_update.html模板文件中修改电影简介和星级以及标签，不在模板中设置其初始值，而是在视图中直接进行赋值处理</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if request.method == 'GET':</span><br><span class="line">    form.info.data = movie.info</span><br><span class="line">    form.tag_id.data = movie.tag_id</span><br><span class="line">    form.star.data = movie.star</span><br></pre></td></tr></table></figure>

<ul>
<li>刷新修改页面正确显示出电影简介和星级以及标签</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190418165608920.gif" alt></fancybox></p>
<ul>
<li><strong>说明</strong>：gif动图制作的质量比较差，所以看到的画面是比较劣质的（只能上传5M以内的文件），截图对比一下</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190418170041572.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<ul>
<li>在movie_update视图函数中定义修改电影业务逻辑，代码中有注释</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改电影</span></span><br><span class="line"><span class="meta">@admin.route('/movie/update/&lt;int:id&gt;/', methods=['GET', 'POST'])</span></span><br><span class="line"><span class="meta">@admin_login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">movie_update</span><span class="params">(id)</span>:</span></span><br><span class="line">    form = MovieForm()</span><br><span class="line">    movie = Movie.query.get_or_404(id)</span><br><span class="line">    <span class="comment"># 因为url视频和logo图片是存在的不用设置表单数据，所以定义为空</span></span><br><span class="line">    form.url.validators = []</span><br><span class="line">    form.logo.validators = []</span><br><span class="line">    <span class="comment"># 设置修改页面电影简介和星级以及标签的初始值</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'GET'</span>:</span><br><span class="line">        form.info.data = movie.info</span><br><span class="line">        form.tag_id.data = movie.tag_id</span><br><span class="line">        form.star.data = movie.star</span><br><span class="line">    <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">        data = form.data</span><br><span class="line">        movie_count = Movie.query.filter_by(title=data[<span class="string">"title"</span>]).count()</span><br><span class="line">        <span class="comment"># 管理员填写的片面已存在于数据中时，修改电影失败</span></span><br><span class="line">        <span class="keyword">if</span> movie_count == <span class="number">1</span> <span class="keyword">and</span> movie.title == data[<span class="string">'title'</span>]:</span><br><span class="line">            flash(<span class="string">"名称已经存在！"</span>, <span class="string">"err"</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">'admin.movie_update'</span>, id=id))</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(app.config[<span class="string">"UP_DIR"</span>]):  <span class="comment"># 文件夹不存在</span></span><br><span class="line">            os.makedirs(app.config[<span class="string">"UP_DIR"</span>])  <span class="comment"># 创建多级目录</span></span><br><span class="line">            os.chmod(app.config[<span class="string">"UP_DIR"</span>], <span class="string">"rw"</span>)  <span class="comment"># 赋予文件读写的权限</span></span><br><span class="line">        <span class="comment"># 当url数据中filename不为空时，说明已经选择了上传的文件</span></span><br><span class="line">        <span class="keyword">if</span> form.url.data.filename != <span class="string">''</span>:</span><br><span class="line">            file_url = secure_filename(form.url.data.filename)  <span class="comment"># 获取上传的电影文件名</span></span><br><span class="line">            movie.url = change_filename(file_url)  <span class="comment"># 更新对象中的url为返回加密后的电影文件名</span></span><br><span class="line">            <span class="comment"># 将url写入到static/uploads/目录的对应的filename文件中</span></span><br><span class="line">            form.url.data.save(app.config[<span class="string">"UP_DIR"</span>] + movie.url)</span><br><span class="line">        <span class="comment"># 当logo数据中filename不为空时，说明已经选择了上传的文件</span></span><br><span class="line">        <span class="keyword">if</span> form.logo.data.filename != <span class="string">''</span>:</span><br><span class="line">            file_logo = secure_filename(form.logo.data.filename)  <span class="comment"># 获取上传图片文件名</span></span><br><span class="line">            movie.logo = change_filename(file_logo)  <span class="comment"># 更新对象中的logo为返回加密后的图片文件名</span></span><br><span class="line">            <span class="comment"># 将logo写入到static/uploads/目录的对应的filename文件中</span></span><br><span class="line">            form.logo.data.save(app.config[<span class="string">"UP_DIR"</span>] + movie.logo)</span><br><span class="line"> </span><br><span class="line">        <span class="comment"># 将页面上的数据分别设置到数据库对应表字段中</span></span><br><span class="line">        movie.title = data[<span class="string">'title'</span>]</span><br><span class="line">        movie.info = data[<span class="string">'info'</span>]</span><br><span class="line">        movie.star = data[<span class="string">'star'</span>]</span><br><span class="line">        movie.tag_id = data[<span class="string">'tag_id'</span>]</span><br><span class="line">        movie.area = data[<span class="string">'area'</span>]</span><br><span class="line">        movie.length = data[<span class="string">'length'</span>]</span><br><span class="line">        movie.release_time = data[<span class="string">'release_time'</span>]</span><br><span class="line">        db.session.add(movie)</span><br><span class="line">        db.session.commit()</span><br><span class="line">        flash(<span class="string">"修改电影成功！"</span>, <span class="string">"ok"</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">"admin.movie_list"</span>, page=<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"admin/movie_update.html"</span>, form=form, movie=movie)</span><br></pre></td></tr></table></figure>

<ul>
<li><font style="color:red">注重说明一点，博主这里遇到个bug那就是在模板中渲染错误消息，不能覆盖掉DataRequired验证器的提示信息，所以博主这里将设置url（电影）以及logo（图片）中的required=False，进行禁用提示“请填写此字段”，结果还是不提示模板中的渲染的错误消息，注重啥也不提示</font></li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190418213111158.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<ul>
<li>最终通过<a href="https://cloud.tencent.com/developer/ask/150670" target="_blank" rel="noopener">https://cloud.tencent.com/developer/ask/150670</a> 中的在模板form标签中加入novalidate属性   <form novalidate>  然后就渲染了错误信息，删除上一步定义的{{ form.url(required=False) }}和{{ form.logo(required=False) }}</form></li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">novalidate</span> <span class="attr">role</span>=<span class="string">"form"</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>测试修改电影功能</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190418213531454.gif" alt></fancybox></p>
<h1 id="五丶后台管理（预告管理）"><a href="#五丶后台管理（预告管理）" class="headerlink" title="五丶后台管理（预告管理）"></a>五丶后台管理（预告管理）</h1><p><strong>1.</strong>添加预告</p>
<ul>
<li>在admin/forms下定义表单</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PreviewForm</span><span class="params">(FlaskForm)</span>:</span></span><br><span class="line">    <span class="string">"""添加电影预告表单"""</span></span><br><span class="line">    title = StringField(</span><br><span class="line">        label=<span class="string">"预告标题"</span>,</span><br><span class="line">        validators=[</span><br><span class="line">            DataRequired(<span class="string">"请输入预告标题！"</span>)</span><br><span class="line">        ],</span><br><span class="line">        description=<span class="string">"预告标题"</span>,</span><br><span class="line">        render_kw=&#123;</span><br><span class="line">            <span class="string">"class"</span>: <span class="string">"form-control"</span>,</span><br><span class="line">            <span class="string">"placeholder"</span>: <span class="string">"请输入预告标题！"</span></span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">    logo = FileField(</span><br><span class="line">        label=<span class="string">"预告封面"</span>,</span><br><span class="line">        validators=[</span><br><span class="line">            DataRequired(<span class="string">"请上传预告封面！"</span>)</span><br><span class="line">        ],</span><br><span class="line">        description=<span class="string">"预告封面"</span>,</span><br><span class="line">    )</span><br><span class="line">    submit = SubmitField(</span><br><span class="line">        <span class="string">'提交'</span>,</span><br><span class="line">        render_kw=&#123;</span><br><span class="line">            <span class="string">"class"</span>: <span class="string">"btn btn-primary"</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<ul>
<li>编辑视图函数</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加预告</span></span><br><span class="line"><span class="meta">@admin.route('/preview/add', methods=['GET', 'POST'])</span></span><br><span class="line"><span class="meta">@admin_login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">preview_add</span><span class="params">()</span>:</span></span><br><span class="line">    form = PreviewForm()</span><br><span class="line">    <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">        data = form.data</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"admin/preview_add.html"</span>, form=form)</span><br></pre></td></tr></table></figure>

<ul>
<li>编辑preview_add.html模板文件</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">novalidate</span> <span class="attr">role</span>=<span class="string">"form"</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"box-body"</span>&gt;</span></span><br><span class="line">         &#123;% for msg in get_flashed_messages(category_filter=["ok"]) %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"alert alert-success alert-dismissible"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"close"</span> <span class="attr">data-dismiss</span>=<span class="string">"alert"</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span>×</span><br><span class="line">                <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">h4</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"icon fa fa-check"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 操作成功<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">                &#123;&#123; msg &#125;&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">        &#123;% for msg in get_flashed_messages(category_filter=["err"]) %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"alert alert-danger alert-dismissible"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"close"</span> <span class="attr">data-dismiss</span>=<span class="string">"alert"</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span>×</span><br><span class="line">                <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">h4</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"icon fa fa-ban"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 操作失败<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">                &#123;&#123; msg &#125;&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"input_title"</span>&gt;</span>&#123;&#123;form.title.label&#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            &#123;&#123;form.title&#125;&#125;</span><br><span class="line">            &#123;% for error in form.title.errors %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-md-12"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">"color:red"</span>&gt;</span>&#123;&#123; error &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"input_logo"</span>&gt;</span>&#123;&#123;form.logo.label&#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            &#123;&#123;form.logo&#125;&#125;</span><br><span class="line">            &#123;% for error in form.logo.errors %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-md-12"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">"color:red"</span>&gt;</span>&#123;&#123; error &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">data-src</span>=<span class="string">"holder.js/700x320"</span> <span class="attr">style</span>=<span class="string">"margin-top:5px;"</span> <span class="attr">class</span>=<span class="string">"img-responsive"</span></span></span><br><span class="line"><span class="tag">                 <span class="attr">alt</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"box-footer"</span>&gt;</span></span><br><span class="line">        &#123;&#123;form.submit&#125;&#125;</span><br><span class="line">        &#123;&#123;form.csrf_token&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>添加预告页面数据测试（点击提交按钮）</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190421102748106.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<ul>
<li>测试添加预告功能<br><fancybox><img src="https://img-blog.csdnimg.cn/2019042118335294.gif" alt></fancybox></li>
</ul>
<p><strong>2.</strong>预告列表页数据显示</p>
<ul>
<li>跟电影列表一样，数据库查询数据并进行分页，传递分页数据集到模板中</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 预告列表</span></span><br><span class="line"><span class="meta">@admin.route('/preview/list/&lt;int:page&gt;/', methods=['GET'])</span></span><br><span class="line"><span class="meta">@admin_login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">preview_list</span><span class="params">(page=None)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> page == <span class="literal">None</span>:</span><br><span class="line">        page = <span class="number">1</span></span><br><span class="line">    page_data = Preview.query.order_by(Preview.addtime.desc()).paginate(page=page, per_page=<span class="number">5</span>)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"admin/preview_list.html"</span>, page_data=page_data)</span><br></pre></td></tr></table></figure>

<ul>
<li>在grid.html模板中修改列表链接地址（也就是添加page的值）</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;&#123;url_for('admin.preview_list', page=1)&#125;&#125;"</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>在preview.html模板文件中进行如下修改，需要导入ui目录下的分页模板{% import "ui/admin_page.html" as pg %}</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">        &#123;% for p in page_data.items%&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;p.id&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;p.title&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"&#123;&#123;url_for('static', filename='uploads/'+p.logo)&#125;&#125;"</span> <span class="attr">width</span>=<span class="string">"100"</span> <span class="attr">class</span>=<span class="string">"img-responsive center-block"</span> <span class="attr">alt</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;p.addtime &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"label label-success"</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                &amp;nbsp;</span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"label label-danger"</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"box-footer clearfix"</span>&gt;</span></span><br><span class="line">  &#123;&#123;pg.page(page_data, 'admin.preview_list')&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>测试预告列表页数据显示</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190421195600193.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<p><strong>3.</strong>删除预告</p>
<ul>
<li>跟之前电影管理一样逻辑，这里直接上代码，定义视图</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除预告</span></span><br><span class="line"><span class="meta">@admin.route('/preview/del/&lt;int:id&gt;/', methods=['GET'])</span></span><br><span class="line"><span class="meta">@admin_login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">preview_del</span><span class="params">(id=None)</span>:</span></span><br><span class="line">    preview = Preview.query.filter_by(id=id).first_or_404()</span><br><span class="line">    db.session.delete(preview)</span><br><span class="line">    db.session.commit()</span><br><span class="line">    flash(<span class="string">"删除电影成功！"</span>, <span class="string">"ok"</span>)</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">'admin.preview_list'</span>, page=<span class="number">1</span>))</span><br></pre></td></tr></table></figure>

<ul>
<li>在preview.html模板中进行进行添加删除按钮链接地址</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;&#123;url_for('admin.preview_del', id=p.id)&#125;&#125;"</span> <span class="attr">class</span>=<span class="string">"label label-danger"</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>测试删除功能</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190421203925467.gif" alt></fancybox></p>
<p><strong>4.</strong>修改预告（跟修改电影逻辑一样，直接上代码）</p>
<ul>
<li>定义视图函数</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改预告</span></span><br><span class="line"><span class="meta">@admin.route('/preview/update/&lt;int:id&gt;/', methods=['GET', 'POST'])</span></span><br><span class="line"><span class="meta">@admin_login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">preview_update</span><span class="params">(id)</span>:</span></span><br><span class="line">    form = PreviewForm()</span><br><span class="line">    form.logo.validators = []</span><br><span class="line">    preview = Preview.query.filter_by(id=id).first_or_404()</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'GET'</span>:</span><br><span class="line">        form.title.data = preview.title  <span class="comment"># 赋值</span></span><br><span class="line">    <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">        data = form.data</span><br><span class="line">        preview_count = Preview.query.filter_by(title=data[<span class="string">"title"</span>]).count()</span><br><span class="line">        <span class="keyword">if</span> preview_count == <span class="number">1</span>:</span><br><span class="line">            flash(<span class="string">"名称已经存在！"</span>, <span class="string">"err"</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">'admin.preview_update'</span>, id=id))</span><br><span class="line">        <span class="comment"># 当logo数据中filename不为空时，说明已经选择了上传的文件</span></span><br><span class="line">        <span class="keyword">if</span> form.logo.data.filename != <span class="string">''</span>:</span><br><span class="line">            file_logo = secure_filename(form.logo.data.filename)  <span class="comment"># 获取上传图片文件名</span></span><br><span class="line">            preview.logo = change_filename(file_logo)  <span class="comment"># 更新对象中的logo为返回加密后的图片文件名</span></span><br><span class="line">            <span class="comment"># 将logo写入到static/uploads/目录的对应的filename文件中</span></span><br><span class="line">            form.logo.data.save(app.config[<span class="string">"UP_DIR"</span>] + preview.logo)</span><br><span class="line">        preview.title = data[<span class="string">'title'</span>]</span><br><span class="line">        db.session.add(preview)</span><br><span class="line">        db.session.commit()</span><br><span class="line">        flash(<span class="string">"修改预告成功！"</span>, <span class="string">"ok"</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">"admin.preview_list"</span>,page=<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"admin/preview_update.html"</span>, form=form, preview=preview)</span><br></pre></td></tr></table></figure>

<ul>
<li>新建preview_update.html模板（将preview_add.html内容复制进去并进行修改）</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;form novalidate role=<span class="string">"form"</span> method=<span class="string">"post"</span> enctype=<span class="string">"multipart/form-data"</span>&gt;</span><br><span class="line">    &lt;div class="box-body"&gt;</span><br><span class="line">         &#123;% <span class="keyword">for</span> msg <span class="keyword">in</span> get_flashed_messages(category_filter=[<span class="string">"ok"</span>]) %&#125;</span><br><span class="line">            &lt;div class="alert alert-success alert-dismissible"&gt;</span><br><span class="line">                &lt;button type="button" class="close" data-dismiss="alert" aria-hidden="true"&gt;×</span><br><span class="line">                &lt;/button&gt;</span><br><span class="line">                &lt;h4&gt;&lt;i class="icon fa fa-check"&gt;&lt;/i&gt; 操作成功&lt;/h4&gt;</span><br><span class="line">                &#123;&#123; msg &#125;&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">        &#123;% <span class="keyword">for</span> msg <span class="keyword">in</span> get_flashed_messages(category_filter=[<span class="string">"err"</span>]) %&#125;</span><br><span class="line">            &lt;div class="alert alert-danger alert-dismissible"&gt;</span><br><span class="line">                &lt;button type="button" class="close" data-dismiss="alert" aria-hidden="true"&gt;×</span><br><span class="line">                &lt;/button&gt;</span><br><span class="line">                &lt;h4&gt;&lt;i class="icon fa fa-ban"&gt;&lt;/i&gt; 操作失败&lt;/h4&gt;</span><br><span class="line">                &#123;&#123; msg &#125;&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">        &lt;div class="form-group"&gt;</span><br><span class="line">            &lt;label for="input_title"&gt;&#123;&#123;form.title.label&#125;&#125;&lt;/label&gt;</span><br><span class="line">            &#123;&#123;form.title&#125;&#125;</span><br><span class="line">            &#123;% <span class="keyword">for</span> error <span class="keyword">in</span> form.title.errors %&#125;</span><br><span class="line">            &lt;div class="col-md-12"&gt;</span><br><span class="line">                &lt;p style="color:red"&gt;&#123;&#123; error &#125;&#125;&lt;/p&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class="form-group"&gt;</span><br><span class="line">            &lt;label for="input_logo"&gt;&#123;&#123;form.logo.label&#125;&#125;&lt;/label&gt;</span><br><span class="line">            &#123;&#123;form.logo&#125;&#125;</span><br><span class="line">            &#123;% <span class="keyword">for</span> error <span class="keyword">in</span> form.logo.errors %&#125;</span><br><span class="line">            &lt;div class="col-md-12"&gt;</span><br><span class="line">                &lt;p style="color:red"&gt;&#123;&#123; error &#125;&#125;&lt;/p&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">            &lt;img src="&#123;&#123;url_for('static', filename='uploads/'+preview.logo)&#125;&#125;" style="margin-top:5px;" class="img-responsive"</span><br><span class="line">                 alt=<span class="string">""</span>&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div class="box-footer"&gt;</span><br><span class="line">        &#123;&#123;form.submit&#125;&#125;</span><br><span class="line">        &#123;&#123;form.csrf_token&#125;&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>测试修改预告功能</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190421212245639.gif" alt></fancybox></p>
<br>

<p>————————————————<br>版权声明：本文为CSDN博主「cdtaogang」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。<br>原文链接：<a href="https://blog.csdn.net/qq_41782425/article/details/89340922" target="_blank" rel="noopener">https://blog.csdn.net/qq_41782425/article/details/89340922</a></p>

      </div>
      
        <br>
        


  <section class='meta' id="footer-meta">
    <div class='new-meta-box'>
      
        
          <div class="new-meta-item date" itemprop="dateUpdated" datetime="2019-11-13T22:33:21+08:00">
  <a class='notlink'>
    <i class="fas fa-clock" aria-hidden="true"></i>
    <p>更新于 2019年11月13日</p>
  </a>
</div>

        
      
        
          
  
  <div class="new-meta-item meta-tags"><a class="tag" href="/tags/Python/" rel="nofollow"><i class="fas fa-tag" aria-hidden="true"></i><p>Python</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/Python-Web开发/" rel="nofollow"><i class="fas fa-tag" aria-hidden="true"></i><p>Python Web开发</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/Flask/" rel="nofollow"><i class="fas fa-tag" aria-hidden="true"></i><p>Flask</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/Flask网站实战/" rel="nofollow"><i class="fas fa-tag" aria-hidden="true"></i><p>Flask网站实战</p></a></div>


        
      
        
          
  <div class="new-meta-item share -mob-share-list">
  <div class="-mob-share-list share-body">
    
      
        <a class="-mob-share-qq" title="QQ好友" rel="external nofollow noopener noreferrer"
          
          href="http://connect.qq.com/widget/shareqq/index.html?url=https://hellotaogang.github.io/2019/11/11/Flask项目之个性化微电影网站的实战开发（二）/&title=Flask项目之个性化微电影网站的实战开发（二） | TG'S BLOG&summary=该篇文章是博主一字一码编写的，实属不易，请尊重原创，谢谢大家！温馨提示：需要项目源码的朋友，请添加博主微信进行获取！
&nbsp;&nbsp;本文目录
一丶搭建后台页面
二丶后台管理（管理员登录及退出）
三丶后台管理（标签管理）
四丶后台管理（电影管理）
五丶后台管理（预告管理）"
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/assets@19.1.9/logo/128/qq.png">
          
        </a>
      
    
      
        <a class="-mob-share-qzone" title="QQ空间" rel="external nofollow noopener noreferrer"
          
          href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://hellotaogang.github.io/2019/11/11/Flask项目之个性化微电影网站的实战开发（二）/&title=Flask项目之个性化微电影网站的实战开发（二） | TG'S BLOG&summary=该篇文章是博主一字一码编写的，实属不易，请尊重原创，谢谢大家！温馨提示：需要项目源码的朋友，请添加博主微信进行获取！
&nbsp;&nbsp;本文目录
一丶搭建后台页面
二丶后台管理（管理员登录及退出）
三丶后台管理（标签管理）
四丶后台管理（电影管理）
五丶后台管理（预告管理）"
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/assets@19.1.9/logo/128/qzone.png">
          
        </a>
      
    
      
        <a class='qrcode' rel="external nofollow noopener noreferrer" href='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQ4AAAEOCAAAAABd2qZ5AAAD70lEQVR42u3aSY7bQBAEQP3/0/LFBwM2qcyqpi3AwdNAo+kleKip5fWKn/ftk38/X//Xz++/f//J64kHBw4cOHCsr5pf/vfPrz6ZgV5dOKGJXhIOHDhw4DjEcXWgTcBLgNq92svna+LAgQMHjm/gmAW5JBhvEr8ZMQ4cOHDg+AaOJE2aleraEuT+/Dhw4MCB4yzHrAw3S/DagJoXIpPi5rFaKQ4cOHDg6PYtCnPf//Mj8x04cODAgaMcGkhKb3kK1wbaIula3+vnmjhw4MCBY82x2SBpOO3j/xNDeB/Wx4EDBw4cC448EZoF0U1amIT2Nqx+OBsOHDhw4Fhz7McLzjZ72qO3Qf0YEA4cOHDguN0lv1J+gSSJut+lHY+b5a+XGS0OHDhw4DjEUfxZ2UbaBM48kG9ocODAgQPHWY5NO6cdfdikYZtXGJ0NBw4cOHAsONpAlQw0tK2mPHWcDTckNxqWUnHgwIEDxy1HfsR8jKAtL87Svzygfvg+Dhw4cOBYc+QHyq+XX3iWdM1WLsIwDhw4cOBYcLzjJ28LbRpCbZDO07PVZAcOHDhw4Cg5Ntu0owz5yELbvpo1pVbTFjhw4MCB43adPFhuBuDy9fMW12yEAgcOHDhw/B2OV/zMRhNmYXLYQBrdBQcOHDhwnOLIA2Fb+NsH2rbFtVkBBw4cOHBsONohhnaFJ1Ky/Jz5z5cDDThw4MCBo+RoG0KnmkCb1C660ub/Dhw4cODAseZoS4R5QG2H3vKrnk32cODAgQPHKY6kzPcun2TjzSX3IxGX6SIOHDhw4DjKsdmgTaXaIbazL+CyvIgDBw4cOA5xbJpD+ZhanpjN0sjZgMVqURw4cODAUR4xGTJoV8v5No2rZK8//C0OHDhw4FhznBoIaAtzm2G4sy/jQ/MJBw4cOHCUHG2gag+d75KnXnn4r4cqcODAgQPHmuNUuH2Ccvaq2jUf+e8DBw4cOP57jlmClBf18mDcNqXe5RPFUxw4cODAsebIC3z5cMAsDZulhfsy4rDeiQMHDhw4fvvtfUDKgZLw1qZ5M4LZmjhw4MCB4yzHrPPyRHEwP0+bUkbFRxw4cODAseZoA1geRF/rZzMekc8q4MCBAweOsxyzts3soPn389VmgbnOaHHgwIEDR8zRhr1ZGEtC6Sm+dv38Xjhw4MCBI+eYNY3asmDbFtoM5LUvJsrwcODAgQNHybEPhDnuJsDv+T58HwcOHDhw/COOtk01S/BmA3Z56ogDBw4cOL6NIx8vyMN2O2a3aX1d9uJw4MCBA8eaI7/eJoy1Vz01PJGcAQcOHDhwnOJoS2l5wW4WDvOV8zG4zcgdDhw4cOCIOX4AygAVRzy+m24AAAAASUVORK5CYII='>
        
          <img src="https://cdn.jsdelivr.net/gh/xaoxuu/assets@19.1.9/logo/128/wechat.png">
        
        </a>
      
    
      
        <a class="-mob-share-weibo" title="微博" rel="external nofollow noopener noreferrer"
          
          href="http://service.weibo.com/share/share.php?url=https://hellotaogang.github.io/2019/11/11/Flask项目之个性化微电影网站的实战开发（二）/&title=Flask项目之个性化微电影网站的实战开发（二） | TG'S BLOG&summary=该篇文章是博主一字一码编写的，实属不易，请尊重原创，谢谢大家！温馨提示：需要项目源码的朋友，请添加博主微信进行获取！
&nbsp;&nbsp;本文目录
一丶搭建后台页面
二丶后台管理（管理员登录及退出）
三丶后台管理（标签管理）
四丶后台管理（电影管理）
五丶后台管理（预告管理）"
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/assets@19.1.9/logo/128/weibo.png">
          
        </a>
      
    
  </div>
</div>



        
      
    </div>
  </section>


      
      
          <div class="prev-next">
              
                  <section class="prev">
                      <span class="art-item-left">
                          <h6><i class="fas fa-chevron-left" aria-hidden="true"></i>&nbsp;上一页</h6>
                          <h4>
                              <a href="/2019/11/12/Flask项目之个性化微电影网站的实战开发（三）/" rel="prev" title="Flask项目之个性化微电影网站的实战开发（三）">
                                
                                    Flask项目之个性化微电影网站的实战开发（三）
                                
                              </a>
                          </h4>
                          
                              
                              <h6 class="tags">
                                  <a class="tag" href="/tags/Python/"><i class="fas fa-tag fa-fw" aria-hidden="true"></i> Python</a> <a class="tag" href="/tags/Python-Web开发/"><i class="fas fa-tag fa-fw" aria-hidden="true"></i> Python Web开发</a> <a class="tag" href="/tags/Flask/"><i class="fas fa-tag fa-fw" aria-hidden="true"></i> Flask</a> <a class="tag" href="/tags/Flask网站实战/"><i class="fas fa-tag fa-fw" aria-hidden="true"></i> Flask网站实战</a>
                              </h6>
                          
                      </span>
                  </section>
              
              
                  <section class="next">
                      <span class="art-item-right" aria-hidden="true">
                          <h6>下一页&nbsp;<i class="fas fa-chevron-right" aria-hidden="true"></i></h6>
                          <h4>
                              <a href="/2019/11/11/Flask项目之个性化微电影网站的实战开发（一）/" rel="prev" title="Flask项目之个性化微电影网站的实战开发（一）">
                                  
                                      Flask项目之个性化微电影网站的实战开发（一）
                                  
                              </a>
                          </h4>
                          
                              
                              <h6 class="tags">
                                  <a class="tag" href="/tags/Python/"><i class="fas fa-tag fa-fw" aria-hidden="true"></i> Python</a> <a class="tag" href="/tags/Python-Web开发/"><i class="fas fa-tag fa-fw" aria-hidden="true"></i> Python Web开发</a> <a class="tag" href="/tags/Flask/"><i class="fas fa-tag fa-fw" aria-hidden="true"></i> Flask</a> <a class="tag" href="/tags/Flask网站实战/"><i class="fas fa-tag fa-fw" aria-hidden="true"></i> Flask网站实战</a>
                              </h6>
                          
                      </span>
                  </section>
              
          </div>
      
    </section>
  </article>



  <!-- 显示推荐文章和评论 -->



  <article class="post white-box comments">
    <section class="article typo">
      <h4><i class="fas fa-comments fa-fw" aria-hidden="true"></i>&nbsp;评论</h4>
      
      
      
        <section id="comments">
          <div id="gitalk-container"></div>
        </section>
      
      
    </section>
  </article>






<!-- 根据页面mathjax变量决定是否加载MathJax数学公式js -->



  <script>
    window.subData = {
      title: 'Flask项目之个性化微电影网站的实战开发（二）',
      tools: true
    }
  </script>


</div>
<aside class='l_side'>
  
    
    
      
        
          
          
        
          
          
            
              
  <section class='widget toc-wrapper'>
    
<header class='pure'>
  <div><i class="fas fa-list fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;本文目录</div>
  
    <!-- <div class='wrapper'><a class="s-toc rightBtn" rel="external nofollow noopener noreferrer" href="javascript:void(0)"><i class="fas fa-thumbtack fa-fw"></i></a></div> -->
  
</header>

    <div class='content pure'>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#一丶搭建后台页面"><span class="toc-text">一丶搭建后台页面</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#二丶后台管理（管理员登录及退出）"><span class="toc-text">二丶后台管理（管理员登录及退出）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#三丶后台管理（标签管理）"><span class="toc-text">三丶后台管理（标签管理）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#四丶后台管理（电影管理）"><span class="toc-text">四丶后台管理（电影管理）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#五丶后台管理（预告管理）"><span class="toc-text">五丶后台管理（预告管理）</span></a></li></ol>
    </div>
  </section>


            
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
      
    

  
</aside>

<footer id="footer" class="clearfix">
  
  
    <div class="social-wrapper">
      
        
          <a href="http://wpa.qq.com/msgrd?v=3&amp;uin=1126331350&amp;site=qq&amp;menu=yes"
            class="social fab fa-qq flat-btn flat-btn"
            target="_blank"
            rel="external nofollow noopener noreferrer">
          </a>
        
      
        
          <a href="https://cdn.jsdelivr.net/gh/Hellotaogang/cdn@4.4/about/wxhy.png"
            class="social fab fa-weixin flat-btn flat-btn"
            target="_blank"
            rel="external nofollow noopener noreferrer">
          </a>
        
      
        
          <a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=cdtaogang@163.com"
            class="social fas fa-envelope flat-btn"
            target="_blank"
            rel="external nofollow noopener noreferrer">
          </a>
        
      
        
          <a href="https://github.com/Hellotaogang"
            class="social fab fa-github flat-btn"
            target="_blank"
            rel="external nofollow noopener noreferrer">
          </a>
        
      
        
          <a href="https://blog.csdn.net/qq_41782425"
            class="social fab fa-cuttlefish flat-btn flat-btn"
            target="_blank"
            rel="external nofollow noopener noreferrer">
          </a>
        
      
    </div>
  
  <br>
  <div><p>Copyright <i class='far fa-copyright'></i> 2019-2020 <a style='color: #333333' href='https://www.cdtaogang.top/' target='_blank'>TG’BLOG</a>&nbsp;&nbsp;|&nbsp;&nbsp;<span id='timeDate'>载入天数…</span><span id='times'>载入时分秒…</span></p>
</div>
  <br>
  <div>
    <div class='github-badge'> <a style='color: #fff' href='https://hexo.io/'><span class='badge-subject'>框架</span><span class='badge-value bg-blue'>Hexo</span></a> </div> <div class='github-badge'> <a style='color: #fff' href='https://github.com/'><span class='badge-subject'>托管</span><span class='badge-value bg-brightgreen'>GitHub</span></a> </div> <div class='github-badge'> <a style='color: #fff' href='https://www.aliyun.com/'><span class='badge-subject'>域名</span><span class='badge-value bg-firebrick'>Aliyun</span></a> </div> <div class='github-badge'> <a style='color: #fff' href='https://www.jsdelivr.com/'><span class='badge-subject'>内容分发网络</span><span class='badge-value bg-orange'>jsDelivr</span></a> </div> <div class='github-badge'> <a style='color: #fff' href='https://996.icu/#/zh_CN'><span class='badge-subject'>链接</span><span class='badge-value bg-red'>996.ICU</span></a> </div> <div class='github-badge'> <a style='color: #fff' href='https://xaoxuu.com/wiki/material-x/'><span class='badge-subject'>主题</span><span class='badge-value bg-blue'>Material X</span></a> </div> <div class='github-badge'> <a style='color: #fff' href='https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh'><span class='badge-subject'>协议</span><span class='badge-value bg-pink'>BY-NC-SA 4.0</span></a> </div>
  </div>
<script>
    var now = new Date(); 
    function createtime() { 
        var grt= new Date("10/11/2019 21:38:00");//在此处修改你的建站时间
        now.setTime(now.getTime()+250); 
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days); 
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours); 
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum); 
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;} 
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum); 
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;} 
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 "; 
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒"; 
    } 
setInterval("createtime()",250);
</script>
</footer>
<script>setLoadingBarProgress(80);</script>



      <script>setLoadingBarProgress(60);</script>
    </div>
    <a class="s-top fas fa-arrow-up fa-fw" href='javascript:void(0)'></a>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>

  <script>
    var GOOGLE_CUSTOM_SEARCH_API_KEY = "";
    var GOOGLE_CUSTOM_SEARCH_ENGINE_ID = "";
    var ALGOLIA_API_KEY = "";
    var ALGOLIA_APP_ID = "";
    var ALGOLIA_INDEX_NAME = "";
    var AZURE_SERVICE_NAME = "";
    var AZURE_INDEX_NAME = "";
    var AZURE_QUERY_KEY = "";
    var BAIDU_API_ID = "";
    var SEARCH_SERVICE = "hexo" || "hexo";
    var ROOT = "/"||"/";
    if(!ROOT.endsWith('/'))ROOT += '/';
  </script>

<script src="//instant.page/1.2.2" type="module" integrity="sha384-2xV8M5griQmzyiY3CDqh1dn4z3llDVqZDqzjzcY+jCBCk/a5fXJmuZ/40JJAPeoU"></script>


  <script async src="https://cdn.jsdelivr.net/npm/scrollreveal@4.0.5/dist/scrollreveal.min.js"></script>
  <script type="text/javascript">
    $(function() {
      const $reveal = $('.reveal');
      if ($reveal.length === 0) return;
      const sr = ScrollReveal({ distance: 0 });
      sr.reveal('.reveal');
    });
  </script>


  <script src="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.js"></script>
  <script type="text/javascript">
    $(function() {
      Waves.attach('.flat-btn', ['waves-button']);
      Waves.attach('.float-btn', ['waves-button', 'waves-float']);
      Waves.attach('.float-btn-light', ['waves-button', 'waves-float', 'waves-light']);
      Waves.attach('.flat-box', ['waves-block']);
      Waves.attach('.float-box', ['waves-block', 'waves-float']);
      Waves.attach('.waves-image');
      Waves.init();
    });
  </script>


  <script async src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-busuanzi@2.3/js/busuanzi.pure.mini.js"></script>




  
  
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-backstretch/2.0.4/jquery.backstretch.min.js"></script>
    <script type="text/javascript">
      $(function(){
        if ('.cover') {
          $('.cover').backstretch(
          ["https://cdn.jsdelivr.net/gh/Hellotaogang/cdn@4.5.7/images/background_4.jpg", "https://cdn.jsdelivr.net/gh/Hellotaogang/cdn@4.5.7/images/background_5.jpg", "https://cdn.jsdelivr.net/gh/Hellotaogang/cdn@4.5.7/images/background_6.jpg"],
          {
            duration: "6000",
            fade: "2500"
          });
        } else {
          $.backstretch(
          ["https://cdn.jsdelivr.net/gh/Hellotaogang/cdn@4.5.7/images/background_4.jpg", "https://cdn.jsdelivr.net/gh/Hellotaogang/cdn@4.5.7/images/background_5.jpg", "https://cdn.jsdelivr.net/gh/Hellotaogang/cdn@4.5.7/images/background_6.jpg"],
          {
            duration: "6000",
            fade: "2500"
          });
        }
      });
    </script>
  







  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
  <script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js"></script>
  <script type="text/javascript">
    var gitalk = new Gitalk({
      clientID: "71020b6958cd6bbf65b7",
      clientSecret: "3cfeccd9125b8bac76f2bd8a7f6e30a601ae3a81",
      repo: "Hellotaogang.github.io",
      owner: "Hellotaogang",
      admin: "Hellotaogang",
      
        id: md5(location.pathname),      // Ensure uniqueness and length less than 50
      
      distractionFreeMode: false  // Facebook-like distraction free mode
    });
    gitalk.render('gitalk-container');
  </script>





  <script src="/js/app.js"></script>


  <script src="/js/search.js"></script>




<!-- 复制 -->
<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  let COPY_SUCCESS = "复制成功";
  let COPY_FAILURE = "复制失败";
  /*页面载入完成后，创建复制按钮*/
  !function (e, t, a) {
    /* code */
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '  <i class="fa fa-copy"></i><span>复制</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });

      clipboard.on('success', function(e) {
        //您可以加入成功提示
        console.info('Action:', e.action);
        console.info('Text:', e.text);
        console.info('Trigger:', e.trigger);
        success_prompt(COPY_SUCCESS);
        e.clearSelection();
      });
      clipboard.on('error', function(e) {
        //您可以加入失败提示
        console.error('Action:', e.action);
        console.error('Trigger:', e.trigger);
        fail_prompt(COPY_FAILURE);
      });
    }
    initCopyCode();

  }(window, document);

  /**
   * 弹出式提示框，默认1.5秒自动消失
   * @param message 提示信息
   * @param style 提示样式，有alert-success、alert-danger、alert-warning、alert-info
   * @param time 消失时间
   */
  var prompt = function (message, style, time)
  {
      style = (style === undefined) ? 'alert-success' : style;
      time = (time === undefined) ? 1500 : time*1000;
      $('<div>')
          .appendTo('body')
          .addClass('alert ' + style)
          .html(message)
          .show()
          .delay(time)
          .fadeOut();
  };

  // 成功提示
  var success_prompt = function(message, time)
  {
      prompt(message, 'alert-success', time);
  };

  // 失败提示
  var fail_prompt = function(message, time)
  {
      prompt(message, 'alert-danger', time);
  };

  // 提醒
  var warning_prompt = function(message, time)
  {
      prompt(message, 'alert-warning', time);
  };

  // 信息提示
  var info_prompt = function(message, time)
  {
      prompt(message, 'alert-info', time);
  };

</script>


<!-- fancybox -->
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
<script>
  let LAZY_LOAD_IMAGE = "";
  $(".article-entry").find("fancybox").find("img").each(function () {
      var element = document.createElement("a");
      $(element).attr("data-fancybox", "gallery");
      $(element).attr("href", $(this).attr("src"));
      /* 图片采用懒加载处理时,
       * 一般图片标签内会有个属性名来存放图片的真实地址，比如 data-original,
       * 那么此处将原本的属性名src替换为对应属性名data-original,
       * 修改如下
       */
       if (LAZY_LOAD_IMAGE) {
         $(element).attr("href", $(this).attr("data-original"));
       }
      $(this).wrap(element);
  });
</script>





  <script>setLoadingBarProgress(100);</script>
  <!-- 页面点击小红心 -->
  <!-- <script type="text/javascript" src="/js/love.js"></script> -->
  <!--单击显示文字-->
  <!-- <script type="text/javascript" src="/js/click_show_text.js"></script> -->
  <!-- 鼠标点击烟花 -->
  <!-- <canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" ></canvas> 
  <script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script> 
  <script type="text/javascript" src="/js/fireworks.js"></script> -->
  <!--浏览器搞笑标题-->
  <script type="text/javascript" src="\js\FunnyTitle.js"></script>
  <!--动态线条背景-->
  <script type="text/javascript"
color="0,0,0" opacity='0.7' zIndex="-2" count="200" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js">
  </script>
  <!-- 样式一（鼠标点击更换样式） -->
<!-- <script src="https://g.joyinshare.com/hc/ribbon.min.js" type="text/javascript"></script> -->
<!-- 样式二（飘动的彩带） -->
<!-- <script src="https://g.joyinshare.com/hc/piao.js" type="text/javascript"></script> -->
  <!-- 数字雨 -->
  <!-- <canvas id="canvas" width="1440" height="900" ></canvas>
  <script type="text/javascript" src="/js/DigitalRain.js"></script> -->
</body>
</html>
