<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  
  <title>Django项目之Web端电商网站的实战开发（五） | TG&#39;S BLOG</title>
  
  
  <meta name="description" content="该篇文章是博主一字一码编写的，实属不易，请尊重原创，谢谢大家！">
  

  

  <meta name="HandheldFriendly" content="True">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <!-- meta -->
  

  <!-- link -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.css">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.10.1/css/all.min.css">
  

  
  <link rel="shortcut icon" type="image/x-icon" href="https://cdn.jsdelivr.net/gh/Hellotaogang/cdn@4.3/images/favicon.ico">
  

  
    <link rel="stylesheet" href="/style.css">
  

  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>

  
  
</head>

<body>
  
  
  <div class="cover-wrapper">
    <cover class='cover post half'>
      
        
  <img class='logo' src='https://cdn.jsdelivr.net/gh/Hellotaogang/cdn@4.5.6/images/logo_2.png'/>


  <div class="m_search">
    <form name="searchform" class="form u-search-form">
      <input type="text" class="input u-search-input" placeholder="" />
      <i class="icon fas fa-search fa-fw"></i>
    </form>
  </div>

<div class='menu navgation'>
  <ul class='h-list'>
    
      
        <li>
          <a class="nav home" href="/"
            
            
            id="home">
            <i class='fas fa-home fa-fw'></i>&nbsp;主页
          </a>
        </li>
      
        <li>
          <a class="nav home" href="/categories/"
            
            
            id="categories">
            <i class='fas fa-folder-open fa-fw'></i>&nbsp;分类
          </a>
        </li>
      
        <li>
          <a class="nav home" href="/tags/"
            
              rel="nofollow"
            
            
            id="tags">
            <i class='fas fa-tags fa-fw'></i>&nbsp;标签
          </a>
        </li>
      
        <li>
          <a class="nav home" href="/love/"
            
              rel="nofollow"
            
            
            id="love">
            <i class='fas fa-heart fa-fw'></i>&nbsp;记录
          </a>
        </li>
      
        <li>
          <a class="nav home" href="/about/"
            
              rel="nofollow"
            
            
            id="about">
            <i class='fas fa-info-circle fa-fw'></i>&nbsp;关于
          </a>
        </li>
      
    
  </ul>
</div>

      
    </cover>
    <header class="l_header pure">
  <div id="loading-bar-wrapper">
    <div id="loading-bar" class="pure"></div>
  </div>

	<div class='wrapper'>
		<div class="nav-main container container--flex">
      <a class="logo flat-box" href='/' >
        
          TG'S BLOG
        
      </a>
			<div class='menu navgation'>
				<ul class='h-list'>
          
  					
  						<li>
								<a class="nav flat-box" href="/"
                  
                  
                  id="home">
									<i class='fas fa-home fa-fw'></i>&nbsp;主页
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/categories/"
                  
                    rel="nofollow"
                  
                  
                  id="categories">
									<i class='fas fa-folder-open fa-fw'></i>&nbsp;分类
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/tags/"
                  
                    rel="nofollow"
                  
                  
                  id="tags">
									<i class='fas fa-tags fa-fw'></i>&nbsp;标签
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/archives/"
                  
                    rel="nofollow"
                  
                  
                  id="archives">
									<i class='fas fa-archive fa-fw'></i>&nbsp;归档
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/love/"
                  
                    rel="nofollow"
                  
                  
                  id="love">
									<i class='fas fa-heart fa-fw'></i>&nbsp;记录
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/about/"
                  
                    rel="nofollow"
                  
                  
                  id="about">
									<i class='fas fa-info-circle fa-fw'></i>&nbsp;关于
								</a>
							</li>
      			
      		
				</ul>
			</div>

			
				<div class="m_search">
					<form name="searchform" class="form u-search-form">
						<input type="text" class="input u-search-input" placeholder="搜索" />
						<i class="icon fas fa-search fa-fw"></i>
					</form>
				</div>
			
			<ul class='switcher h-list'>
				
					<li class='s-search'><a class="fas fa-search fa-fw" href='javascript:void(0)'></a></li>
				
				<li class='s-menu'><a class="fas fa-bars fa-fw" href='javascript:void(0)'></a></li>
			</ul>
		</div>

		<div class='nav-sub container container--flex'>
			<a class="logo flat-box"></a>
			<ul class='switcher h-list'>
				<li class='s-comment'><a class="flat-btn fas fa-comments fa-fw" href='javascript:void(0)'></a></li>
        
          <li class='s-toc'><a class="flat-btn fas fa-list fa-fw" href='javascript:void(0)'></a></li>
        
			</ul>
		</div>
	</div>
</header>
	<aside class="menu-phone">
    <header>
		<nav class="menu navgation">
      <ul>
        
          
            <li>
							<a class="nav flat-box" href="/"
                
                
                id="home">
								<i class='fas fa-clock fa-fw'></i>&nbsp;近期文章
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/blog/archives/"
                
                  rel="nofollow"
                
                
                id="blogarchives">
								<i class='fas fa-archive fa-fw'></i>&nbsp;文章归档
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/projects/"
                
                
                id="projects">
								<i class='fas fa-code-branch fa-fw'></i>&nbsp;开源项目
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/friends/"
                
                  rel="nofollow"
                
                
                id="friends">
								<i class='fas fa-link fa-fw'></i>&nbsp;我的友链
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="https://xaoxuu.com/wiki/material-x/"
                
                  rel="nofollow"
                
                
                id="https:xaoxuu.comwikimaterial-x">
								<i class='fas fa-book fa-fw'></i>&nbsp;主题文档
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/about/"
                
                  rel="nofollow"
                
                
                id="about">
								<i class='fas fa-info-circle fa-fw'></i>&nbsp;关于小站
							</a>
            </li>
          
       
      </ul>
		</nav>
    </header>
	</aside>
<script>setLoadingBarProgress(40);</script>

  </div>


  <div class="l_body">
    <div class='body-wrapper'>
      <div class='l_main'>
  

  <article id="post" class="post white-box article-type-post" itemscope itemprop="blogPost">
    


  <section class='meta'>
    
    
      <a title='Django项目之Web端电商网站的实战开发（五）' href='/2019/11/07/Django项目之Web端电商网站的实战开发（五）/'><img class='thumbnail' src='https://cdn.jsdelivr.net/gh/Hellotaogang/cdn@4.6.2/images/django.png'></a>
    
    <div class="meta" id="header-meta">
      
        
  
    <h1 class="title">
      <a href="/2019/11/07/Django项目之Web端电商网站的实战开发（五）/">
        Django项目之Web端电商网站的实战开发（五）
      </a>
    </h1>
  


      
      <div class='new-meta-box'>
        
          
        
          
            
  <div class='new-meta-item author'>
    
      <a href="/" rel="nofollow">
        
          <img src="https://cdn.jsdelivr.net/gh/Hellotaogang/cdn@4.4.3/images/avatar_4.png">
        
        <p>cdtaogang</p>
      </a>
    
  </div>


          
        
          
            <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt" aria-hidden="true"></i>
    <p>2019-11-07</p>
  </a>
</div>

          
        
          
            
  
  <div class='new-meta-item category'>
    <a href='/categories/Django开发/' rel="nofollow">
      <i class="fas fa-folder-open" aria-hidden="true"></i>
      <p>Django开发</p>
    </a>
  </div>


          
        
          
            
  
    <div class="new-meta-item browse busuanzi">
      <a class='notlink'>
        <i class="fas fa-eye" aria-hidden="true"></i>
        <p>
          <span id="busuanzi_value_page_pv">
            <i class="fas fa-spinner fa-spin fa-fw" aria-hidden="true"></i>
          </span>
        </p>
      </a>
    </div>
  


          
        
          
            

          
        
      </div>
      
        <hr>
      
    </div>
  </section>


    <section class="article typo">
      <div class="article-entry" itemprop="articleBody">
        <p>该篇文章是博主一字一码编写的，实属不易，请尊重原创，谢谢大家！<br><font style="color:red">温馨提示：需要项目源码的朋友，请添加博主微信进行获取！</font></p>
<div style="color:#fb651b"><i class="fas fa-list fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;本文目录</div>
<li class="toc-item toc-level-1"><a style=" text-decoration:none;" href="#一丶天天生鲜详情页"><span style="color:#4ea1db">一丶天天生鲜详情页</span></a></li>
<li class="toc-item toc-level-1"><a style=" text-decoration:none;" href="#二丶天天生鲜列表页"><span style="color:#4ea1db">二丶天天生鲜列表页</span></a></li>
<li class="toc-item toc-level-1"><a style=" text-decoration:none;" href="#三丶天天生鲜商品搜索"><span style="color:#4ea1db">三丶天天生鲜商品搜索</span></a></li>
<li class="toc-item toc-level-1"><a style=" text-decoration:none;" href="#四丶添加商品到购物车"><span style="color:#4ea1db">四丶添加商品到购物车</span></a></li>
<li class="toc-item toc-level-1"><a style=" text-decoration:none;" href="#五丶天天生鲜我的购物车页"><span style="color:#4ea1db">五丶天天生鲜我的购物车页</span></a></li>
<a id="more"></a>

<h1 id="一丶天天生鲜详情页"><a href="#一丶天天生鲜详情页" class="headerlink" title="一丶天天生鲜详情页"></a>一丶天天生鲜详情页</h1><p>1.显示商品详情页</p>
<ul>
<li><strong>step1</strong> 在df_goods/views中定义类视图get方法渲染详情页模板</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /goods/商品id</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DetailView</span><span class="params">(View)</span>:</span></span><br><span class="line">    <span class="string">"""详情页"""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request, goods_id)</span>:</span></span><br><span class="line">        <span class="string">"""显示商品详情页"""</span></span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">"detail.html"</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step2</strong> 在df_goos/urls中定义详情页路由</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url(<span class="string">r"^goods/(?P&lt;goods_id&gt;\d+)$"</span>, DetailView.as_view(), name=<span class="string">"detail"</span>),  <span class="comment"># 详情页</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step3</strong> 在浏览器直接输入</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190404113053764.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<p>2.获取商品详情页信息</p>
<ul>
<li><strong>step1</strong> 根据商品goods_id,获取商品信息，如果查询不到则返回首页</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    sku = GoodsSKU.objects.get(id=goods_id)</span><br><span class="line"><span class="keyword">except</span> GoodsSKU.DoesNotExist:</span><br><span class="line">    <span class="comment"># 此goods_id的商品不存在</span></span><br><span class="line">    <span class="keyword">return</span> redirect(reverse(<span class="string">"goods:index"</span>))</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step2</strong>  获取所有的商品类型</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">types = GoodsType.objects.all()</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step3</strong> 从订单模块中根据查询到的sku对象查询出评论不为空的评论信息</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sku_orders_comment = OrderGoods.objects.filter(sku=sku).exclude(comment=<span class="string">''</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step4</strong> 根据查询到的商品sku对象获取商品信息按照创建时间进行倒序排序并且只显示最前面两个</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">new_skus = GoodsSKU.objects.filter(type=sku.type).order_by(<span class="string">'-create_time'</span>)[:<span class="number">2</span>]</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step5</strong> 获取用户购物车中商品的数目</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取用户购物车中商品的数目</span></span><br><span class="line">user = request.user  <span class="comment"># 获取user对象</span></span><br><span class="line">cart_count = <span class="number">0</span>  <span class="comment"># 默认设置为0</span></span><br><span class="line"><span class="comment"># 获取商品详情页中的购物车数目信息</span></span><br><span class="line"><span class="keyword">if</span> user.is_authenticated():  <span class="comment"># 如果返回True表示用户已登录</span></span><br><span class="line">    <span class="comment"># 用户已登录</span></span><br><span class="line">    conn = get_redis_connection(<span class="string">'default'</span>)  <span class="comment"># 获取配置中default默认redis连接对象</span></span><br><span class="line">    cart_key = <span class="string">'cart_%d'</span> % user.id  <span class="comment"># 设置key</span></span><br><span class="line">    <span class="comment"># 通过hlen方法获取购物车商品数目</span></span><br><span class="line">    cart_count = conn.hlen(cart_key)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step6</strong> 定义模板上下文，并返回</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义模板上下问</span></span><br><span class="line">content = &#123;<span class="string">"types"</span>:types, <span class="string">"sku"</span>:sku,</span><br><span class="line">           <span class="string">"sku_orders_comment"</span>:sku_orders_comment,</span><br><span class="line">           <span class="string">"new_skus"</span>:new_skus, <span class="string">"cart_count"</span>:cart_count&#125;</span><br><span class="line"><span class="keyword">return</span> render(request, <span class="string">"detail.html"</span>, content)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step7</strong> 在商品详情页父模板base_detail_list.html中，获取全部分类信息</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"subnav"</span>&gt;</span></span><br><span class="line">    &#123;% for type in types %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'goods:list' type.id 1 %&#125;"</span> <span class="attr">class</span>=<span class="string">"&#123;&#123; type.logo &#125;&#125;"</span>&gt;</span>&#123;&#123; type.name &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step8</strong> 在商品详情页detail.html模板中进行数据填坑</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"breadcrumb"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>全部分类<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>&gt;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>&#123;&#123; sku.type.name &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>&gt;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>商品详情<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"goods_detail_con clearfix"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"goods_detail_pic fl"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"&#123;&#123; sku.image.url &#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"goods_detail_list fr"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;&#123; sku.name &#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; sku.desc &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"prize_bar"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"show_pirze"</span>&gt;</span>¥<span class="tag">&lt;<span class="name">em</span>&gt;</span>&#123;&#123; sku.price &#125;&#125;<span class="tag">&lt;/<span class="name">em</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"show_unit"</span>&gt;</span>单  位：&#123;&#123; sku.unite &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"goods_num clearfix"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"num_name fl"</span>&gt;</span>数 量：<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"num_add fl"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"num_show fl"</span> <span class="attr">value</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:;"</span> <span class="attr">class</span>=<span class="string">"add fr"</span>&gt;</span>+<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:;"</span> <span class="attr">class</span>=<span class="string">"minus fr"</span>&gt;</span>-<span class="tag">&lt;/<span class="name">a</span>&gt;</span>   </span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"total"</span>&gt;</span>总价：<span class="tag">&lt;<span class="name">em</span>&gt;</span>16.80元<span class="tag">&lt;/<span class="name">em</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"operate_btn"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:;"</span> <span class="attr">class</span>=<span class="string">"buy_btn"</span>&gt;</span>立即购买<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:;"</span> <span class="attr">class</span>=<span class="string">"add_cart"</span> <span class="attr">id</span>=<span class="string">"add_cart"</span>&gt;</span>加入购物车<span class="tag">&lt;/<span class="name">a</span>&gt;</span>             </span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"main_wrap clearfix"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"l_wrap fl clearfix"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"new_goods"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h3</span>&gt;</span>新品推荐<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">                &#123;% for sku in new_skus %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'goods:detail' sku.id %&#125;"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"&#123;&#123; sku.image.url &#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">h4</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'goods:detail' sku.id %&#125; "</span>&gt;</span>&#123;&#123; sku.name &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"prize"</span>&gt;</span>￥&#123;&#123; sku.price &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                &#123;% endfor %&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"r_wrap fr clearfix"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"detail_tab clearfix"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"active"</span>&gt;</span>商品介绍<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>评论<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"tab_content"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dl</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">dt</span>&gt;</span>商品详情：<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">dd</span>&gt;</span>&#123;&#123; sku.goods.detail |safe &#125;&#125;<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"tab_content"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dl</span>&gt;</span></span><br><span class="line">                &#123;% for comment in sku_orders_comment %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">dt</span>&gt;</span>评论时间：&#123;&#123; comment.update_time &#125;&#125;&amp;nbsp;&amp;nbsp;&#123;&#123; comment.order.user.username &#125;&#125;<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">dd</span>&gt;</span>评论内容：&#123;&#123; comment.comment |safe &#125;&#125;<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">                &#123;% endfor %&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step9</strong> 在首页index.html中对商品详情链接地址进行数据填坑</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"center_con clearfix"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"subnav fl"</span>&gt;</span></span><br><span class="line">        &#123;% for type in types %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#model0&#123;&#123; forloop.counter &#125;&#125;"</span> <span class="attr">class</span>=<span class="string">"&#123;&#123; type.logo &#125;&#125;"</span>&gt;</span>&#123;&#123; type.name &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"slide fl"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"slide_pics"</span>&gt;</span></span><br><span class="line">            &#123;% for banner in goods_banners %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'goods:detail' banner.sku.id %&#125;"</span> &gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"&#123;&#123; banner.image.url &#125;&#125;"</span> <span class="attr">alt</span>=<span class="string">"幻灯片"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span>/li&gt;</span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"prev"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"next"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"points"</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"adv fl"</span>&gt;</span></span><br><span class="line">        &#123;% for banner in promotion_banners %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;&#123; banner.url &#125;&#125;"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"&#123;&#123; banner.image.url &#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% for type in types %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"list_model"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"list_title clearfix"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">"fl"</span> <span class="attr">id</span>=<span class="string">"model&#123;&#123; forloop.counter &#125;&#125;"</span>&gt;</span>&#123;&#123; type.name &#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"subtitle fl"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span>&gt;</span>|<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            &#123;% for banner in type.title_banners %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'goods:detail' banner.sku.id %&#125;"</span>&gt;</span>&#123;&#123; banner.sku.name &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">class</span>=<span class="string">"goods_more fr"</span> <span class="attr">id</span>=<span class="string">"fruit_more"</span>&gt;</span>查看更多 &gt;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"goods_con clearfix"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"goods_banner fl"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"&#123;&#123; type.image.url &#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"goods_list fl"</span>&gt;</span></span><br><span class="line">            &#123;% for banner in type.image_banners %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">h4</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'goods:detail' banner.sku.id %&#125;"</span>&gt;</span>&#123;&#123; banner.sku.name &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'goods:detail' banner.sku.id %&#125;"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"&#123;&#123; banner.sku.image.url &#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"prize"</span>&gt;</span>¥ &#123;&#123; banner.sku.price &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step10</strong> 测试</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190404135745795.gif" alt></fancybox></p>
<p>3.添加历史浏览记录</p>
<ul>
<li><strong>step1</strong> 当用户点击某个商品，进入商品商品详情页面时，将该商品id保存到redis数据库中，在用户中心页面个人信息页面进行显示</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加用户中心历史浏览记录</span></span><br><span class="line">history_key = <span class="string">"history_%d"</span>% user.id</span><br><span class="line"><span class="comment"># 当用户进入该goods_id的商品详情页时，则将之前redis数据中的的此goods_id的商品移除</span></span><br><span class="line">conn.lrem(history_key, <span class="number">0</span>, goods_id)</span><br><span class="line"><span class="comment"># 将此goods_id的商品排到浏览记录列表的左侧</span></span><br><span class="line">conn.lpush(history_key, goods_id)</span><br><span class="line"><span class="comment"># 最多只保存5条浏览记录</span></span><br><span class="line">conn.ltrim(history_key, <span class="number">0</span> ,<span class="number">4</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step2</strong> 测试用户历史浏览记录</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190404144215585.gif" alt></fancybox></p>
<ul>
<li><strong>step3</strong> 查看redis数据库以及mysql数据库</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190404145424206.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<p>4.在商品详情页添加其他规格的商品</p>
<ul>
<li><strong>step1</strong> 在DetailView类视图get方法中进行获取，获取同一个spu的其他规格的商品,不显示当前的商品</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">same_spu_skus = GoodsSKU.objects.filter(goods=sku.goods).exclude(id=goods_id)</span><br><span class="line"> </span><br><span class="line">content = &#123;<span class="string">"types"</span>:types, <span class="string">"sku"</span>:sku,</span><br><span class="line">           <span class="string">"sku_orders_comment"</span>:sku_orders_comment,</span><br><span class="line">           <span class="string">"same_spu_skus"</span>:same_spu_skus,</span><br><span class="line">           <span class="string">"new_skus"</span>:new_skus, <span class="string">"cart_count"</span>:cart_count&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step2</strong> 在detail.html模板中添加其他规格的标签，并进行数据填坑</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>其他规格:<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        &#123;% for sku in same_spu_skus %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'goods:detail' sku.id %&#125;"</span>&gt;</span>&#123;&#123; sku.name &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step3</strong> 测试显示不同规格的商品</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190404153025493.gif" alt></fancybox></p>
<p>5.添加详情计算商品总价js代码 </p>
<ul>
<li><strong>step1</strong> 获取商品总价</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取商品总价</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_goods_amount</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    price = $(<span class="string">'.show_pirze'</span>).children(<span class="string">'em'</span>).text(); <span class="comment">//商品单价</span></span><br><span class="line">    count = $(<span class="string">'.num_show'</span>).val();  <span class="comment">//商品数量</span></span><br><span class="line">    <span class="comment">// 计算商品总价</span></span><br><span class="line">    price = <span class="built_in">parseFloat</span>(price);</span><br><span class="line">    count = <span class="built_in">parseInt</span>(count);</span><br><span class="line">    amount = price*count;</span><br><span class="line">    <span class="comment">// 显示总价价格</span></span><br><span class="line">    $(<span class="string">'.total'</span>).children(<span class="string">'em'</span>).text(amount.toFixed(<span class="number">2</span>)+<span class="string">'元'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step2</strong> 添加商品数量</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 增加商品数量</span></span><br><span class="line">$(<span class="string">'.add'</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="comment">// 获取商品原有的数量并加1</span></span><br><span class="line">   count = $(<span class="string">'.num_show'</span>).val();</span><br><span class="line">   count = <span class="built_in">parseInt</span>(count)+<span class="number">1</span>;</span><br><span class="line">   <span class="comment">// 重新显示商品数量</span></span><br><span class="line">   $(<span class="string">'.num_show'</span>).val(count);</span><br><span class="line">   <span class="comment">// 更新商品总价</span></span><br><span class="line">   get_goods_amount();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step3</strong> 减少商品数量</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'.minus'</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="comment">// 获取商品原有的数量并减1</span></span><br><span class="line">   count = $(<span class="string">'.num_show'</span>).val();</span><br><span class="line">   count = <span class="built_in">parseInt</span>(count)<span class="number">-1</span>;</span><br><span class="line">   <span class="keyword">if</span>(count&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">       count=<span class="number">1</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">// 重新显示商品数量</span></span><br><span class="line">   $(<span class="string">'.num_show'</span>).val(count);</span><br><span class="line">   <span class="comment">// 更新商品总价</span></span><br><span class="line">   get_goods_amount();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step4</strong> 手动输入商品数量</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 手动输入商品数量</span></span><br><span class="line">$(<span class="string">'.num_show'</span>).blur(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="comment">// 获取输入的商品数量</span></span><br><span class="line">   count = $(<span class="keyword">this</span>).val();</span><br><span class="line">   <span class="comment">// 校验用户输入的商品数量是否合法</span></span><br><span class="line">   <span class="keyword">if</span>(<span class="built_in">isNaN</span>(count) || count.trim().length==<span class="number">0</span> || <span class="built_in">parseInt</span>(count) &lt;=<span class="number">0</span>)&#123;</span><br><span class="line">       count=<span class="number">1</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">// 设置用户输入的商品数目</span></span><br><span class="line">   $(<span class="keyword">this</span>).val(<span class="built_in">parseInt</span>(count));</span><br><span class="line">   <span class="comment">// 更新商品总价</span></span><br><span class="line">   get_goods_amount()</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step5</strong> 效果演示</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190405141528572.gif" alt></fancybox></p>
<h1 id="二丶天天生鲜列表页"><a href="#二丶天天生鲜列表页" class="headerlink" title="二丶天天生鲜列表页"></a>二丶天天生鲜列表页</h1><p>1.显示商品列表页</p>
<ul>
<li><strong>step1</strong> 在df_goods/views中定义类视图get方法，显示列表页</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /list/商品种类id/页码?sort=排序方式</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ListView</span><span class="params">(View)</span>:</span></span><br><span class="line">    <span class="string">"""商品列表页"""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request, type_id, page)</span>:</span></span><br><span class="line">        <span class="string">"""显示商品列表页"""</span></span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">"list.html"</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step2</strong> 在df_goods/urls中定义url路由</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url(<span class="string">r"^list/(?P&lt;type_id&gt;\d+)/(?P&lt;page&gt;\d+)$"</span>, ListView.as_view(), name=<span class="string">"list"</span>), <span class="comment"># 列表页</span></span><br></pre></td></tr></table></figure>

<p>2.获取商品列表页内容</p>
<ul>
<li><strong>step1</strong> 获取商品种类信息</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取商品种类信息</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    type = GoodsType.objects.get(id=type_id)</span><br><span class="line"><span class="keyword">except</span> GoodsType.DoesNotExist:</span><br><span class="line">    <span class="string">"""商品种类不存在返回主页"""</span></span><br><span class="line">    <span class="keyword">return</span> redirect(reverse(<span class="string">"goods:index"</span>))</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step2</strong> 获取全部商品分类信息</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">types = GoodsType.objects.all()</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step3</strong> 获取排序的方式 sort=default 默认id排序 price 价格排序 hot 商品销量</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sort = request.GET.get(<span class="string">"sort"</span>)</span><br><span class="line"><span class="keyword">if</span> sort == <span class="string">"price"</span>:</span><br><span class="line">    skus = GoodsSKU.objects.filter(type=type).order_by(<span class="string">"price"</span>)</span><br><span class="line"><span class="keyword">elif</span> sort == <span class="string">"hot"</span>:</span><br><span class="line">    skus = GoodsSKU.objects.filter(type=type).order_by(<span class="string">"-sales"</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="comment"># 其他的通通按照默认排序</span></span><br><span class="line">    sort = <span class="string">"default"</span></span><br><span class="line">    skus = GoodsSKU.objects.filter(type=type).order_by(<span class="string">"-id"</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step4</strong> 对数据进行分页</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">paginator = Paginator(skus, <span class="number">5</span>)  <span class="comment"># Show 25 contacts per page</span></span><br><span class="line"><span class="comment"># 获取页数</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    page = int(page)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    page = <span class="number">1</span></span><br><span class="line"><span class="comment"># 判断用户传递过来的页数，是否小于总页数，大于总页数则设置第一页</span></span><br><span class="line"><span class="keyword">if</span> page &gt; paginator.num_pages:</span><br><span class="line">    page = <span class="number">1</span></span><br><span class="line"> </span><br><span class="line">skus_page = paginator.page(page)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step5</strong> 获取新品推荐信息，根据查询到的商品sku对象获取商品信息按照创建时间进行倒序排序并且只显示最前面两个</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">new_skus = GoodsSKU.objects.filter(type=type).order_by(<span class="string">'-create_time'</span>)[:<span class="number">2</span>]</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step6</strong> 获取用户购物车中商品的数目</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">user = request.user  <span class="comment"># 获取user对象</span></span><br><span class="line">cart_count = <span class="number">0</span>  <span class="comment"># 默认设置为0</span></span><br><span class="line"><span class="keyword">if</span> user.is_authenticated():  <span class="comment"># 如果返回True表示用户已登录</span></span><br><span class="line">    <span class="comment"># 用户已登录</span></span><br><span class="line">    conn = get_redis_connection(<span class="string">'default'</span>)  <span class="comment"># 获取配置中default默认redis连接对象</span></span><br><span class="line">    cart_key = <span class="string">'cart_%d'</span> % user.id  <span class="comment"># 设置key</span></span><br><span class="line">    <span class="comment"># 通过hlen方法获取购物车商品数目</span></span><br><span class="line">    cart_count = conn.hlen(cart_key)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step7</strong> 定义模板上下文，并返回</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">context = &#123;</span><br><span class="line">    <span class="string">"type"</span>:type,<span class="string">"types"</span>:types,</span><br><span class="line">    <span class="string">"skus_page"</span>:skus_page,<span class="string">"new_skus"</span>:new_skus,</span><br><span class="line">    <span class="string">"cart_count"</span>:cart_count,<span class="string">"sort"</span>:sort</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">return</span> render(request, <span class="string">"list.html"</span>, context)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step8</strong> 在list.html模板文件中进行数据填坑</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"breadcrumb"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>全部分类<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>&gt;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>&#123;&#123; type.name &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"main_wrap clearfix"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"l_wrap fl clearfix"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"new_goods"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h3</span>&gt;</span>新品推荐<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">                &#123;% for sku in new_skus %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'goods:detail' sku.id %&#125;"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"&#123;&#123; sku.image.url &#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">h4</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'goods:detail' sku.id %&#125;"</span>&gt;</span>&#123;&#123; sku.name &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"prize"</span>&gt;</span>￥&#123;&#123; sku.price &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                &#123;% endfor %&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"r_wrap fr clearfix"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sort_bar"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'goods:list' type.id 1 %&#125;"</span> &#123;% <span class="attr">if</span> <span class="attr">sort</span> == <span class="string">"default"</span> %&#125;<span class="attr">class</span>=<span class="string">"active"</span>&#123;% <span class="attr">endif</span> %&#125;&gt;</span>默认<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'goods:list' type.id 1 %&#125;?sort=price"</span> &#123;% <span class="attr">if</span> <span class="attr">sort</span> == <span class="string">"price"</span> %&#125;<span class="attr">class</span>=<span class="string">"active"</span>&#123;% <span class="attr">endif</span> %&#125;&gt;</span>价格<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'goods:list' type.id 1 %&#125;?sort=hot"</span> &#123;% <span class="attr">if</span> <span class="attr">sort</span> == <span class="string">"hot"</span> %&#125;<span class="attr">class</span>=<span class="string">"active"</span>&#123;% <span class="attr">endif</span> %&#125;&gt;</span>人气<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"goods_type_list clearfix"</span>&gt;</span></span><br><span class="line">            &#123;% for sku in skus_page %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'goods:detail' sku.id %&#125;"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"&#123;&#123; sku.image.url &#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">h4</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'goods:detail' sku.id %&#125;"</span>&gt;</span>&#123;&#123; sku.name &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"operate"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"prize"</span>&gt;</span>￥&#123;&#123; sku.price &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"unit"</span>&gt;</span>&#123;&#123; sku.price &#125;&#125;/&#123;&#123; sku.unite &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">class</span>=<span class="string">"add_goods"</span> <span class="attr">title</span>=<span class="string">"加入购物车"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"pagenation"</span>&gt;</span></span><br><span class="line">            &#123;% if skus_page.has_previous %&#125;</span><br><span class="line">            &lt;a href="&#123;% url 'goods:list' type.id skus_page.previous_page_number %&#125;?sort=&#123;&#123; sort &#125;&#125;"&gt;&lt;上一页&lt;/a&gt;</span><br><span class="line">            &#123;% endif %&#125;</span><br><span class="line">            &#123;% for pindex in skus_page.paginator.page_range %&#125;</span><br><span class="line">                &#123;% if pindex == skus_page.number %&#125;</span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'goods:list' type.id pindex %&#125;?sort=&#123;&#123; sort &#125;&#125;"</span> <span class="attr">class</span>=<span class="string">"active"</span>&gt;</span>&#123;&#123; pindex &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                &#123;% else %&#125;</span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'goods:list' type.id pindex %&#125;?sort=&#123;&#123; sort &#125;&#125;"</span>&gt;</span>&#123;&#123; pindex &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                &#123;% endif %&#125;</span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">            &#123;% if skus_page.has_next %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'goods:list' type.id skus_page.next_page_number %&#125;?sort=&#123;&#123; sort &#125;&#125;"</span>&gt;</span>下一页&gt;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            &#123;% endif %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step9</strong> 测试列表页</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190404181005650.gif" alt></fancybox></p>
<p>3.列表页分页页码控制（只显示5个页数）</p>
<ul>
<li><strong>step1</strong> 当总页数小于5页时，页面上显示所有页码（1~5页都显示），当总页数大于5页时，那么判断当前页如果是前3页，显示1-5页，如果当前页是后3页，显示总页数最后5页；如果当前页不是第3页时，即显示当前页的前2页 当前页  当前页最后2页 </li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">num_pages = paginator.num_pages</span><br><span class="line"><span class="keyword">if</span> num_pages &lt; <span class="number">5</span>:</span><br><span class="line">    pages = range(<span class="number">1</span>, num_pages + <span class="number">1</span>)</span><br><span class="line"><span class="keyword">elif</span> page &lt;= <span class="number">3</span>:</span><br><span class="line">    pages = range(<span class="number">1</span>, <span class="number">6</span>)</span><br><span class="line"><span class="keyword">elif</span> num_pages - page &lt;= <span class="number">2</span>:</span><br><span class="line">    pages = range(num_pages - <span class="number">4</span>, num_pages + <span class="number">1</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    pages = range(page - <span class="number">2</span>, page + <span class="number">3</span>)</span><br><span class="line">context = &#123;</span><br><span class="line">    <span class="string">"type"</span>:type,<span class="string">"types"</span>:types,</span><br><span class="line">    <span class="string">"skus_page"</span>:skus_page,<span class="string">"new_skus"</span>:new_skus,</span><br><span class="line">    <span class="string">"cart_count"</span>:cart_count,<span class="string">"sort"</span>:sort,</span><br><span class="line">    <span class="string">"pages"</span>:pages</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step2</strong> 替换list.html模板文件中的{% for pindex in skus_page.paginator.page_range %}为pages即可</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for pindex in pages %&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step3</strong> 为了演示分页页码显示效果，博主设置每页显示商品2个，因为博主添加的商品不足够多</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190404185058678.gif" alt></fancybox></p>
<ul>
<li><strong>step4</strong> 修改主页中的查看更多链接地址 ,跳转到丢应商品种类的列表页，sort不传表示默认排序方式</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'goods:list' type.id 1 %&#125;"</span> <span class="attr">class</span>=<span class="string">"goods_more fr"</span> <span class="attr">id</span>=<span class="string">"fruit_more"</span>&gt;</span>查看更多 &gt;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step5</strong> 效果显示</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190405143410686.gif" alt></fancybox></p>
<h1 id="三丶天天生鲜商品搜索"><a href="#三丶天天生鲜商品搜索" class="headerlink" title="三丶天天生鲜商品搜索"></a>三丶天天生鲜商品搜索</h1><p>1.全文检索框架以及搜索引擎安装配置</p>
<p>全文检索不同于特定字段的模糊查询，使用全文检索的效率更高，并且能够对于中文进行分词处理。</p>
<p><strong>haystack</strong>：全文检索的框架，支持whoosh、solr、Xapian、Elasticsearc四种全文检索引擎，点击查看官方网站。</p>
<p><strong>whoosh</strong>：纯Python编写的全文搜索引擎，虽然性能比不上sphinx、xapian、Elasticsearc等，但是无二进制包，程序不会莫名其妙的崩溃，对于小型的站点，whoosh已经足够使用，点击查看whoosh文档。</p>
<p><strong>jieba</strong>：一款免费的中文分词包，如果觉得不好用可以使用一些收费产品。</p>
<ul>
<li><strong>step1</strong> 使用haystack全文检索的框架，配合whoosh搜索引擎进行数据搜索，安装django-haystack以及whoosh</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install django-haystack</span><br><span class="line">pip install whoosh</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step2</strong> 在settings中添加haystack应用以及配置haystack框架</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 全文检索haystack框架配置</span></span><br><span class="line">HAYSTACK_CONNECTIONS = &#123;</span><br><span class="line">    <span class="string">'default'</span>: &#123;</span><br><span class="line">        <span class="comment"># 使用whoosh引擎</span></span><br><span class="line">        <span class="string">'ENGINE'</span>: <span class="string">'haystack.backends.whoosh_backend.WhooshEngine'</span>,</span><br><span class="line">        <span class="comment"># 索引文件路径</span></span><br><span class="line">        <span class="string">'PATH'</span>: os.path.join(BASE_DIR, <span class="string">'whoosh_index'</span>),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 当数据库表 添加、修改、删除数据时，自动生成索引</span></span><br><span class="line">HAYSTACK_SIGNAL_PROCESSOR = <span class="string">'haystack.signals.RealtimeSignalProcessor'</span></span><br></pre></td></tr></table></figure>

<p>2.创建引擎及索引</p>
<ul>
<li><strong>step1</strong> 在网站搜索框中搜索商品是对df_goods_sku表数据的搜索，即在df_goods模块下创建search_indexes.py文件，并在此文件中创建引擎和索引（固定写法和用法）</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> haystack <span class="keyword">import</span> indexes</span><br><span class="line"><span class="keyword">from</span> df_goods.models <span class="keyword">import</span> GoodsSKU  <span class="comment"># 指定对于某个类的某些数据建立索引</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GoodsSKUIndex</span><span class="params">(indexes.SearchIndex, indexes.Indexable)</span>:</span></span><br><span class="line">    text = indexes.CharField(document=<span class="literal">True</span>, use_template=<span class="literal">True</span>)  <span class="comment"># 索引字段</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># 获取模型类</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_model</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># 返回模型类</span></span><br><span class="line">        <span class="keyword">return</span> GoodsSKU</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># 建立索引数据</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">index_queryset</span><span class="params">(self, using=None)</span>:</span></span><br><span class="line">        <span class="comment"># 返回该模型的所有数据</span></span><br><span class="line">        <span class="keyword">return</span> self.get_model().objects.all()</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step2</strong> 在templates模板目录下创建search/indexes/df_goods/goodssku_text.txt文件（search/indexes/模块名/模型类_text.txt固定写法），并在goodssku_text.txt文件中，指定哪些表字段用于创建索引</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190405104751545.png" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 指定数据库表中哪些字段来建立索引</span><br><span class="line">&#123;&#123;object.name&#125;&#125;  # 商品名称</span><br><span class="line">&#123;&#123;object.desc&#125;&#125;  # 商品简介</span><br><span class="line">&#123;&#123;object.goods.detail&#125;&#125;  # 商品详情</span><br></pre></td></tr></table></figure>

<p>3.生成索引文件</p>
<ul>
<li><strong>step1</strong> 执行命令python2 manage.py rebuild_index，生成指定模型类df_goods_sku索引文件，生成成功显示出商品的个数</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190405105019838.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<ul>
<li><strong>step2</strong> 查看数据库中df_goods_sku表有多少个商品</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190405105304600.png" alt></p>
<ul>
<li><strong>step3</strong> 在settings配置中索引文件的路径为’PATH’: os.path.join(BASE_DIR, ‘whoosh_index’)，也就是项目目录下的whoosh_index目录，此时查看项目目录下已经成功创建该目录，并在该目录下生成了df_goods_sku表的索引文件</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190405105632972.png" alt></p>
<p>4.全文检索的使用</p>
<ul>
<li><strong>step1</strong> 在base.html模板文件中找到搜索框，进行如下编写，需要注意的是表单提交的方法为get以及text input输入框的name必须为q，这两个为固定的</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"get"</span> <span class="attr">action</span>=<span class="string">"/search"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"input_text fl"</span> <span class="attr">name</span>=<span class="string">"q"</span> <span class="attr">placeholder</span>=<span class="string">"搜索商品"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"input_btn fr"</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">"搜索"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step2</strong> 在根基urls文件中，配置全文检索框架</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url(<span class="string">r'^search'</span>, include(<span class="string">'haystack.urls'</span>)),  <span class="comment"># 全文检索框架</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step3</strong> 启动项目，在主页搜索框中搜索商品信息，点击搜索提交按钮后，结果提示如下错误，在templates/search目录下找不到search.html文件</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/2019040511391874.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<ul>
<li><strong>step4</strong> 在templates/search目录下创建search.html文件，将list.html模板中的内容拷贝到该文件中，进行修改显示出搜索结果列表页，haystack会把搜索出的结果传递给该路径下的search.html模板</li>
</ul>
<p><strong>query</strong>：<font style="color:red">搜索关键字</font></p>
<p><strong>page</strong>：<font style="color:red">当前页的page对象 –&gt;遍历page对象，获取到的是</font><font style="color:green">SearchResult</font><font style="color:red">类的实例对象，对象的属性<font style="color:green">object</font>才是模型类的对象</font></p>
<p><strong>paginator</strong>：<font style="color:red">分页paginator对象</font></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &apos;base_detail_list.html&apos; %&#125;</span><br><span class="line">&#123;% block title %&#125;天天生鲜-搜索结果列表&#123;% endblock title %&#125;</span><br><span class="line">&#123;% block main_content %&#125;</span><br><span class="line">	&lt;div class=&quot;breadcrumb&quot;&gt;</span><br><span class="line">		&lt;a href=&quot;#&quot;&gt;&#123;&#123; query &#125;&#125;&lt;/a&gt;</span><br><span class="line">		&lt;span&gt;&gt;&lt;/span&gt;</span><br><span class="line">		&lt;a href=&quot;#&quot;&gt;搜索结果如下:&lt;/a&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line"> </span><br><span class="line">	&lt;div class=&quot;main_wrap clearfix&quot;&gt;</span><br><span class="line">        &lt;ul class=&quot;goods_type_list clearfix&quot;&gt;</span><br><span class="line">            &#123;% for item in page %&#125;</span><br><span class="line">            &lt;li&gt;</span><br><span class="line">                &lt;a href=&quot;&#123;% url &apos;goods:detail&apos; item.object.id %&#125;&quot;&gt;&lt;img src=&quot;&#123;&#123; item.object.image.url &#125;&#125;&quot;&gt;&lt;/a&gt;</span><br><span class="line">                &lt;h4&gt;&lt;a href=&quot;&#123;% url &apos;goods:detail&apos; item.object.id %&#125;&quot;&gt;&#123;&#123; item.object.name &#125;&#125;&lt;/a&gt;&lt;/h4&gt;</span><br><span class="line">                &lt;div class=&quot;operate&quot;&gt;</span><br><span class="line">                    &lt;span class=&quot;prize&quot;&gt;￥&#123;&#123; item.object.price &#125;&#125;&lt;/span&gt;</span><br><span class="line">                    &lt;span class=&quot;unit&quot;&gt;&#123;&#123; item.object.price &#125;&#125;/&#123;&#123; item.object.unite &#125;&#125;&lt;/span&gt;</span><br><span class="line">                    &lt;a href=&quot;#&quot; class=&quot;add_goods&quot; title=&quot;加入购物车&quot;&gt;&lt;/a&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">        &lt;div class=&quot;pagenation&quot;&gt;</span><br><span class="line">            &#123;% if page.has_previous %&#125;</span><br><span class="line">            &lt;a href=&quot;/search?q=&#123;&#123; query &#125;&#125;&amp;page=&#123;&#123; page.previous_page_number &#125;&#125;&quot;&gt;&lt;上一页&lt;/a&gt;</span><br><span class="line">            &#123;% endif %&#125;</span><br><span class="line">            &#123;% for pindex in paginator.page_range %&#125;</span><br><span class="line">                &#123;% if pindex == page.number %&#125;</span><br><span class="line">                    &lt;a href=&quot;/search?q=&#123;&#123; query &#125;&#125;&amp;page=&#123;&#123; pindex &#125;&#125;&quot; class=&quot;active&quot;&gt;&#123;&#123; pindex &#125;&#125;&lt;/a&gt;</span><br><span class="line">                &#123;% else %&#125;</span><br><span class="line">                    &lt;a href=&quot;/search?q=&#123;&#123; query &#125;&#125;&amp;page=&#123;&#123; pindex &#125;&#125;&quot;&gt;&#123;&#123; pindex &#125;&#125;&lt;/a&gt;</span><br><span class="line">                &#123;% endif %&#125;</span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">            &#123;% if page.has_next %&#125;</span><br><span class="line">            &lt;a href=&quot;/search?q=&#123;&#123; query &#125;&#125;&amp;page=&#123;&#123; page.next_page_number &#125;&#125;&quot;&gt;下一页&gt;&lt;/a&gt;</span><br><span class="line">            &#123;% endif %&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&#123;% endblock main_content %&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step5</strong> 回到主页在搜索框中搜索草莓，显示出搜索的结果</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190405115411470.gif" alt></fancybox></p>
<ul>
<li><strong>step6</strong> 在数据库进行模糊查询后，得值使用haystack框架加载whoosh检索出来的内容，只能呵呵了</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190405115955986.png" alt></p>
<p>5.使用中文分词包，更爱whoosh默认分词方式</p>
<ul>
<li><strong>step1</strong> 安装jieba分词包</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install jieba</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step2</strong> 在D:\Python27\Lib\site-packages\haystack\backends你的python项目环境安装包中找到此路径，在该路径下创建ChineseAnalyzer.py文件，文件内容如下</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jieba</span><br><span class="line"><span class="keyword">from</span> whoosh.analysis <span class="keyword">import</span> Tokenizer, Token</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChineseTokenizer</span><span class="params">(Tokenizer)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, value, positions=False, chars=False,</span></span></span><br><span class="line"><span class="function"><span class="params">                 keeporiginal=False, removestops=True,</span></span></span><br><span class="line"><span class="function"><span class="params">                 start_pos=<span class="number">0</span>, start_char=<span class="number">0</span>, mode=<span class="string">''</span>, **kwargs)</span>:</span></span><br><span class="line">        t = Token(positions, chars, removestops=removestops, mode=mode, **kwargs)</span><br><span class="line">        seglist = jieba.cut(value, cut_all=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">for</span> w <span class="keyword">in</span> seglist:</span><br><span class="line">            t.original = t.text = w</span><br><span class="line">            t.boost = <span class="number">1.0</span></span><br><span class="line">            <span class="keyword">if</span> positions:</span><br><span class="line">                t.pos = start_pos + value.find(w)</span><br><span class="line">            <span class="keyword">if</span> chars:</span><br><span class="line">                t.startchar = start_char + value.find(w)</span><br><span class="line">                t.endchar = start_char + value.find(w) + len(w)</span><br><span class="line">            <span class="keyword">yield</span> t</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ChineseAnalyzer</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> ChineseTokenizer()</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step3</strong> 复制whoosh_backend.py文件，改为whoosh_cn_backend.py，编辑该文件，导入from .ChineseAnalyzer import ChineseAnalyzer类，将代码中的analyzer=StemmingAnalyzer()修改为analyzer=ChineseAnalyzer()</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> .ChineseAnalyzer <span class="keyword">import</span> ChineseAnalyzer</span><br><span class="line">analyzer=ChineseAnalyzer()</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step4</strong> 修改settings中haystack配置，将.whoosh_backend改为.whoosh_cn_backend</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ENGINE&apos;: &apos;haystack.backends.whoosh_cn_backend.WhooshEngine&apos;,</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step5</strong> 重新生成新的索引文件</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190405124927665.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<ul>
<li><strong>step6</strong> 测试搜索草莓是否显示出所有草莓相关的商品信息</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190405125945509.gif" alt></fancybox></p>
<ul>
<li><strong>step7</strong> 测试搜索商品简介以及商品详情介绍关键字</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190405130000958.gif" alt></fancybox></p>
<h1 id="四丶添加商品到购物车"><a href="#四丶添加商品到购物车" class="headerlink" title="四丶添加商品到购物车"></a>四丶添加商品到购物车</h1><p>1.分析如何添加购物车数目</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.使用什么方式想后端传递参数</span><br><span class="line">使用ajax post方式向后端传递参数</span><br><span class="line">2.传递哪些参数</span><br><span class="line">商品id和商品的数量</span><br></pre></td></tr></table></figure>

<p>2.添加购物车后台逻辑</p>
<ul>
<li><strong>step1</strong> 在df_cart/views中定义类视图，并在该视图下定义post方法</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CartAddView</span><span class="params">(View)</span>:</span></span><br><span class="line">    <span class="string">"""购物车添加"""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        <span class="string">"""添加购物车数目"""</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step2</strong> 判断用户是否登录，没有登录则无法添加购物车</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">user = request.user</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> user.is_authenticated():</span><br><span class="line">    <span class="keyword">return</span> JsonResponse(&#123;<span class="string">"errno"</span>:<span class="number">0</span>, <span class="string">"error_msg"</span>:<span class="string">"请先登录"</span>&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step3</strong> 获取参数</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sku_id = request.POST.get(<span class="string">"sku_id"</span>)</span><br><span class="line">count = request.POST.get(<span class="string">"count"</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step4</strong> 校验参数完整性</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> all([sku_id, count]):</span><br><span class="line">    <span class="keyword">return</span> JsonResponse(&#123;<span class="string">"errno"</span>:<span class="number">1</span>, <span class="string">"error_msg"</span>:<span class="string">"参数不完整"</span>&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step5</strong> 校验商品数量count是否合法</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    count = int(count)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="keyword">return</span> JsonResponse(&#123;<span class="string">"errno"</span>:<span class="number">2</span>, <span class="string">"error_msg"</span>:<span class="string">"商品数量不合法"</span>&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step6</strong> 校验商品是否存在</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    sku = GoodsSKU.objects.get(id=sku_id)</span><br><span class="line"><span class="keyword">except</span> GoodsSKU.DoesNotExist:</span><br><span class="line">    <span class="keyword">return</span> JsonResponse(&#123;<span class="string">"errno"</span>:<span class="number">3</span>, <span class="string">"error_msg"</span>:<span class="string">"商品不存在"</span>&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step7</strong> 如果用户购物车存在将要添加的商品id，则添加商品的数量即可，如果没有，则添加商品id以及数量</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">conn = get_redis_connection(<span class="string">"default"</span>)</span><br><span class="line">cart_key = <span class="string">"cart_%d"</span> % user.id</span><br><span class="line">cart_count = conn.hget(cart_key, sku_id)</span><br><span class="line"><span class="keyword">if</span> cart_count:</span><br><span class="line">    <span class="comment"># 在redis中查询到该sku_id键存在，则添加该键的商品数量</span></span><br><span class="line">    count += int(cart_count)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step8</strong> 判断该商品库存是否大于用户添加商品的数量</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> count &gt; sku.stock:</span><br><span class="line">    <span class="keyword">return</span> JsonResponse(&#123;<span class="string">"errno"</span>:<span class="number">4</span>, <span class="string">"error_msg"</span>:<span class="string">"商品库存不足"</span>&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step9</strong> 添加商品数目，没有查到则设置新的sku_id以及商品数量，hset方法有数据则更新，无则新增</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conn.hset(cart_key, sku_id, count)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step10</strong> 计算用户购物车商品的总数目，最后返回添加成功响应</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">total_count = conn.hlen(cart_key)</span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">"errno"</span>:<span class="string">"ok"</span>,<span class="string">"total_count"</span>:total_count, <span class="string">"error_msg"</span>:<span class="string">"添加成功"</span>&#125;)</span><br></pre></td></tr></table></figure>

<p>3.添加购物车前端js</p>
<ul>
<li><strong>step1</strong> 获取元素坐标</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> $add_x = $(<span class="string">'#add_cart'</span>).offset().top;</span><br><span class="line"><span class="keyword">var</span> $add_y = $(<span class="string">'#add_cart'</span>).offset().left;</span><br><span class="line"><span class="keyword">var</span> $to_x = $(<span class="string">'#show_count'</span>).offset().top;</span><br><span class="line"><span class="keyword">var</span> $to_y = $(<span class="string">'#show_count'</span>).offset().left;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step2</strong> 定义点击购物车事件，获取商品sku_id以及商品数量，通过ajax post请求方式向后端cart接口发送请求并传递sku_id以及商品数量，后台进行逻辑判断向前端返回字典数据，通过后台返回的data数据进行页面购物车显示控制</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'#add_cart'</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">// 获取商品id和商品数量</span></span><br><span class="line">        sku_id = $(<span class="keyword">this</span>).attr(<span class="string">'sku_id'</span>);</span><br><span class="line">        count = $(<span class="string">'.num_show'</span>).val();</span><br><span class="line">        csrf = $(<span class="string">'input[name="csrfmiddlewaretoken"]'</span>).val();</span><br><span class="line">        &#123;#alert(sku_id+':'+count);#&#125;</span><br><span class="line">        <span class="comment">// 发起ajax post请求 访问/cart/add ,参数 sku_id和count</span></span><br><span class="line">        params = &#123;<span class="string">"sku_id"</span>:sku_id, <span class="string">"count"</span>:count, <span class="string">"csrfmiddlewaretoken"</span>:csrf&#125;;</span><br><span class="line">        $.post(<span class="string">'/cart/add'</span>, params, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(data.errno==<span class="string">"ok"</span>)&#123;</span><br><span class="line">                $(<span class="string">".add_jump"</span>).css(&#123;<span class="string">'left'</span>:$add_y+<span class="number">80</span>,<span class="string">'top'</span>:$add_x+<span class="number">10</span>,<span class="string">'display'</span>:<span class="string">'block'</span>&#125;);</span><br><span class="line">                $(<span class="string">".add_jump"</span>).stop().animate(&#123;</span><br><span class="line">                    <span class="string">'left'</span>: $to_y+<span class="number">7</span>,</span><br><span class="line">                    <span class="string">'top'</span>: $to_x+<span class="number">7</span>&#125;,</span><br><span class="line">                    <span class="string">"fast"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                        $(<span class="string">".add_jump"</span>).fadeOut(<span class="string">'fast'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                            $(<span class="string">'#show_count'</span>).html(data.total_count);</span><br><span class="line">                        &#125;);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                alert(data.error_msg)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step3</strong> 需要注意的是在上一步中通过ajax post方式向后台发送请求，是需要进行csrf验证的，不然则会报错；在detail.html模板文件中任意一位置加上{% csrf_token %}即可，并且在ajax中发送请求传递参数是获取input[name=”csrfmiddlewaretoken”]的值来向后端传递，在页面源代码中对应html文件中的{% csrf_token %}位置会出现如下标签元素</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190405182531497.png" alt></p>
<p>4.测试</p>
<p>说明：为了方便测试，博主先把redis数据库中保存的购物车删除</p>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190405191115363.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<ul>
<li><strong>step1</strong> 对同一个商品进行多次添加，右上方购物车显示数目不变</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190405191929691.gif" alt></fancybox></p>
<ul>
<li><strong>step2</strong> 对不同的商品进行多次添加，右上方购物车显示数目变化</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190405191949272.gif" alt></fancybox></p>
<ul>
<li><strong>step3</strong> 查看redis库数据</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190405192209551.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<h1 id="五丶天天生鲜我的购物车页"><a href="#五丶天天生鲜我的购物车页" class="headerlink" title="五丶天天生鲜我的购物车页"></a>五丶天天生鲜我的购物车页</h1><p>1.购物车页面显示</p>
<ul>
<li><strong>step1</strong> 在df_cart/views中定义类视图继承于封装的login_required方法的类，因为该页面是需要用户登录才能访问的，而在添加购物车数目的时候使用ajax方式发送请求，所以不用继承，在post方法中进行登录验证即可；并在类中定义get方法，显示我的购物车页面</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /cart</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CartInfoView</span><span class="params">(LoginRequiredMixin, View)</span>:</span></span><br><span class="line">    <span class="string">"""我的购物车"""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        <span class="string">"""显示我的购物车页面"""</span></span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">"cart.html"</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step2</strong> 在df_cart/urls中定义路由</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url(<span class="string">r"^$"</span>, CartInfoView.as_view(), name=<span class="string">"cart_show"</span>)  <span class="comment"># 显示我的购物车</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step3</strong> 在base.html中菜单栏上的我的购物车添加链接地址</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'cart:cart_show' %&#125;"</span>&gt;</span>我的购物车<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step4</strong> 测试在登录与未登录状态进入我的购物页面</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190405195326710.gif" alt></fancybox></p>
<p>2.获取我的购物车页面数据</p>
<ul>
<li><strong>step1</strong> 获取登录的用户</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user = request.user</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step2</strong> 获取用户购物车商品信息</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">conn = get_redis_connection(<span class="string">"default"</span>)</span><br><span class="line">cart_key = <span class="string">"cart_%d"</span> % user.id</span><br><span class="line"><span class="comment"># &#123;商品id:商品数量&#125;</span></span><br><span class="line">cart_dict = conn.hgetall(cart_key)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step3</strong> 获取我的购物车页面每个商品的数量以及小计以及我的购物车中商品总件数以及总价格</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">skus = []  <span class="comment"># 存放查出来的商品信息对象</span></span><br><span class="line"><span class="comment"># 用于保存我的购物车中商品总件数以及总价格</span></span><br><span class="line">total_count = <span class="number">0</span></span><br><span class="line">total_price = <span class="number">0</span></span><br><span class="line"><span class="comment"># 获取商品id和商品数量</span></span><br><span class="line"><span class="keyword">for</span> sku_id, count <span class="keyword">in</span> cart_dict.items():</span><br><span class="line">    <span class="comment"># 根据sku_id获取商品信息</span></span><br><span class="line">    sku = GoodsSKU.objects.get(id=sku_id)</span><br><span class="line">    <span class="comment"># 计算小计</span></span><br><span class="line">    amount = sku.price*int(count)</span><br><span class="line">    <span class="comment"># 动态给sku对象添加属性，保存遍历获取的小计以及商品数量</span></span><br><span class="line">    sku.amount = amount</span><br><span class="line">    sku.count = count</span><br><span class="line">    <span class="comment"># 将查询出来的商品信息对象保存到列表中</span></span><br><span class="line">    skus.append(sku)</span><br><span class="line">    <span class="comment"># 累加计算商品总件数和总价格</span></span><br><span class="line">    total_count += int(count)</span><br><span class="line">    total_price += amount</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step4</strong> 定义模板上下文，并返回给购物车模板</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义模板上下文</span></span><br><span class="line">context = &#123;</span><br><span class="line">    <span class="string">'skus'</span>:skus,<span class="string">'total_count'</span>:total_count,</span><br><span class="line">    <span class="string">'total_price'</span>:total_price</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> render(request, <span class="string">"cart.html"</span>, context)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step5</strong> 在cart.html模板文件中进行数据填坑</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class="total_count"&gt;全部商品&lt;em&gt;&#123;&#123; total_count &#125;&#125;&lt;/em&gt;件&lt;/div&gt;</span><br><span class="line">&lt;ul class="cart_list_th clearfix"&gt;</span><br><span class="line">    &lt;li class="col01"&gt;商品名称&lt;/li&gt;</span><br><span class="line">    &lt;li class="col02"&gt;商品单位&lt;/li&gt;</span><br><span class="line">    &lt;li class="col03"&gt;商品价格&lt;/li&gt;</span><br><span class="line">    &lt;li class="col04"&gt;数量&lt;/li&gt;</span><br><span class="line">    &lt;li class="col05"&gt;小计&lt;/li&gt;</span><br><span class="line">    &lt;li class="col06"&gt;操作&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line">&#123;% <span class="keyword">for</span> sku <span class="keyword">in</span> skus %&#125;</span><br><span class="line">&lt;ul class="cart_list_td clearfix"&gt;</span><br><span class="line">    &lt;li class="col01"&gt;&lt;input type="checkbox" name="" checked&gt;&lt;/li&gt;</span><br><span class="line">    &lt;li class="col02"&gt;&lt;img src="&#123;&#123; sku.image.url &#125;&#125;"&gt;&lt;/li&gt;</span><br><span class="line">    &lt;li class="col03"&gt;&#123;&#123; sku.name &#125;&#125;&lt;br&gt;&lt;em&gt;&#123;&#123; sku.price &#125;&#125;元/&#123;&#123; sku.unite &#125;&#125;&lt;/em&gt;&lt;/li&gt;</span><br><span class="line">    &lt;li class="col04"&gt;&#123;&#123; sku.unite &#125;&#125;&lt;/li&gt;</span><br><span class="line">    &lt;li class="col05"&gt;&#123;&#123; sku.price &#125;&#125;元&lt;/li&gt;</span><br><span class="line">    &lt;li class="col06"&gt;</span><br><span class="line">        &lt;div class="num_add"&gt;</span><br><span class="line">            &lt;a href="javascript:;" class="add fl"&gt;+&lt;/a&gt;</span><br><span class="line">            &lt;input type="text" class="num_show fl" value="&#123;&#123; sku.count &#125;&#125;"&gt;</span><br><span class="line">            &lt;a href="javascript:;" class="minus fl"&gt;-&lt;/a&gt;   </span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">    &lt;li class="col07"&gt;&#123;&#123; sku.amount&#125;&#125;元&lt;/li&gt;</span><br><span class="line">    &lt;li class="col08"&gt;&lt;a href="javascript:;"&gt;删除&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line">&lt;ul class="settlements"&gt;</span><br><span class="line">    &lt;li class="col01"&gt;&lt;input type="checkbox" name="" checked=""&gt;&lt;/li&gt;</span><br><span class="line">    &lt;li class="col02"&gt;全选&lt;/li&gt;</span><br><span class="line">    &lt;li class="col03"&gt;合计(不含运费)：&lt;span&gt;¥&lt;/span&gt;&lt;em&gt;&#123;&#123; total_price &#125;&#125;&lt;/em&gt;&lt;br&gt;共计&lt;b&gt;&#123;&#123; total_count &#125;&#125;&lt;/b&gt;件商品&lt;/li&gt;</span><br><span class="line">    &lt;li class="col04"&gt;&lt;a href="place_order.html"&gt;去结算&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step6</strong> 进入我的购物车页面显示正确商品信息以及购物车数目小计金额以及购物车总件数总金额</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190405212654147.gif" alt></fancybox></p>
<p>3.购物车页面全选与不全选以及选中与不选中js代码</p>
<ul>
<li><strong>step1</strong> 计算选中的商品的总件数和总价格</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_cart_info</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">         total_price = <span class="number">0</span>;</span><br><span class="line">         total_count = <span class="number">0</span>;</span><br><span class="line">         $(<span class="string">'.cart_list_td'</span>).find(<span class="string">':checked'</span>).parents(<span class="string">'ul'</span>).each(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="comment">//获取商品的数量和小计</span></span><br><span class="line">                count = $(<span class="keyword">this</span>).find(<span class="string">'.num_show'</span>).val();</span><br><span class="line">                amount = $(<span class="keyword">this</span>).children(<span class="string">'.col07'</span>).text();</span><br><span class="line">                count = <span class="built_in">parseInt</span>(count);</span><br><span class="line">                amount = <span class="built_in">parseFloat</span>(amount);</span><br><span class="line">                total_count += count;</span><br><span class="line">                total_price += amount;</span><br><span class="line">         &#125;);</span><br><span class="line">         <span class="comment">// 设置选中商品的总件数和总价格</span></span><br><span class="line">        $(<span class="string">'.settlements'</span>).find(<span class="string">'em'</span>).text(total_price.toFixed(<span class="number">2</span>));</span><br><span class="line">        $(<span class="string">'.settlements'</span>).find(<span class="string">'b'</span>).text(total_count);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step2</strong> 全选和全不选</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'.settlements'</span>).find(<span class="string">':checkbox'</span>).change(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 获取全选的选中状态</span></span><br><span class="line">        is_check = $(<span class="keyword">this</span>).prop(<span class="string">'checked'</span>);</span><br><span class="line">        <span class="comment">// 遍历商品对应的checkbox状态，设置其状态与全选的checkbox状态保持一致</span></span><br><span class="line">        $(<span class="string">'.cart_list_td'</span>).find(<span class="string">':checkbox'</span>).each(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            $(<span class="keyword">this</span>).prop(<span class="string">'checked'</span>, is_check)</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 调用get_cart_info方法，更新购物车页面商品总件数和总价格</span></span><br><span class="line">        get_cart_info()</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step3</strong> 当购物车某个商品的checkbox状态发生改变时，设置全选checkbox状态</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'.cart_list_td'</span>).find(<span class="string">':checkbox'</span>).change(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 获取页面上所有的商品数目(不是商品数量)</span></span><br><span class="line">        all_len = $(<span class="string">'.cart_list_td'</span>).length</span><br><span class="line">        <span class="comment">// 获取页面上被选中的商品数目</span></span><br><span class="line">        checked_len = $(<span class="string">'.cart_list_td'</span>).find(<span class="string">":checked"</span>).length;</span><br><span class="line">        <span class="keyword">if</span>(checked_len&lt;all_len)&#123;</span><br><span class="line">            <span class="comment">// 说明商品未全部勾选，即取消全选的checkbox状态</span></span><br><span class="line">            $(<span class="string">'.settlements'</span>).find(<span class="string">':checkbox'</span>).prop(<span class="string">'checked'</span>, <span class="literal">false</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            $(<span class="string">'.settlements'</span>).find(<span class="string">':checkbox'</span>).prop(<span class="string">'checked'</span>, <span class="literal">true</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 调用get_cart_info方法，更新购物车页面商品总件数和总价格</span></span><br><span class="line">        get_cart_info()</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step4</strong> 效果展示</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190406130039355.gif" alt></fancybox></p>
<p>4.购物车中商品数量点击事件（增加或减少）</p>
<ul>
<li><strong>step1</strong> 在df_cart/views中定义类视图，通过页面点击+或-来对商品数量进行修改，使用ajax post请求方式向后端发送，所以需要定义post方法，需要传递商品id（sku_id）以及商品更改后的数量（count）</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /cart/update</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CartUpdateView</span><span class="params">(View)</span>:</span></span><br><span class="line">    <span class="string">"""购物车数据更新"""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        <span class="string">"""修改购物车商品数据"""</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step2</strong> 判断用户是否登录—&gt;获取参数—&gt;校验参数完整性—&gt;校验商品数量count是否合法—&gt;校验商品是否存在，跟前面添加商品到购物车（CartAddView视图逻辑一样）</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">user = request.user</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> user.is_authenticated():</span><br><span class="line">    <span class="keyword">return</span> JsonResponse(&#123;<span class="string">"errno"</span>: <span class="number">0</span>, <span class="string">"error_msg"</span>: <span class="string">"请先登录"</span>&#125;)</span><br><span class="line"><span class="comment"># 1.获取参数</span></span><br><span class="line">sku_id = request.POST.get(<span class="string">"sku_id"</span>)</span><br><span class="line">count = request.POST.get(<span class="string">"count"</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 2.校验参数完整性</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> all([sku_id, count]):</span><br><span class="line">    <span class="keyword">return</span> JsonResponse(&#123;<span class="string">"errno"</span>: <span class="number">1</span>, <span class="string">"error_msg"</span>: <span class="string">"参数不完整"</span>&#125;)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 3.校验商品数量count是否合法</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    count = int(count)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="keyword">return</span> JsonResponse(&#123;<span class="string">"errno"</span>: <span class="number">2</span>, <span class="string">"error_msg"</span>: <span class="string">"商品数量不合法"</span>&#125;)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 4. 校验商品是否存在</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    sku = GoodsSKU.objects.get(id=sku_id)</span><br><span class="line"><span class="keyword">except</span> GoodsSKU.DoesNotExist:</span><br><span class="line">    <span class="keyword">return</span> JsonResponse(&#123;<span class="string">"errno"</span>: <span class="number">3</span>, <span class="string">"error_msg"</span>: <span class="string">"商品不存在"</span>&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step3</strong> 更新购物车的商品数量，在数据库中设置对应key的value值</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">conn = get_redis_connection(<span class="string">"default"</span>)</span><br><span class="line">cart_key = <span class="string">"cart_%d"</span> % user.id</span><br><span class="line"><span class="keyword">if</span> count &gt; sku.stock:</span><br><span class="line">    <span class="keyword">return</span> JsonResponse(&#123;<span class="string">"errno"</span>: <span class="number">4</span>, <span class="string">"error_msg"</span>: <span class="string">"商品库存不足"</span>&#125;)</span><br><span class="line">conn.hset(cart_key, sku_id, count)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step4</strong> 获取更新后的购物车中商品的总件数</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">total_count = <span class="number">0</span></span><br><span class="line">vals = conn.hvals(cart_key)</span><br><span class="line"><span class="keyword">for</span> val <span class="keyword">in</span> vals:</span><br><span class="line">    total_count += int(val)</span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">"errno"</span>: <span class="string">"ok"</span>, <span class="string">"total_count"</span>:total_count, <span class="string">"error_msg"</span>: <span class="string">"更新成功"</span>&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step5</strong> 在cart.html中编写js增加商品数量</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 计算商品的小计</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">update_goods_amount</span>(<span class="params">sku_ul</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 获取商品的价格和数量</span></span><br><span class="line">    count = sku_ul.find(<span class="string">'.num_show'</span>).val();</span><br><span class="line">    price = sku_ul.children(<span class="string">'.col05'</span>).text();</span><br><span class="line">    <span class="comment">// 计算商品的小计</span></span><br><span class="line">    amount = <span class="built_in">parseInt</span>(count)*<span class="built_in">parseFloat</span>(price);</span><br><span class="line">    <span class="comment">// 设置商品的小计</span></span><br><span class="line">    sku_ul.children(<span class="string">'.col07'</span>).text(amount.toFixed(<span class="number">2</span>)+<span class="string">'元'</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 购物车增加商品数量</span></span><br><span class="line">$(<span class="string">'.add'</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 获取商品id和当前数量</span></span><br><span class="line">    sku_id = $(<span class="keyword">this</span>).next().attr(<span class="string">'sku_id'</span>);</span><br><span class="line">    count = $(<span class="keyword">this</span>).next().val();</span><br><span class="line">    count = <span class="built_in">parseInt</span>(count) +<span class="number">1</span>;</span><br><span class="line">    csrf = $(<span class="string">'input[name="csrfmiddlewaretoken"]'</span>).val();</span><br><span class="line">    <span class="comment">// 组织参数</span></span><br><span class="line">    params = &#123;<span class="string">'sku_id'</span>:sku_id, <span class="string">'count'</span>:count, <span class="string">"csrfmiddlewaretoken"</span>:csrf&#125;;</span><br><span class="line">    error_update = <span class="literal">false</span>;</span><br><span class="line">    total = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 设置ajax请求为同步</span></span><br><span class="line">    $.ajaxSettings.async = <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">// 向后端发送ajax post请求</span></span><br><span class="line">    $.post(<span class="string">'/cart/update'</span>, params, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(data.errno == <span class="string">"ok"</span>)&#123;</span><br><span class="line">            error_update = <span class="literal">false</span>;</span><br><span class="line">            total = data.total_count</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 更新失败</span></span><br><span class="line">            error_update = <span class="literal">true</span>;</span><br><span class="line">            alert(data.error_msg)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 设置ajax请求为异步</span></span><br><span class="line">    $.ajaxSettings.async = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">// 判断是否更新成功</span></span><br><span class="line">    <span class="keyword">if</span>(error_update == <span class="literal">false</span>)&#123;</span><br><span class="line">        <span class="comment">// 重新设置页面上商品数量</span></span><br><span class="line">        $(<span class="keyword">this</span>).next().val(count);</span><br><span class="line">        <span class="comment">// 计算商品小计</span></span><br><span class="line">        update_goods_amount($(<span class="keyword">this</span>).parents(<span class="string">'ul'</span>));</span><br><span class="line">         <span class="comment">// 获取商品对应的checkbox的选中状态，如果被选中，更新页面信息</span></span><br><span class="line">        is_checked = $(<span class="keyword">this</span>).parents(<span class="string">'ul'</span>).find(<span class="string">':checkbox'</span>).prop(<span class="string">'checked'</span>);</span><br><span class="line">        <span class="keyword">if</span> (is_checked)&#123;</span><br><span class="line">            <span class="comment">// 更新页面信息</span></span><br><span class="line">            get_cart_info()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 更新页面上购物车商品的总件数</span></span><br><span class="line">        $(<span class="string">'.total_count'</span>).children(<span class="string">'em'</span>).text(total)</span><br><span class="line">        &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step6</strong> 当商品状态为checked选中状态，点击增加商品数量，则左上角全部商品件数和右下角合计金额商品总件累加，如果该增加的商品不是选中状态，则只增加左上角全部商品件数</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190406163630568.gif" alt></fancybox></p>
<ul>
<li><strong>step7</strong> 商品数量的减少，跟增加的js代码逻辑一样，只需要修改其中的count-1以及查找元素next修改为prev</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'.minus'</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 获取商品id和当前数量</span></span><br><span class="line">    sku_id = $(<span class="keyword">this</span>).prev().attr(<span class="string">'sku_id'</span>);</span><br><span class="line">    count = $(<span class="keyword">this</span>).prev().val();</span><br><span class="line">    count = <span class="built_in">parseInt</span>(count) <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">if</span>(count &lt;=<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    csrf = $(<span class="string">'input[name="csrfmiddlewaretoken"]'</span>).val();</span><br><span class="line">    <span class="comment">// 组织参数</span></span><br><span class="line">    params = &#123;<span class="string">'sku_id'</span>:sku_id, <span class="string">'count'</span>:count, <span class="string">"csrfmiddlewaretoken"</span>:csrf&#125;;</span><br><span class="line">    error_update = <span class="literal">false</span>;</span><br><span class="line">    total = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 设置ajax请求为同步</span></span><br><span class="line">    $.ajaxSettings.async = <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">// 向后端发送ajax post请求</span></span><br><span class="line">    $.post(<span class="string">'/cart/update'</span>, params, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(data.errno == <span class="string">"ok"</span>)&#123;</span><br><span class="line">            error_update = <span class="literal">false</span>;</span><br><span class="line">            total = data.total_count</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 更新失败</span></span><br><span class="line">            error_update = <span class="literal">true</span>;</span><br><span class="line">            alert(data.error_msg)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 设置ajax请求为异步</span></span><br><span class="line">    $.ajaxSettings.async = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">// 判断是否更新成功</span></span><br><span class="line">    <span class="keyword">if</span>(error_update == <span class="literal">false</span>)&#123;</span><br><span class="line">        <span class="comment">// 重新设置页面上商品数量</span></span><br><span class="line">        $(<span class="keyword">this</span>).prev().val(count);</span><br><span class="line">        <span class="comment">// 计算商品小计</span></span><br><span class="line">        update_goods_amount($(<span class="keyword">this</span>).parents(<span class="string">'ul'</span>));</span><br><span class="line">         <span class="comment">// 获取商品对应的checkbox的选中状态，如果被选中，更新页面信息</span></span><br><span class="line">        is_checked = $(<span class="keyword">this</span>).parents(<span class="string">'ul'</span>).find(<span class="string">':checkbox'</span>).prop(<span class="string">'checked'</span>);</span><br><span class="line">        <span class="keyword">if</span> (is_checked)&#123;</span><br><span class="line">            <span class="comment">// 更新页面信息</span></span><br><span class="line">            get_cart_info()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 更新页面上购物车商品的总件数</span></span><br><span class="line">        $(<span class="string">'.total_count'</span>).children(<span class="string">'em'</span>).text(total)</span><br><span class="line">        &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step8</strong> 测试</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190406174518211.gif" alt></fancybox></p>
<ul>
<li><strong>step9</strong> 将增加商品数量以及减少商品数量复用的代码进行封装到函数中</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">error_update = false;</span><br><span class="line">total = 0;</span><br><span class="line">function update_remote_cart_info(sku_id, count)&#123;</span><br><span class="line">    csrf = $(&apos;input[name=&quot;csrfmiddlewaretoken&quot;]&apos;).val();</span><br><span class="line">    // 组织参数</span><br><span class="line">    params = &#123;&apos;sku_id&apos;:sku_id, &apos;count&apos;:count, &quot;csrfmiddlewaretoken&quot;:csrf&#125;;</span><br><span class="line">     // 设置ajax请求为同步</span><br><span class="line">    $.ajaxSettings.async = false;</span><br><span class="line">    // 向后端发送ajax post请求</span><br><span class="line">    $.post(&apos;/cart/update&apos;, params, function (data) &#123;</span><br><span class="line">        if(data.errno == &quot;ok&quot;)&#123;</span><br><span class="line">            error_update = false;</span><br><span class="line">            total = data.total_count</span><br><span class="line">        &#125;</span><br><span class="line">        else &#123;</span><br><span class="line">            // 更新失败</span><br><span class="line">            error_update = true;</span><br><span class="line">            alert(data.error_msg)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    // 设置ajax请求为异步</span><br><span class="line">    $.ajaxSettings.async = true;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>5.购物车中的商品手动输入数量</p>
<ul>
<li><strong>step1</strong> input输入框类属性失去焦点则进行逻辑处理，跟前面的增加减少大同小异</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 记录用户输入商品数量之前的商品数量</span></span><br><span class="line">pre_count = <span class="number">0</span>;</span><br><span class="line">$(<span class="string">'.num_show '</span>).focus(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">   pre_count = $(<span class="keyword">this</span>).val()</span><br><span class="line">&#125;);</span><br><span class="line">$(<span class="string">'.num_show '</span>).blur(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 获取商品id和当前数量</span></span><br><span class="line">    sku_id = $(<span class="keyword">this</span>).attr(<span class="string">'sku_id'</span>);</span><br><span class="line">    count = $(<span class="keyword">this</span>).val();</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">isNaN</span>(count) || count.trim().length==<span class="number">0</span> || <span class="built_in">parseInt</span>(count)&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="comment">// 当出现用户输入的数量不是数字或空格或小于等于0时，设置数量的值为输入前商品的数量</span></span><br><span class="line">        $(<span class="keyword">this</span>).val(pre_count);</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 更新购物车数据</span></span><br><span class="line">    count = <span class="built_in">parseInt</span>(count);</span><br><span class="line">    update_remote_cart_info(sku_id, count);</span><br><span class="line">    <span class="comment">// 判断是否更新成功</span></span><br><span class="line">    <span class="keyword">if</span>(error_update == <span class="literal">false</span>)&#123;</span><br><span class="line">        <span class="comment">// 重新设置页面上商品数量</span></span><br><span class="line">        $(<span class="keyword">this</span>).val(count);</span><br><span class="line">        <span class="comment">// 计算商品小计</span></span><br><span class="line">        update_goods_amount($(<span class="keyword">this</span>).parents(<span class="string">'ul'</span>));</span><br><span class="line">         <span class="comment">// 获取商品对应的checkbox的选中状态，如果被选中，更新页面信息</span></span><br><span class="line">        is_checked = $(<span class="keyword">this</span>).parents(<span class="string">'ul'</span>).find(<span class="string">':checkbox'</span>).prop(<span class="string">'checked'</span>);</span><br><span class="line">        <span class="keyword">if</span> (is_checked)&#123;</span><br><span class="line">            <span class="comment">// 更新页面信息</span></span><br><span class="line">            get_cart_info()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 更新页面上购物车商品的总件数</span></span><br><span class="line">        $(<span class="string">'.total_count'</span>).children(<span class="string">'em'</span>).text(total)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">// 更新失败则设置为原来的手动输入前的值</span></span><br><span class="line">        $(<span class="keyword">this</span>).val(pre_count)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step2</strong> 效果演示，输入不合法的数量，数量显示为输入之前的数量，当输入的商品数量大于实际库存则显示之前的数量</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190406185720458.gif" alt></fancybox></p>
<p>6.在购物车中删除商品记录</p>
<ul>
<li><strong>step1</strong> 在df_cart/views中定义类视图，使用ajax post请求方式向该视图进行数据传递</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /cart/delete</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CartDelView</span><span class="params">(View)</span>:</span></span><br><span class="line">    <span class="string">"""删除购物车记录"""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step2</strong> 获取参数校验参数数据库进行删除返回正确响应数据</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 判断用户是否登录</span></span><br><span class="line">user = request.user</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> user.is_authenticated():</span><br><span class="line">    <span class="keyword">return</span> JsonResponse(&#123;<span class="string">"errno"</span>: <span class="number">0</span>, <span class="string">"error_msg"</span>: <span class="string">"请先登录"</span>&#125;)</span><br><span class="line"><span class="comment"># 1.获取参数并判断</span></span><br><span class="line">sku_id = request.POST.get(<span class="string">"sku_id"</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> sku_id:</span><br><span class="line">    <span class="keyword">return</span> JsonResponse(&#123;<span class="string">"errno"</span>: <span class="number">1</span>, <span class="string">"error_msg"</span>: <span class="string">"参数不完整"</span>&#125;)</span><br><span class="line"><span class="comment"># 2. 校验商品是否存在</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    sku = GoodsSKU.objects.get(id=sku_id)</span><br><span class="line"><span class="keyword">except</span> GoodsSKU.DoesNotExist:</span><br><span class="line">    <span class="keyword">return</span> JsonResponse(&#123;<span class="string">"errno"</span>: <span class="number">2</span>, <span class="string">"error_msg"</span>: <span class="string">"商品不存在"</span>&#125;)</span><br><span class="line"><span class="comment">#3.删除购物车记录</span></span><br><span class="line">conn = get_redis_connection(<span class="string">"default"</span>)</span><br><span class="line">cart_key = <span class="string">"cart_%d"</span> % user.id</span><br><span class="line">conn.hdel(cart_key, sku_id)</span><br><span class="line"><span class="comment">#4.获取更新后的购物车中商品的总件数</span></span><br><span class="line">total_count = <span class="number">0</span></span><br><span class="line">vals = conn.hvals(cart_key)</span><br><span class="line"><span class="keyword">for</span> val <span class="keyword">in</span> vals:</span><br><span class="line">    total_count += int(val)</span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">"errno"</span>: <span class="string">"ok"</span>, <span class="string">"total_count"</span>:total_count, <span class="string">"error_msg"</span>: <span class="string">"删除成功"</span>&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step3</strong> 在模板文件中进行删除事件js编写</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除购物车记录</span></span><br><span class="line">$(<span class="string">'.cart_list_td'</span>).children(<span class="string">'.col08'</span>).children(<span class="string">'a'</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 获取对应商品的id</span></span><br><span class="line">    sku_id = $(<span class="keyword">this</span>).parents(<span class="string">'ul'</span>).find(<span class="string">'.num_show'</span>).attr(<span class="string">"sku_id"</span>);</span><br><span class="line">    csrf = $(<span class="string">'input[name="csrfmiddlewaretoken"]'</span>).val();</span><br><span class="line">    params = &#123;<span class="string">"sku_id"</span>:sku_id, <span class="string">"csrfmiddlewaretoken"</span>:csrf&#125;;</span><br><span class="line">    <span class="comment">// 获取商品所在的ul元素</span></span><br><span class="line">    sku_ul = $(<span class="keyword">this</span>).parents(<span class="string">'ul'</span>);</span><br><span class="line">    $.post(<span class="string">'/cart/delete'</span>, params, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(data.errno == <span class="string">"ok"</span>)&#123;</span><br><span class="line">            <span class="comment">// 删除成功 移除页面上商品所在的ul元素</span></span><br><span class="line">            sku_ul.remove()</span><br><span class="line">            <span class="comment">// 获取被删除商品是否为选中状态</span></span><br><span class="line">            is_checked = sku_ul.find(<span class="string">':checkbox'</span>).prop(<span class="string">'checked'</span>)</span><br><span class="line">            <span class="keyword">if</span>(is_checked)&#123;</span><br><span class="line">                <span class="comment">// 更新页面信息</span></span><br><span class="line">                get_cart_info()</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 重新设置页面上的总件数</span></span><br><span class="line">            $(<span class="string">'.total_count'</span>).children(<span class="string">'em'</span>).text(data.total_count)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            alert(data.error_msg)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step4</strong> 测试</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190406200201765.gif" alt></fancybox></p>
<br>

<p>————————————————<br>版权声明：本文为CSDN博主「cdtaogang」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。<br>原文链接：<a href="https://blog.csdn.net/qq_41782425/article/details/89015816" target="_blank" rel="noopener">https://blog.csdn.net/qq_41782425/article/details/89015816</a></p>

      </div>
      
        <br>
        


  <section class='meta' id="footer-meta">
    <div class='new-meta-box'>
      
        
          <div class="new-meta-item date" itemprop="dateUpdated" datetime="2019-11-13T22:26:17+08:00">
  <a class='notlink'>
    <i class="fas fa-clock" aria-hidden="true"></i>
    <p>更新于 2019年11月13日</p>
  </a>
</div>

        
      
        
          
  
  <div class="new-meta-item meta-tags"><a class="tag" href="/tags/Python/" rel="nofollow"><i class="fas fa-tag" aria-hidden="true"></i><p>Python</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/Django/" rel="nofollow"><i class="fas fa-tag" aria-hidden="true"></i><p>Django</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/Django网站实战/" rel="nofollow"><i class="fas fa-tag" aria-hidden="true"></i><p>Django网站实战</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/Python-Web开发/" rel="nofollow"><i class="fas fa-tag" aria-hidden="true"></i><p>Python Web开发</p></a></div>


        
      
        
          
  <div class="new-meta-item share -mob-share-list">
  <div class="-mob-share-list share-body">
    
      
        <a class="-mob-share-qq" title="QQ好友" rel="external nofollow noopener noreferrer"
          
          href="http://connect.qq.com/widget/shareqq/index.html?url=https://hellotaogang.github.io/2019/11/07/Django项目之Web端电商网站的实战开发（五）/&title=Django项目之Web端电商网站的实战开发（五） | TG'S BLOG&summary=该篇文章是博主一字一码编写的，实属不易，请尊重原创，谢谢大家！温馨提示：需要项目源码的朋友，请添加博主微信进行获取！
&nbsp;&nbsp;本文目录
一丶天天生鲜详情页
二丶天天生鲜列表页
三丶天天生鲜商品搜索
四丶添加商品到购物车
五丶天天生鲜我的购物车页"
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/assets@19.1.9/logo/128/qq.png">
          
        </a>
      
    
      
        <a class="-mob-share-qzone" title="QQ空间" rel="external nofollow noopener noreferrer"
          
          href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://hellotaogang.github.io/2019/11/07/Django项目之Web端电商网站的实战开发（五）/&title=Django项目之Web端电商网站的实战开发（五） | TG'S BLOG&summary=该篇文章是博主一字一码编写的，实属不易，请尊重原创，谢谢大家！温馨提示：需要项目源码的朋友，请添加博主微信进行获取！
&nbsp;&nbsp;本文目录
一丶天天生鲜详情页
二丶天天生鲜列表页
三丶天天生鲜商品搜索
四丶添加商品到购物车
五丶天天生鲜我的购物车页"
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/assets@19.1.9/logo/128/qzone.png">
          
        </a>
      
    
      
        <a class='qrcode' rel="external nofollow noopener noreferrer" href='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQ4AAAEOCAAAAABd2qZ5AAAEAElEQVR42u3a0U7dMBAE0Pv/P337XAHJzK5DqTh5qopJ7BOkya79esXX+/JKxuQj2/lc/8/riQsHDhw4cDy21I/3uZ70x5H5T5NZ5SO/fAE4cODAgeMQx1eJkyzgenLXd75edj6HWejiwIEDB46fwJEsMgndlqx9AThw4MCB43/heMfXdSHXduc2S8WBAwcOHN/PkSypLeFmrb28qJs9/VivFAcOHDhwdHlXNwp/8r8fOd+BAwcOHDjicJoF0nVkboI2bx2+FxcOHDhw4NhzbDZ4ZgXeLOBnrcDhK8SBAwcOHGuOvCWXH4PL23mzwN7UXMWLwYEDBw4cJUfyyCTGNuOfiO28wPtrPA4cOHDgWHPkzbs8iZKWX7uYJLzze94Uezhw4MCB4xBH2xyclWF5I28W57MV1V1MHDhw4MARRGw70dmYTVi2fbw68nHgwIEDx/nq6dVGWhureZHWLnv2xNfGHgcOHDhwXO7j51s17aG32TmLzcGItsi8+frAgQMHDhwxR1JobR6ZHzLYFHLJzKPSDgcOHDhwPMaRF0ubIwjRV8DiapuYOHDgwIHjFEceV/lvJbizsG/bhcUHBA4cOHDgWHPMljc7mjA74pDsCrVF4M2zcODAgQPHmqMY9Nzj4zZi+xoO/I3gwIEDB454VnnJlBdOmwZiTpnTFC8DBw4cOHCsOfLNpHzZecS2958Ve/WzcODAgQPHgmMftPkkkhbhrC04m/8j3x04cODA8es59s3Bm8MB8ZjNBtVswY9sO+HAgQPHr+fID8YlhVbbKDx16CGP2PrkIA4cOHDgGHHsm3qzhc02mU4F9icjceDAgQPHmiNvsSXh1zYQZ5tSeeTnr6rumOLAgQMHjrKEawu572nkJQE8A8WBAwcOHGc5ThVp7TZVXuC1RV3+Gj45KocDBw4cOBYcs0Zb3nqbbV/lS5qVdjchjQMHDhw4Fhz7YiyH24R6exiiDfVPvjtw4MCBA8chjk0x1gbw5tBDvg1WNCJx4MCBA8dRjnzDKW8X5r+7aerlzcebmeDAgQMHjkMceWsvafa1EZ6EcR6cqzjHgQMHDhyHOJI23Ky11x4ymJVebUtxuP+GAwcOHDjihMpLslPl02aR9XmNtiuIAwcOHDgWHO/yajefZkHeFmxtAzH6u8CBAwcOHCOONopaspyy3S7KS9BH4hkHDhw4cFxybMK1PZrQxmS71DZo6zePAwcOHDjaTuGiObjZvpqVeZti7GbbCQcOHDhwfDvH9R1mWO22U3JYoW5u4sCBAweOf8qRl3xJAzEf076Y+nwHDhw4cOBYc7RxlWfThqO9Zxv/q20nHDhw4MCxPtCwafnNIJIF53duN89w4MCBA0fJ8QcglnIULSu8fQAAAABJRU5ErkJggg=='>
        
          <img src="https://cdn.jsdelivr.net/gh/xaoxuu/assets@19.1.9/logo/128/wechat.png">
        
        </a>
      
    
      
        <a class="-mob-share-weibo" title="微博" rel="external nofollow noopener noreferrer"
          
          href="http://service.weibo.com/share/share.php?url=https://hellotaogang.github.io/2019/11/07/Django项目之Web端电商网站的实战开发（五）/&title=Django项目之Web端电商网站的实战开发（五） | TG'S BLOG&summary=该篇文章是博主一字一码编写的，实属不易，请尊重原创，谢谢大家！温馨提示：需要项目源码的朋友，请添加博主微信进行获取！
&nbsp;&nbsp;本文目录
一丶天天生鲜详情页
二丶天天生鲜列表页
三丶天天生鲜商品搜索
四丶添加商品到购物车
五丶天天生鲜我的购物车页"
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/assets@19.1.9/logo/128/weibo.png">
          
        </a>
      
    
  </div>
</div>



        
      
    </div>
  </section>


      
      
          <div class="prev-next">
              
                  <section class="prev">
                      <span class="art-item-left">
                          <h6><i class="fas fa-chevron-left" aria-hidden="true"></i>&nbsp;上一页</h6>
                          <h4>
                              <a href="/2019/11/07/Django项目之Web端电商网站的实战开发（完结）/" rel="prev" title="Django项目之Web端电商网站的实战开发（完结）">
                                
                                    Django项目之Web端电商网站的实战开发（完结）
                                
                              </a>
                          </h4>
                          
                              
                              <h6 class="tags">
                                  <a class="tag" href="/tags/Python/"><i class="fas fa-tag fa-fw" aria-hidden="true"></i> Python</a> <a class="tag" href="/tags/Django/"><i class="fas fa-tag fa-fw" aria-hidden="true"></i> Django</a> <a class="tag" href="/tags/Django网站实战/"><i class="fas fa-tag fa-fw" aria-hidden="true"></i> Django网站实战</a> <a class="tag" href="/tags/Python-Web开发/"><i class="fas fa-tag fa-fw" aria-hidden="true"></i> Python Web开发</a>
                              </h6>
                          
                      </span>
                  </section>
              
              
                  <section class="next">
                      <span class="art-item-right" aria-hidden="true">
                          <h6>下一页&nbsp;<i class="fas fa-chevron-right" aria-hidden="true"></i></h6>
                          <h4>
                              <a href="/2019/11/07/Django项目之Web端电商网站的实战开发（四）/" rel="prev" title="Django项目之Web端电商网站的实战开发（四）">
                                  
                                      Django项目之Web端电商网站的实战开发（四）
                                  
                              </a>
                          </h4>
                          
                              
                              <h6 class="tags">
                                  <a class="tag" href="/tags/Python/"><i class="fas fa-tag fa-fw" aria-hidden="true"></i> Python</a> <a class="tag" href="/tags/Django/"><i class="fas fa-tag fa-fw" aria-hidden="true"></i> Django</a> <a class="tag" href="/tags/Django网站实战/"><i class="fas fa-tag fa-fw" aria-hidden="true"></i> Django网站实战</a> <a class="tag" href="/tags/Python-Web开发/"><i class="fas fa-tag fa-fw" aria-hidden="true"></i> Python Web开发</a>
                              </h6>
                          
                      </span>
                  </section>
              
          </div>
      
    </section>
  </article>



  <!-- 显示推荐文章和评论 -->



  <article class="post white-box comments">
    <section class="article typo">
      <h4><i class="fas fa-comments fa-fw" aria-hidden="true"></i>&nbsp;评论</h4>
      
      
      
        <section id="comments">
          <div id="gitalk-container"></div>
        </section>
      
      
    </section>
  </article>






<!-- 根据页面mathjax变量决定是否加载MathJax数学公式js -->



  <script>
    window.subData = {
      title: 'Django项目之Web端电商网站的实战开发（五）',
      tools: true
    }
  </script>


</div>
<aside class='l_side'>
  
    
    
      
        
          
          
        
          
          
            
              
  <section class='widget toc-wrapper'>
    
<header class='pure'>
  <div><i class="fas fa-list fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;本文目录</div>
  
    <!-- <div class='wrapper'><a class="s-toc rightBtn" rel="external nofollow noopener noreferrer" href="javascript:void(0)"><i class="fas fa-thumbtack fa-fw"></i></a></div> -->
  
</header>

    <div class='content pure'>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#一丶天天生鲜详情页"><span class="toc-text">一丶天天生鲜详情页</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#二丶天天生鲜列表页"><span class="toc-text">二丶天天生鲜列表页</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#三丶天天生鲜商品搜索"><span class="toc-text">三丶天天生鲜商品搜索</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#四丶添加商品到购物车"><span class="toc-text">四丶添加商品到购物车</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#五丶天天生鲜我的购物车页"><span class="toc-text">五丶天天生鲜我的购物车页</span></a></li></ol>
    </div>
  </section>


            
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
      
    

  
</aside>

<footer id="footer" class="clearfix">
  
  
    <div class="social-wrapper">
      
        
          <a href="http://wpa.qq.com/msgrd?v=3&amp;uin=1126331350&amp;site=qq&amp;menu=yes"
            class="social fab fa-qq flat-btn flat-btn"
            target="_blank"
            rel="external nofollow noopener noreferrer">
          </a>
        
      
        
          <a href="https://cdn.jsdelivr.net/gh/Hellotaogang/cdn@4.4/about/wxhy.png"
            class="social fab fa-weixin flat-btn flat-btn"
            target="_blank"
            rel="external nofollow noopener noreferrer">
          </a>
        
      
        
          <a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=cdtaogang@163.com"
            class="social fas fa-envelope flat-btn"
            target="_blank"
            rel="external nofollow noopener noreferrer">
          </a>
        
      
        
          <a href="https://github.com/Hellotaogang"
            class="social fab fa-github flat-btn"
            target="_blank"
            rel="external nofollow noopener noreferrer">
          </a>
        
      
        
          <a href="https://blog.csdn.net/qq_41782425"
            class="social fab fa-cuttlefish flat-btn flat-btn"
            target="_blank"
            rel="external nofollow noopener noreferrer">
          </a>
        
      
    </div>
  
  <br>
  <div><p>Copyright <i class='far fa-copyright'></i> 2019-2020 <a style='color: #333333' href='https://www.cdtaogang.top/' target='_blank'>TG’BLOG</a>&nbsp;&nbsp;|&nbsp;&nbsp;<span id='timeDate'>载入天数…</span><span id='times'>载入时分秒…</span></p>
</div>
  <br>
  <div>
    <div class='github-badge'> <a style='color: #fff' href='https://hexo.io/'><span class='badge-subject'>框架</span><span class='badge-value bg-blue'>Hexo</span></a> </div> <div class='github-badge'> <a style='color: #fff' href='https://github.com/'><span class='badge-subject'>托管</span><span class='badge-value bg-brightgreen'>GitHub</span></a> </div> <div class='github-badge'> <a style='color: #fff' href='https://www.aliyun.com/'><span class='badge-subject'>域名</span><span class='badge-value bg-firebrick'>Aliyun</span></a> </div> <div class='github-badge'> <a style='color: #fff' href='https://www.jsdelivr.com/'><span class='badge-subject'>内容分发网络</span><span class='badge-value bg-orange'>jsDelivr</span></a> </div> <div class='github-badge'> <a style='color: #fff' href='https://996.icu/#/zh_CN'><span class='badge-subject'>链接</span><span class='badge-value bg-red'>996.ICU</span></a> </div> <div class='github-badge'> <a style='color: #fff' href='https://xaoxuu.com/wiki/material-x/'><span class='badge-subject'>主题</span><span class='badge-value bg-blue'>Material X</span></a> </div> <div class='github-badge'> <a style='color: #fff' href='https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh'><span class='badge-subject'>协议</span><span class='badge-value bg-pink'>BY-NC-SA 4.0</span></a> </div>
  </div>
<script>
    var now = new Date(); 
    function createtime() { 
        var grt= new Date("10/11/2019 21:38:00");//在此处修改你的建站时间
        now.setTime(now.getTime()+250); 
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days); 
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours); 
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum); 
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;} 
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum); 
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;} 
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 "; 
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒"; 
    } 
setInterval("createtime()",250);
</script>
</footer>
<script>setLoadingBarProgress(80);</script>



      <script>setLoadingBarProgress(60);</script>
    </div>
    <a class="s-top fas fa-arrow-up fa-fw" href='javascript:void(0)'></a>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>

  <script>
    var GOOGLE_CUSTOM_SEARCH_API_KEY = "";
    var GOOGLE_CUSTOM_SEARCH_ENGINE_ID = "";
    var ALGOLIA_API_KEY = "";
    var ALGOLIA_APP_ID = "";
    var ALGOLIA_INDEX_NAME = "";
    var AZURE_SERVICE_NAME = "";
    var AZURE_INDEX_NAME = "";
    var AZURE_QUERY_KEY = "";
    var BAIDU_API_ID = "";
    var SEARCH_SERVICE = "hexo" || "hexo";
    var ROOT = "/"||"/";
    if(!ROOT.endsWith('/'))ROOT += '/';
  </script>

<script src="//instant.page/1.2.2" type="module" integrity="sha384-2xV8M5griQmzyiY3CDqh1dn4z3llDVqZDqzjzcY+jCBCk/a5fXJmuZ/40JJAPeoU"></script>


  <script async src="https://cdn.jsdelivr.net/npm/scrollreveal@4.0.5/dist/scrollreveal.min.js"></script>
  <script type="text/javascript">
    $(function() {
      const $reveal = $('.reveal');
      if ($reveal.length === 0) return;
      const sr = ScrollReveal({ distance: 0 });
      sr.reveal('.reveal');
    });
  </script>


  <script src="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.js"></script>
  <script type="text/javascript">
    $(function() {
      Waves.attach('.flat-btn', ['waves-button']);
      Waves.attach('.float-btn', ['waves-button', 'waves-float']);
      Waves.attach('.float-btn-light', ['waves-button', 'waves-float', 'waves-light']);
      Waves.attach('.flat-box', ['waves-block']);
      Waves.attach('.float-box', ['waves-block', 'waves-float']);
      Waves.attach('.waves-image');
      Waves.init();
    });
  </script>


  <script async src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-busuanzi@2.3/js/busuanzi.pure.mini.js"></script>




  
  
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-backstretch/2.0.4/jquery.backstretch.min.js"></script>
    <script type="text/javascript">
      $(function(){
        if ('.cover') {
          $('.cover').backstretch(
          ["https://cdn.jsdelivr.net/gh/Hellotaogang/cdn@4.5.7/images/background_4.jpg", "https://cdn.jsdelivr.net/gh/Hellotaogang/cdn@4.5.7/images/background_5.jpg", "https://cdn.jsdelivr.net/gh/Hellotaogang/cdn@4.5.7/images/background_6.jpg"],
          {
            duration: "6000",
            fade: "2500"
          });
        } else {
          $.backstretch(
          ["https://cdn.jsdelivr.net/gh/Hellotaogang/cdn@4.5.7/images/background_4.jpg", "https://cdn.jsdelivr.net/gh/Hellotaogang/cdn@4.5.7/images/background_5.jpg", "https://cdn.jsdelivr.net/gh/Hellotaogang/cdn@4.5.7/images/background_6.jpg"],
          {
            duration: "6000",
            fade: "2500"
          });
        }
      });
    </script>
  







  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
  <script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js"></script>
  <script type="text/javascript">
    var gitalk = new Gitalk({
      clientID: "71020b6958cd6bbf65b7",
      clientSecret: "3cfeccd9125b8bac76f2bd8a7f6e30a601ae3a81",
      repo: "Hellotaogang.github.io",
      owner: "Hellotaogang",
      admin: "Hellotaogang",
      
        id: md5(location.pathname),      // Ensure uniqueness and length less than 50
      
      distractionFreeMode: false  // Facebook-like distraction free mode
    });
    gitalk.render('gitalk-container');
  </script>





  <script src="/js/app.js"></script>


  <script src="/js/search.js"></script>




<!-- 复制 -->
<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  let COPY_SUCCESS = "复制成功";
  let COPY_FAILURE = "复制失败";
  /*页面载入完成后，创建复制按钮*/
  !function (e, t, a) {
    /* code */
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '  <i class="fa fa-copy"></i><span>复制</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });

      clipboard.on('success', function(e) {
        //您可以加入成功提示
        console.info('Action:', e.action);
        console.info('Text:', e.text);
        console.info('Trigger:', e.trigger);
        success_prompt(COPY_SUCCESS);
        e.clearSelection();
      });
      clipboard.on('error', function(e) {
        //您可以加入失败提示
        console.error('Action:', e.action);
        console.error('Trigger:', e.trigger);
        fail_prompt(COPY_FAILURE);
      });
    }
    initCopyCode();

  }(window, document);

  /**
   * 弹出式提示框，默认1.5秒自动消失
   * @param message 提示信息
   * @param style 提示样式，有alert-success、alert-danger、alert-warning、alert-info
   * @param time 消失时间
   */
  var prompt = function (message, style, time)
  {
      style = (style === undefined) ? 'alert-success' : style;
      time = (time === undefined) ? 1500 : time*1000;
      $('<div>')
          .appendTo('body')
          .addClass('alert ' + style)
          .html(message)
          .show()
          .delay(time)
          .fadeOut();
  };

  // 成功提示
  var success_prompt = function(message, time)
  {
      prompt(message, 'alert-success', time);
  };

  // 失败提示
  var fail_prompt = function(message, time)
  {
      prompt(message, 'alert-danger', time);
  };

  // 提醒
  var warning_prompt = function(message, time)
  {
      prompt(message, 'alert-warning', time);
  };

  // 信息提示
  var info_prompt = function(message, time)
  {
      prompt(message, 'alert-info', time);
  };

</script>


<!-- fancybox -->
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
<script>
  let LAZY_LOAD_IMAGE = "";
  $(".article-entry").find("fancybox").find("img").each(function () {
      var element = document.createElement("a");
      $(element).attr("data-fancybox", "gallery");
      $(element).attr("href", $(this).attr("src"));
      /* 图片采用懒加载处理时,
       * 一般图片标签内会有个属性名来存放图片的真实地址，比如 data-original,
       * 那么此处将原本的属性名src替换为对应属性名data-original,
       * 修改如下
       */
       if (LAZY_LOAD_IMAGE) {
         $(element).attr("href", $(this).attr("data-original"));
       }
      $(this).wrap(element);
  });
</script>





  <script>setLoadingBarProgress(100);</script>
  <!-- 页面点击小红心 -->
  <!-- <script type="text/javascript" src="/js/love.js"></script> -->
  <!--单击显示文字-->
  <!-- <script type="text/javascript" src="/js/click_show_text.js"></script> -->
  <!-- 鼠标点击烟花 -->
  <!-- <canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" ></canvas> 
  <script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script> 
  <script type="text/javascript" src="/js/fireworks.js"></script> -->
  <!--浏览器搞笑标题-->
  <script type="text/javascript" src="\js\FunnyTitle.js"></script>
  <!--动态线条背景-->
  <script type="text/javascript"
color="0,0,0" opacity='0.7' zIndex="-2" count="200" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js">
  </script>
  <!-- 样式一（鼠标点击更换样式） -->
<!-- <script src="https://g.joyinshare.com/hc/ribbon.min.js" type="text/javascript"></script> -->
<!-- 样式二（飘动的彩带） -->
<!-- <script src="https://g.joyinshare.com/hc/piao.js" type="text/javascript"></script> -->
  <!-- 数字雨 -->
  <!-- <canvas id="canvas" width="1440" height="900" ></canvas>
  <script type="text/javascript" src="/js/DigitalRain.js"></script> -->
</body>
</html>
