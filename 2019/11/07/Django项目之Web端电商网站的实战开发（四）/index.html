<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  
  <title>Django项目之Web端电商网站的实战开发（四） | TG&#39;S BLOG</title>
  
  
  <meta name="description" content="该篇文章是博主一字一码编写的，实属不易，请尊重原创，谢谢大家！">
  

  

  <meta name="HandheldFriendly" content="True">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <!-- meta -->
  

  <!-- link -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.css">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.10.1/css/all.min.css">
  

  
  <link rel="shortcut icon" type="image/x-icon" href="https://cdn.jsdelivr.net/gh/Hellotaogang/cdn@4.3/images/favicon.ico">
  

  
    <link rel="stylesheet" href="/style.css">
  

  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>

  
  
</head>

<body>
  
  
  <div class="cover-wrapper">
    <cover class='cover post half'>
      
        
  <img class='logo' src='https://cdn.jsdelivr.net/gh/Hellotaogang/cdn@4.5.6/images/logo_2.png'/>


  <div class="m_search">
    <form name="searchform" class="form u-search-form">
      <input type="text" class="input u-search-input" placeholder="" />
      <i class="icon fas fa-search fa-fw"></i>
    </form>
  </div>

<div class='menu navgation'>
  <ul class='h-list'>
    
      
        <li>
          <a class="nav home" href="/"
            
            
            id="home">
            <i class='fas fa-home fa-fw'></i>&nbsp;主页
          </a>
        </li>
      
        <li>
          <a class="nav home" href="/categories/"
            
            
            id="categories">
            <i class='fas fa-folder-open fa-fw'></i>&nbsp;分类
          </a>
        </li>
      
        <li>
          <a class="nav home" href="/tags/"
            
              rel="nofollow"
            
            
            id="tags">
            <i class='fas fa-tags fa-fw'></i>&nbsp;标签
          </a>
        </li>
      
        <li>
          <a class="nav home" href="/love/"
            
              rel="nofollow"
            
            
            id="love">
            <i class='fas fa-heart fa-fw'></i>&nbsp;记录
          </a>
        </li>
      
        <li>
          <a class="nav home" href="/about/"
            
              rel="nofollow"
            
            
            id="about">
            <i class='fas fa-info-circle fa-fw'></i>&nbsp;关于
          </a>
        </li>
      
    
  </ul>
</div>

      
    </cover>
    <header class="l_header pure">
  <div id="loading-bar-wrapper">
    <div id="loading-bar" class="pure"></div>
  </div>

	<div class='wrapper'>
		<div class="nav-main container container--flex">
      <a class="logo flat-box" href='/' >
        
          TG'S BLOG
        
      </a>
			<div class='menu navgation'>
				<ul class='h-list'>
          
  					
  						<li>
								<a class="nav flat-box" href="/"
                  
                  
                  id="home">
									<i class='fas fa-home fa-fw'></i>&nbsp;主页
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/categories/"
                  
                    rel="nofollow"
                  
                  
                  id="categories">
									<i class='fas fa-folder-open fa-fw'></i>&nbsp;分类
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/tags/"
                  
                    rel="nofollow"
                  
                  
                  id="tags">
									<i class='fas fa-tags fa-fw'></i>&nbsp;标签
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/archives/"
                  
                    rel="nofollow"
                  
                  
                  id="archives">
									<i class='fas fa-archive fa-fw'></i>&nbsp;归档
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/love/"
                  
                    rel="nofollow"
                  
                  
                  id="love">
									<i class='fas fa-heart fa-fw'></i>&nbsp;记录
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/about/"
                  
                    rel="nofollow"
                  
                  
                  id="about">
									<i class='fas fa-info-circle fa-fw'></i>&nbsp;关于
								</a>
							</li>
      			
      		
				</ul>
			</div>

			
				<div class="m_search">
					<form name="searchform" class="form u-search-form">
						<input type="text" class="input u-search-input" placeholder="搜索" />
						<i class="icon fas fa-search fa-fw"></i>
					</form>
				</div>
			
			<ul class='switcher h-list'>
				
					<li class='s-search'><a class="fas fa-search fa-fw" href='javascript:void(0)'></a></li>
				
				<li class='s-menu'><a class="fas fa-bars fa-fw" href='javascript:void(0)'></a></li>
			</ul>
		</div>

		<div class='nav-sub container container--flex'>
			<a class="logo flat-box"></a>
			<ul class='switcher h-list'>
				<li class='s-comment'><a class="flat-btn fas fa-comments fa-fw" href='javascript:void(0)'></a></li>
        
          <li class='s-toc'><a class="flat-btn fas fa-list fa-fw" href='javascript:void(0)'></a></li>
        
			</ul>
		</div>
	</div>
</header>
	<aside class="menu-phone">
    <header>
		<nav class="menu navgation">
      <ul>
        
          
            <li>
							<a class="nav flat-box" href="/"
                
                
                id="home">
								<i class='fas fa-clock fa-fw'></i>&nbsp;近期文章
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/blog/archives/"
                
                  rel="nofollow"
                
                
                id="blogarchives">
								<i class='fas fa-archive fa-fw'></i>&nbsp;文章归档
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/projects/"
                
                
                id="projects">
								<i class='fas fa-code-branch fa-fw'></i>&nbsp;开源项目
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/friends/"
                
                  rel="nofollow"
                
                
                id="friends">
								<i class='fas fa-link fa-fw'></i>&nbsp;我的友链
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="https://xaoxuu.com/wiki/material-x/"
                
                  rel="nofollow"
                
                
                id="https:xaoxuu.comwikimaterial-x">
								<i class='fas fa-book fa-fw'></i>&nbsp;主题文档
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/about/"
                
                  rel="nofollow"
                
                
                id="about">
								<i class='fas fa-info-circle fa-fw'></i>&nbsp;关于小站
							</a>
            </li>
          
       
      </ul>
		</nav>
    </header>
	</aside>
<script>setLoadingBarProgress(40);</script>

  </div>


  <div class="l_body">
    <div class='body-wrapper'>
      <div class='l_main'>
  

  <article id="post" class="post white-box article-type-post" itemscope itemprop="blogPost">
    


  <section class='meta'>
    
    
      <a title='Django项目之Web端电商网站的实战开发（四）' href='/2019/11/07/Django项目之Web端电商网站的实战开发（四）/'><img class='thumbnail' src='https://cdn.jsdelivr.net/gh/Hellotaogang/cdn@4.6.2/images/django.png'></a>
    
    <div class="meta" id="header-meta">
      
        
  
    <h1 class="title">
      <a href="/2019/11/07/Django项目之Web端电商网站的实战开发（四）/">
        Django项目之Web端电商网站的实战开发（四）
      </a>
    </h1>
  


      
      <div class='new-meta-box'>
        
          
        
          
            
  <div class='new-meta-item author'>
    
      <a href="/" rel="nofollow">
        
          <img src="https://cdn.jsdelivr.net/gh/Hellotaogang/cdn@4.4.3/images/avatar_4.png">
        
        <p>cdtaogang</p>
      </a>
    
  </div>


          
        
          
            <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt" aria-hidden="true"></i>
    <p>2019-11-07</p>
  </a>
</div>

          
        
          
            
  
  <div class='new-meta-item category'>
    <a href='/categories/Django开发/' rel="nofollow">
      <i class="fas fa-folder-open" aria-hidden="true"></i>
      <p>Django开发</p>
    </a>
  </div>


          
        
          
            
  
    <div class="new-meta-item browse busuanzi">
      <a class='notlink'>
        <i class="fas fa-eye" aria-hidden="true"></i>
        <p>
          <span id="busuanzi_value_page_pv">
            <i class="fas fa-spinner fa-spin fa-fw" aria-hidden="true"></i>
          </span>
        </p>
      </a>
    </div>
  


          
        
          
            

          
        
      </div>
      
        <hr>
      
    </div>
  </section>


    <section class="article typo">
      <div class="article-entry" itemprop="articleBody">
        <p>该篇文章是博主一字一码编写的，实属不易，请尊重原创，谢谢大家！<br><font style="color:red">温馨提示：需要项目源码的朋友，请添加博主微信进行获取！</font></p>
<div style="color:#fb651b"><i class="fas fa-list fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;本文目录</div>
<li class="toc-item toc-level-1"><a style=" text-decoration:none;" href="#一丶Windows环境下安装FastDFS_Client"><span style="color:#4ea1db">一丶Windows环境下安装FastDFS_Client</span></a></li>
<li class="toc-item toc-level-1"><a style=" text-decoration:none;" href="#二丶Django二次开发对接FastDFS"><span style="color:#4ea1db">二丶Django二次开发对接FastDFS</span></a></li>
<li class="toc-item toc-level-1"><a style=" text-decoration:none;" href="#三丶天天生鲜首页"><span style="color:#4ea1db">三丶天天生鲜首页</span></a></li>
<a id="more"></a>

<h1 id="一丶Windows环境下安装FastDFS-Client"><a href="#一丶Windows环境下安装FastDFS-Client" class="headerlink" title="一丶Windows环境下安装FastDFS_Client"></a>一丶Windows环境下安装FastDFS_Client</h1><p>1.在windows环境下直接使用pip install fdfs-client-py进行安装则会出现以下提示</p>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190331164922518.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<p>2.在windows环境下需进行如下安装</p>
<ul>
<li><p><strong>step1</strong> 下载fdfs_client包<a href="https://pan.baidu.com/s/11Rd6q3vr7vH3Lr1_8JMfSw" target="_blank" rel="noopener">https://pan.baidu.com/s/11Rd6q3vr7vH3Lr1_8JMfSw</a>，提取码u1d7</p>
</li>
<li><p><strong>step2</strong> 将解压之后的fdfs_client文件夹copy到python解释器下的Lib目录中</p>
</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190331165713406.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<ul>
<li><strong>step3</strong> 进入fdfs_client目录，编辑storage_client.py文件，将第12行代码注释（避免提示ImportError: No module named sendfile错误信息）</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190331165849498.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<ul>
<li><strong>step4</strong> 安装mutagen</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190331170042559.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<ul>
<li><strong>step5</strong> 安装requests</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190331170105694.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<ul>
<li><strong>step6</strong> 在解释器目录下新建logs文件夹，用于存放fdfs客户端日志文件</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190331170230826.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<ul>
<li><strong>step7</strong> 修改fdfs配置文件client.conf，需要注意的是base_path的路径是在以client.conf为起始路径进行查找的</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190331170340730.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<p><img src="https://img-blog.csdnimg.cn/20190331170521284.png" alt></p>
<ul>
<li><strong>step8</strong> 回到虚拟机ubuntu（192.168.1.10），开启fdfs服务以及nginx服务</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190331171207266.png" alt></p>
<p><img src="https://img-blog.csdnimg.cn/20190331171220833.png" alt></p>
<ul>
<li><strong>step9</strong> 进行上传文件测试，打开cmd命令窗口，进行python2环境（博主将一个水果图片直接放在D盘中然后进行此图片上传操作），配置文件路径以及要上传的文件路径均为绝对路径</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fdfs_client.client <span class="keyword">import</span> Fdfs_client</span><br><span class="line">client = Fdfs_client(<span class="string">r"D:\Python27\Lib\fdfs_client\client.conf"</span>)</span><br><span class="line">client.upload_by_filename(<span class="string">r"D:\goods.jpg"</span>)</span><br></pre></td></tr></table></figure>

<p><fancybox><img src="https://img-blog.csdnimg.cn/20190331171553856.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<ul>
<li><strong>step10</strong> <font style="color:red">上传成功后，返回文件id，在windows浏览器中直接访问ubuntu电脑的ip（也就是nginx服务器的ip端口，然后nginx再去到fdfs系统中获取对应文件id的文件，最后返回给浏览器，最后浏览器将该文件渲染出来，最终显示出图片）</font><a href="http://192.168.1.10:8888/group1//M00/00/00/wKgBClygfSuAO8GOAAAX1PFRdzg942.jpg" target="_blank" rel="noopener">http://192.168.1.10:8888/group1//M00/00/00/wKgBClygfSuAO8GOAAAX1PFRdzg942.jpg</a>，如下图可以看见响应报头中的server为在ubuntu中安装的nginx版本</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190331172049650.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<ul>
<li><strong>step11</strong> 同样的在ubuntu系统中访问该上传成功的文件id，一样成功的在浏览器中显示出来（这里的IP就要写本地的IP）</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/2019033117350672.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<h1 id="二丶Django二次开发对接FastDFS"><a href="#二丶Django二次开发对接FastDFS" class="headerlink" title="二丶Django二次开发对接FastDFS"></a>二丶Django二次开发对接FastDFS</h1><p>1.项目中使用上传图片使用图片流程图</p>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190331201507905.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<p>2.更改django默认上传文件的存储方式 ，django站点管理中进行文件的上传默认使用的是FileSystemStorage类，这个类在本地文件系统上实现了基本的文件存储功能，它继承自Storage类 ，并且提供父类的所有公共方法的实现，所以可以定义一个类来继承Storage类，重写这个类中方法来实现更改django的默认存储方式，可以参考django的API文档</p>
<p>3.编写一个自定义存储系统，</p>
<ul>
<li><strong>step1</strong> 自定义的存储系统必须为 Django.core.files.storage.Storage的一个子类</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.core.files.storage <span class="keyword">import</span> Storage</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyStorage</span><span class="params">(Storage)</span>:</span></span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step2</strong> 在你的存储类中，除了其他自定义的方法外，还必须实现 _open()打开文件 以及 _save()保存文件方法，如果你的类提供了本地文件存储，它必须重载 path() 方法</li>
<li><strong>step3</strong> 在项目utils目录下创建一个fdfs的python包，并在这个包下创建storage.py模块，在这个模块中实现自定义存储系统</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190331173714275.png" alt></p>
<ul>
<li><strong>step4</strong> 在storage.py中定义一个类继承与storage的子类Stroage，实现_open()以及_save()方法</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190331174052546.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<ul>
<li><strong>step5</strong> 导入Fdfs_client类，将client.conf配置文件拷贝到utils/fdfs目录下</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190331174734841.png" alt></p>
<ul>
<li><strong>step6</strong> 修改client.conf配置文件中</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">base_path=D:\Python27\logs</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step7</strong> 因为项目中场景不使用_open方法，只是用_save方法，所以在_save进行编写，创建Fdfs_client对象</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">client = Fdfs_client(<span class="string">r"./utils/fdfs/client.conf"</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step8</strong> 上传文件到FastDFS系统中,upload_by_buffer方法是上传文件内容，而不是文件名了</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res = client.upload_by_buffer(content.read())</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step9</strong> 判断是否上传成功</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 上传成功返回的字段数据</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">dict</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    'Group name': group_name,</span></span><br><span class="line"><span class="string">    'Remote file_id': remote_file_id,</span></span><br><span class="line"><span class="string">    'Status': 'Upload successed.',</span></span><br><span class="line"><span class="string">    'Local file name': '',</span></span><br><span class="line"><span class="string">    'Uploaded size': upload_size,</span></span><br><span class="line"><span class="string">    'Storage IP': storage_ip</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">if</span> res.get(<span class="string">"Status"</span>) != <span class="string">"Upload successed."</span>:</span><br><span class="line">    <span class="comment"># 表示上传失败</span></span><br><span class="line">    <span class="keyword">raise</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step10</strong> 上传成功获取文件id，并返回</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">filename = res.get(<span class="string">"Remote file_id"</span>)</span><br><span class="line"><span class="keyword">return</span> filename</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step11</strong> 重写exists方法调用_save方法之前会去调用exists方法，判断文件在系统中是够存在</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exists</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        <span class="string">"""如果提供的名称所引用的文件在文件系统中存在，则返回True，否则如果这个名称可用于新文件，返回False"""</span></span><br><span class="line">        <span class="comment"># 因为在django中不存在文件名情况，所以直接返回false</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<p>4.在django admin后台管理页面测试文件存储类</p>
<ul>
<li><strong>step1</strong> 在settings配置文件中设置django文件存储类为上面定义的类</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DEFAULT_FILE_STORAGE = <span class="string">"utils.fdfs.storage.FDFSStorage"</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step2</strong> 在df_goods/admin中注册商品类型模型类</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> df_goods.models <span class="keyword">import</span> GoodsType</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 注册商品类型模型类</span></span><br><span class="line">admin.site.register(GoodsType)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step3</strong> 创建超级管理员</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190331185455228.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<ul>
<li><strong>step4</strong> 在浏览器输入<a href="http://127.0.0.1:8000/admin/" target="_blank" rel="noopener">http://127.0.0.1:8000/admin/</a> 进入后台管理页面</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190331185828156.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<ul>
<li><strong>step5</strong> 在商品种类栏点击增加（标识标识的是商品分类中对应分类标签中的class的值）</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/2019033119025756.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<ul>
<li><strong>step6</strong> 点击保存后，提示保存成功</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190331190634803.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<ul>
<li><strong>step7</strong> 进入新鲜水果后，出现错误提示，必须保证有一个url方法</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190331190730125.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<ul>
<li><strong>step8</strong> 在FDFSStorage类中定义url方法，直接返回name</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">url</span><span class="params">(self, name)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> name</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step9</strong> 刷新报错页面，显示出filename的值（也就是上传文件到FastDFS成功后返回的文件id的值）</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/2019033119145176.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<ul>
<li><strong>step10</strong> 在浏览器中访问<a href="http://192.168.1.10:8888/group1/M00/00/00/wKgBClygnuOATdepAAAgnaeGwNQ6841857" target="_blank" rel="noopener">http://192.168.1.10:8888/group1/M00/00/00/wKgBClygnuOATdepAAAgnaeGwNQ6841857</a>，则出现下载，因为在获取Remote file_id的值的时候，并没有后缀名，导致出现下载</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190331192401289.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<ul>
<li><strong>step11</strong> 新建一个html文件，创建img标签，src就等于<a href="http://192.168.1.10:8888/group1/M00/00/00/wKgBClygnuOATdepAAAgnaeGwNQ6841857" target="_blank" rel="noopener">http://192.168.1.10:8888/group1/M00/00/00/wKgBClygnuOATdepAAAgnaeGwNQ6841857</a></li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190331192704887.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<ul>
<li><strong>step12</strong> 直接打开该html文件，成功将图片显示出来</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190331193139786.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<ul>
<li><strong>step13</strong> 修改url方法返回参数</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">url</span><span class="params">(self, name)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"http://192.168.1.10:8888/"</span>+name</span><br></pre></td></tr></table></figure>

<p>5.优化自定义文件存储类</p>
<ul>
<li><strong>step1</strong> 在settings配置文件中设置client.conf的路径以及nginx服务器的ip和port</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置fdfs使用client.conf配置文件的路径</span></span><br><span class="line">FDFS_CLIENT_CONF_PATH = <span class="string">r"./utils/fdfs/client.conf"</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 设置fdfs存储系统上的ngin服务器的ip和端口</span></span><br><span class="line">FDFS_URL = <span class="string">r"http://192.168.1.10:8888/"</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step2</strong> 在FDFSStorage类中定义魔法方法，使client.conf的路径以及nginx服务器的ip和port动态生成，增强存储类的灵活性</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, client_conf=None, base_url=None)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> client_conf <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        client_conf = settings.FDFS_CLIENT_CONF_PATH</span><br><span class="line">    <span class="keyword">if</span> base_url <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        base_url = settings.FDFS_URL</span><br><span class="line">    self.client_conf = client_conf</span><br><span class="line">    self.base_url = base_url</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step3</strong> 将以下两处进行替换</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">client = Fdfs_client(self.client_conf)</span><br><span class="line"><span class="keyword">return</span> self.base_url+name</span><br></pre></td></tr></table></figure>

<h1 id="三丶天天生鲜首页"><a href="#三丶天天生鲜首页" class="headerlink" title="三丶天天生鲜首页"></a>三丶天天生鲜首页</h1><p>1.定义类视图显示首页页面</p>
<ul>
<li><strong>step1</strong> 在df_goods/views中定义IndexView类视图，并在这个类中定义get方法，用于显示首页</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># http://127.0.0.1:8000</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexView</span><span class="params">(View)</span>:</span></span><br><span class="line">    <span class="string">'''首页'''</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        <span class="string">'''显示首页'''</span></span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">'index.html'</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step2</strong> 在df_goods/urls中导入类视图，并调用其父类的as_view方法</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url(<span class="string">r"^$"</span>, IndexView.as_view(), name=<span class="string">"index"</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step3</strong> 进入<a href="http://127.0.0.1:8000/" target="_blank" rel="noopener">http://127.0.0.1:8000/</a>项目首页地址，成功显示首页页面</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190401092056392.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<ul>
<li><strong>step4</strong> 将df_goods/models中的IndexPromotionBanner首页促销活动模型类的url字段的类型修改为CharField类型，因为URLField类型，在admin中注册后，在django管理后台进行添加时，会去解析URL链接地址是否有效，并且该字段是必须填写的，所以修改为CharField类型，就可填可不填，并且不用去解析</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url = models.CharField(max_length=<span class="number">256</span>,  verbose_name=<span class="string">'活动链接'</span>)</span><br></pre></td></tr></table></figure>

<p>2.首页内容获取与展示</p>
<ul>
<li><strong>step1</strong> 在IndexView类视图get方法中，获取商品的种类信息</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190401093907439.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">types = GoodsType.objects.all()</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step2</strong> 获取首页页面幻灯片中的商品信息，以index字段（展示顺序）进行排序</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190401094102431.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">goods_banners = IndexGoodsBanner.objects.all().order_by(<span class="string">'index'</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step3</strong> 获取首页促销活动信息，以以index字段（展示顺序）进行排序</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190401094243685.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">promotion_banners = IndexPromotionBanner.objects.all().order_by(<span class="string">'index'</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step4</strong> 获取首页中分类商品展示信息（types），遍历商品种类信息，获取每个商品种类（type）为GoodsType对象，然后在数据库商品分类表（IndexTypeGoodsBanner）中根据type字段（商品类型）以及display_type（展示类型）查询数据，并按照表index字段（展示顺序）进行排序显示，display_type=1表示图片展示类型，display_type=2表示文字展示类型；然后给每个商品种类对象添加image_banners属性以及title_banners属性</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190401094452699.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> type <span class="keyword">in</span> types: <span class="comment"># GoodsType</span></span><br><span class="line">    <span class="comment"># 获取type种类首页分类商品的图片展示信息</span></span><br><span class="line">    image_banners = IndexTypeGoodsBanner.objects.filter(type=type, display_type=<span class="number">1</span>).order_by(<span class="string">'index'</span>)</span><br><span class="line">    <span class="comment"># 获取type种类首页分类商品的文字展示信息</span></span><br><span class="line">    title_banners = IndexTypeGoodsBanner.objects.filter(type=type, display_type=<span class="number">0</span>).order_by(<span class="string">'index'</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># 动态给type增加属性，分别保存首页分类商品的图片展示信息和文字展示信息</span></span><br><span class="line">    type.image_banners = image_banners</span><br><span class="line">    type.title_banners = title_banners</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step5</strong> 获取用户购物车商品数量信息，这里先设置为0，表示默认没有</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190401094654924.png" alt></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cart_count = <span class="number">0</span>  <span class="comment"># 默认设置为0</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step6</strong> 构造上下文响应数据，并返回给模板文件</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">context = &#123;<span class="string">'types'</span>:types,</span><br><span class="line">           <span class="string">'goods_banners'</span>:goods_banners,</span><br><span class="line">           <span class="string">'promotion_banners'</span>:promotion_banners,</span><br><span class="line">           <span class="string">'cart_count'</span>:cart_count&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 使用模板</span></span><br><span class="line"><span class="keyword">return</span> render(request, <span class="string">'index.html'</span>, context</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step7</strong> 在index.html模板文件中，进行填坑数据处理，在for循环遍历是从1开始累加</li>
</ul>
<p><strong>商品种类</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"subnav fl"</span>&gt;</span></span><br><span class="line">    &#123;% for type in types %&#125;</span><br><span class="line">	<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#model0&#123;&#123; forloop.counter &#125;&#125;"</span> <span class="attr">class</span>=<span class="string">"&#123;&#123; type.logo &#125;&#125;"</span>&gt;</span>&#123;&#123; type.name &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">&#123;#	<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#model02"</span> <span class="attr">class</span>=<span class="string">"seafood"</span>&gt;</span>海鲜水产<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span>#&#125;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>幻灯片</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for banner in goods_banners %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span> &gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"&#123;&#123; banner.image.url &#125;&#125;"</span> <span class="attr">alt</span>=<span class="string">"幻灯片"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span>/li&gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<p><strong>促销活动</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for banner in promotion_banners %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;&#123; banner.url &#125;&#125;"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"&#123;&#123; banner.image.url &#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">&#123;#<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"&#123;% static 'images/adv02.jpg' %&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span>#&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<p><strong>分类商品</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"subnav fl"</span>&gt;</span></span><br><span class="line">    &#123;% for type in types %&#125;</span><br><span class="line">	<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#model0&#123;&#123; forloop.counter &#125;&#125;"</span> <span class="attr">class</span>=<span class="string">"&#123;&#123; type.logo &#125;&#125;"</span>&gt;</span>&#123;&#123; type.name &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">&#123;#	<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#model02"</span> <span class="attr">class</span>=<span class="string">"seafood"</span>&gt;</span>海鲜水产<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span>#&#125;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"slide fl"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"slide_pics"</span>&gt;</span></span><br><span class="line">        &#123;% for banner in goods_banners %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span> &gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"&#123;&#123; banner.image.url &#125;&#125;"</span> <span class="attr">alt</span>=<span class="string">"幻灯片"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span>/li&gt;</span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">&#123;#	    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span> &gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"../static/images/slide02.jpg"</span> <span class="attr">alt</span>=<span class="string">"幻灯片"</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span>#&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"prev"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"next"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"points"</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"adv fl"</span>&gt;</span></span><br><span class="line">    &#123;% for banner in promotion_banners %&#125;</span><br><span class="line">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;&#123; banner.url &#125;&#125;"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"&#123;&#123; banner.image.url &#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">&#123;#	<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"&#123;% static 'images/adv02.jpg' %&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span>#&#125;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step8</strong> 刷新首页<a href="http://127.0.0.1:8000/" target="_blank" rel="noopener">http://127.0.0.1:8000/</a>页面后，只显示了商品分类信息，幻灯片和商品促销以及分类商品均为空白，这是因为数据库中并没有数据，而显示了商品分类信息，是因为博主前面注册了商品类型模型类（GoodsType）并在django管理后台进行了商品类型的添加，所以数据库中df_goods_type表有数据</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190401121344409.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<p><img src="https://img-blog.csdnimg.cn/20190401122120549.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<p><fancybox><img src="https://img-blog.csdnimg.cn/2019040112191027.png" alt></fancybox></p>
<p>3.数据准备</p>
<ul>
<li><strong>step1</strong> 在df_goods/admin中注册模型类</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190401130939420.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<ul>
<li><p><strong>step2</strong> 进入<a href="http://127.0.0.1:8000/admin/django" target="_blank" rel="noopener">http://127.0.0.1:8000/admin/django</a>后台管理页面</p>
</li>
<li><p><strong>step3</strong> 点击商品SPU栏的增加，进行数据库df_goods表数据的添加，添加后进行保存即可</p>
</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190401131625709.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<ul>
<li><strong>step4</strong> 保存成功后进入商品SPU栏后，则显示添加后的数据</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190401132325960.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<ul>
<li><strong>step5</strong> 当添加商品SPU数据后，再对商品栏（df_goods_sku表）进行数据添加操作</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190401134252998.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<ul>
<li><strong>step6</strong> 点击保存，结果报错了，根据报错提示没有找到文件的位置，异常目录为tracker_client.py，说明tracker服务器没有找到，于是博主立马知道了，因为博主在写博客分为两个时间，一个是在家，另一个是在公司，即IP端不同，此时在django后台添加数据是在公司的IP网段下，而client.conf中的配置为家里的IP段配置，所以添加数据报错了</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190401140142794.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<ul>
<li><strong>step7</strong> 修改ubuntu中fdfs目录下的storage.conf，mod_fastdfs.conf以及windows项目中fdfs目录下的client.conf配置文件里面的tracker_server的ip为公司环境IP后，刷新提交页面，添加记录成功</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190401141542882.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<ul>
<li><strong>step8</strong> 添加操作都是体力活啊，这里就不一一进行演示了，博主花了大半会儿功夫将主页需要的数据添加完毕，添加6个表的数据</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190401185336372.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<ul>
<li><strong>step9</strong> 此时添加完主页必有的表字段数据后，刷新主页面</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190401193401295.gif" alt></fancybox></p>
<ul>
<li><strong>step10</strong> 在数据库中表示数相关的表数据</li>
<li><strong>说明</strong>：由于数据太多只截取前面两条数据</li>
</ul>
<p><strong>商品SPU</strong></p>
<p><img src="https://img-blog.csdnimg.cn/20190401194507114.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<p><strong>商品</strong></p>
<p><img src="https://img-blog.csdnimg.cn/20190401195013145.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<p><strong>商品种类</strong></p>
<p><img src="https://img-blog.csdnimg.cn/20190401195216397.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<p><strong>首页幻灯片商品</strong></p>
<p><img src="https://img-blog.csdnimg.cn/20190401195438397.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<p><strong>主页促销活动商品</strong></p>
<p><img src="https://img-blog.csdnimg.cn/20190401195746348.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<p><strong>主页分类展示商品</strong></p>
<p><img src="https://img-blog.csdnimg.cn/2019040120041563.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<p>4.首页获取购物车商品数目</p>
<ul>
<li><strong>step1</strong> 分析存储购物车记录</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1.什么时候添加购物车数目</span><br><span class="line">  当用户点击商品加入购物车时，需要添加购物车数目</span><br><span class="line">2.什么时候需要获取购物车记录</span><br><span class="line">  当用户使用购物车记录时和用户访问购物车页面数据时</span><br><span class="line">3.使用什么来数据库来存储购物车的记录</span><br><span class="line">  使用redis数据库进行存储，因为加入购物车是高频的</span><br><span class="line">4.以哪种数据格式进行存储</span><br><span class="line">  使用hash（属性：值的关系进行购物车数目的存储）</span><br><span class="line">  cart_用户id:&#123;&apos;sku_id1&apos;:商品数目，&apos;sku_id2&apos;:商品数目&#125;</span><br><span class="line">  例如：&apos;cart_1&apos;:&#123;&apos;1&apos;:4,&apos;2&apos;,8&#125;</span><br><span class="line">  在首页左上方显示的购物车显示的是hash数据中的元素总数，即2（商品id为1的和商品id为2的共两个），大多网站都是显示商品类总数，而不是商品量总数</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step2</strong> 在IndexView视图函数中获取用户购物车商品数目</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">user = request.user  <span class="comment"># 获取user对象</span></span><br><span class="line">cart_count = <span class="number">0</span>  <span class="comment"># 默认设置为0</span></span><br><span class="line"><span class="keyword">if</span> user.is_authenticated():  <span class="comment"># 如果返回True表示用户已登录</span></span><br><span class="line">    <span class="comment"># 用户已登录</span></span><br><span class="line">    conn = get_redis_connection(<span class="string">'default'</span>)  <span class="comment"># 获取配置中default默认redis连接对象</span></span><br><span class="line">    cart_key = <span class="string">'cart_%d'</span>%user.id  <span class="comment"># 设置key</span></span><br><span class="line">    <span class="comment"># 通过hlen方法获取购物车商品数目</span></span><br><span class="line">    cart_count = conn.hlen(cart_key)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step3</strong> 在父模板base.html文件中填写购物车数目的坑</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"goods_count fl"</span> <span class="attr">id</span>=<span class="string">"show_count"</span>&gt;</span>&#123;&#123; cart_count &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step4</strong> 刷新主页，因为还没有编写添加商品到购物车逻辑代码，所以cart_count为0，即在主页显示为0</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190402091905143.png" alt></fancybox></p>
<ul>
<li><strong>step5</strong> 登录cdtaogang_2账号（用户id=2），进入redis数据库，选择settings配置文件中配置的第五个数据库，然后使用hmset设置模拟数据 （’cart_2’:{‘1’:4,’2’:8}），使用hlen获取元素长度（个数）2，即购物车数目为2</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190402093520429.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<ul>
<li><strong>step6</strong> 此时刷新页面，成功显示购物车数目为2</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190402094140479.png" alt></fancybox></p>
<p><font style="color:red">5.将首页页面静态化，把原本动态的页面处理结果保存成html文件，让用户直接访问这个生成出来的静态的html页面</font></p>
<p><strong>说明</strong>：因为网站首页几乎是不变的，当首页需要更改修改数据时，才会发生变化，换句话说就是当后台管理员首页页面对应的数据时，才会生成新的首页静态页面，大多用户浏览网站都是看主页，当很多用户浏览主页时，不管登录与否页面显示的内容都是一样的，每次用户请求主页页面时，都会到数据库去查询数据，并且查询的数据都是一样的，所以将页面进行静态化后，就不用每次用户请求首页数据时都要到数据库进行查询数据，再返回给用户，这样做大大的对减少网站服务器的压力，还利于SEO的优化</p>
<ul>
<li><strong>step1</strong> 分析静态页面的实现</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.什么时候需要重新生成静态页面（用户未登录的主页页面）</span><br><span class="line">  当管理员在后台修改添加以及删除页面对应数据库表中的数据时需要重新生成新的静态页面</span><br><span class="line">2.如何生成</span><br><span class="line">使用celery，在tasks.py文件中异步生成首页静态页面</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step2</strong> 在tasks.py文件中定义一个任务函数</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.task</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_static_index_page</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""生成首页静态页面"""</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step3</strong> 获取首页页面上的数据，直接把IndexView类视图get方法中的代码拿过来，因为生成的首页静态页面是用户不登录状态，所以，不需要获取购物车的数目，也不需要返回HttpResponse对象</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">types = GoodsType.objects.all()</span><br><span class="line">goods_banners = IndexGoodsBanner.objects.all().order_by(<span class="string">'index'</span>)</span><br><span class="line">promotion_banners = IndexPromotionBanner.objects.all().order_by(<span class="string">'index'</span>)</span><br><span class="line"><span class="keyword">for</span> type <span class="keyword">in</span> types:</span><br><span class="line">    image_banners = IndexTypeGoodsBanner.objects.filter(type=type, display_type=<span class="number">1</span>).order_by(<span class="string">'index'</span>)</span><br><span class="line">    title_banners = IndexTypeGoodsBanner.objects.filter(type=type, display_type=<span class="number">0</span>).order_by(<span class="string">'index'</span>)</span><br><span class="line">    type.image_banners = image_banners</span><br><span class="line">    type.title_banners = title_banners</span><br><span class="line">context = &#123;<span class="string">'types'</span>: types,</span><br><span class="line">           <span class="string">'goods_banners'</span>: goods_banners,</span><br><span class="line">           <span class="string">'promotion_banners'</span>: promotion_banners&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step4</strong> 因为是显示用户未登录的首页静态页面，所以必须创建一个新的主页模板文件，创建首页静态页面继承的父模板文件static_base.html以及静态主页模板文件static_index.html，将base.html内容直接拷贝到static_base.html中，再将index.html中的内容全部拷贝到static_index.html中，修改static_index.html模板文件的继承模板文件为static_base.html，然后去除父模板文件static_base.html中的欢迎以及显示用户所在的标签，只留下登录和登出即可</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190402104006654.png" alt></fancybox></p>
<ul>
<li><strong>step5</strong> 使用loader方法加载模板文件，再通过模板对象中的render方法渲染出模板文件的内容，最后通过文件读写操作，将模板内容（static_index_html）写入到static目录下的index.html中</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.加载模板文件</span></span><br><span class="line">template = loader.get_template(<span class="string">"static_index.html"</span>)  <span class="comment"># 返回模板对象</span></span><br><span class="line"><span class="comment"># 2.渲染模板内容（数据填坑）</span></span><br><span class="line">static_index_html = template.render(context)</span><br><span class="line"><span class="comment"># 3.生成首页静态文件</span></span><br><span class="line">save_index_static_file = os.path.join(settings.BASE_DIR, <span class="string">'static/index.html'</span>)  <span class="comment"># 生成首页静态文件的路径</span></span><br><span class="line"><span class="keyword">with</span> open(save_index_static_file, <span class="string">"w"</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(static_index_html)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step6</strong> 在Terminal终端上新开一个终端，执行celery -A celery_tasks.tasks worker -l info 启动worker，结果报错了提示没有模块名，from df_goods.models import GoodsType, IndexGoodsBanner, IndexTypeGoodsBanner, IndexPromotionBanner导入模块报错，原因是在django配置环境没有初始化的时候，导入会报错，根本找不到，所以需要将这几个模型类放到django.setup()吃实话下面，这样就能找到，不会出现以下错误</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190402153343246.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<ul>
<li><strong>step7</strong> 重新执行celery -A celery_tasks.tasks worker -l info，启动2个worker成功</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190402154204275.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<ul>
<li><strong>step8</strong> 向worker发出任务，打开IDE下方的Python Console，导入任务函数generate_static_index_page，去调用delay方法，向worker发送任务成功</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190402155109799.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<ul>
<li><strong>step9</strong> 回到Terminal中查看celery 日志，显示任务执行成功，时长0.259秒</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190402155342578.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<ul>
<li><strong>step10</strong> 查看static目录是否生成了index.html文件</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190402155635800.png" alt></fancybox></p>
<ul>
<li><strong>step11</strong> 查看index.html文件内容，该内容已经是对templates/index.html模板进行填坑后的数据了</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/2019040216015266.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<ul>
<li><strong>step12</strong> 在浏览器中直接打开static/index.html静态页面，只显示出商品图片，也是所有填坑数据，所有的静态文件资源路径not found，无法找到</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190402163714931.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190402163447634.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<p><font style="color:red">6.配置nginx服务器，让nginx服务器来提交静态页面</font></p>
<ul>
<li><strong>step1</strong> 首先想要nginx服务器提交静态页面，那么就需要在nginx所在的服务器中有项目文件，所以拷贝项目到nginx服务器（Ubuntu）桌面上</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190402164414656.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<ul>
<li><strong>step2</strong> 其次是添加nginx服务器server配置，添加如下配置<br><font style="color:red"><strong>说明</strong>：listen 监听80端口，也就是nginx的默认端口号</font></li>
</ul>
<p><font style="color:red">/static表示 访问请求地址为 nginx服务器IP:listen/static（192.168.4.63:80/static）alias指定文件路径为ubuntu中项目下的static目录，顺便说一下alisa配置端只有location本地，从本地获取路径，而root配置端为http、server、location、if</font></p>
<p><font style="color:red">/表示 访问请求地址为 nginx服务器IP:listen/static（192.168.4.63:80）root指定文件路径为ubuntu中项目下的static目录</font></p>
<p><font style="color:red">index 表示配置网页初始页，后面可以跟多个，会在root目录下去查找，找到匹配的就返回</font></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /usr/local/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure>

<p><font style="color:red">之所以配置/static和/这两种路径是因为生成的static目录下的index.html文件内容中，静态资源文件路径都是/static开头的，当在浏览器中输入<a href="http://192.168.4.63/（nginx服务器IP）" target="_blank" rel="noopener">http://192.168.4.63/（nginx服务器IP）</a> ，就会匹配location / 地址，然后就会将static目录下查找是否存在index.html或者是index.htm文件并且将查找到的文件返回给浏览器，浏览器在对index.html进行解析时，然后发现内容中的所有静态资源需要从192.168.4.63:80/static/xxxxx地址进行获取，匹配location /static地址然后就会从ubuntu桌面项目static目录下获取文件</font></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">        server_name  localhost;</span><br><span class="line">        #charset koi8-r;</span><br><span class="line">        #access_log  logs/host.access.log  main;</span><br><span class="line">        location /static &#123;</span><br><span class="line">            alias   /home/taogang/Desktop/dailyfresh/static/;</span><br><span class="line">        &#125;</span><br><span class="line">        location / &#123;</span><br><span class="line">            root   /home/taogang/Desktop/dailyfresh/static/;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">    error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step3</strong> 重启nginx服务</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/2019040217491480.png" alt></p>
<ul>
<li><strong>step4</strong> 在浏览器中输入<a href="http://192.168.4.63/成功显示出首页静态页面，**不输入端口号浏览器默认端口就是80" target="_blank" rel="noopener">http://192.168.4.63/成功显示出首页静态页面，**不输入端口号浏览器默认端口就是80</a>**</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190402175144374.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<ul>
<li><strong>step5</strong> 查看首页静态页面中静态资源访问地址，验证<strong>step2</strong>博主说的静态资源访问地址</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190402175325741.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<p>7.django后台管理更新首页数据时重新生成新的首页静态页面</p>
<ul>
<li><strong>step1</strong> <font style="color:red">在df_goods/admin中定义IndexPromotionBannerAdmin类，该类继承于admin.ModelAdmin，在这个类中重写父类的save_model方法以及delete_model方法用于django后台对表数据进行修改删除时，会调用我们重写父类的方法，在这两个方法中再调用父类的的save_model以及delete_model方法完成数据的更新操作，然后再向worker发出任务，重新从数据库中获取修改后的数据，读写templates目录下已经更新数据后的index.html文件的内容写入到static下的index.html中，显示最新的主页静态页面</font></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexPromotionBannerAdmin</span><span class="params">(admin.ModelAdmin)</span>:</span></span><br><span class="line">    <span class="string">"""重写父类中的save_model方法，该方法在后台管理页面对数据修改时时会调用此方法"""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">save_model</span><span class="params">(self, request, obj, form, change)</span>:</span></span><br><span class="line">        <span class="comment"># 调用父类中国的save_model方法让数据完成更新</span></span><br><span class="line">        super(IndexPromotionBannerAdmin, self).save_model(request,obj,form,change)</span><br><span class="line">        <span class="comment"># 向worker发出任务，重新生成更新数据后的页面</span></span><br><span class="line">        <span class="keyword">from</span> celery_tasks.tasks <span class="keyword">import</span> generate_static_index_page</span><br><span class="line">        generate_static_index_page.delay()</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete_model</span><span class="params">(self, request, obj)</span>:</span></span><br><span class="line">        <span class="string">"""对数据进行删除时会调用"""</span></span><br><span class="line">        super(IndexPromotionBannerAdmin, self).delete_model(request, obj)</span><br><span class="line">        <span class="comment"># 向worker发出任务，重新生成更新数据后的页面</span></span><br><span class="line">        <span class="keyword">from</span> celery_tasks.tasks <span class="keyword">import</span> generate_static_index_page</span><br><span class="line">        generate_static_index_page.delay(</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># 注册首页促销活动模型类</span></span><br><span class="line">admin.site.register(IndexPromotionBanner, IndexPromotionBannerAdmin)  <span class="comment"># 将管理类添加进去</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step2</strong> 因为首页静态页面是从nginx服务器中（ubuntu）本地项目static目录下的index.html，所以在windows项目这边需要将tasks.py文件中broker设置为nginx服务器的中的redis数据库作为中间人</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app = Celery(<span class="string">"celery_tasks.tasks"</span>, broker=<span class="string">"redis://192.168.1.8:6379/4"</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step3</strong> 在ubuntu中配置redis可任意ip连接，注释掉bind即可</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190403015303206.png" alt></p>
<ul>
<li><strong>step4</strong> 测试在windows电脑上远程ubuntu电脑上的redis数据库</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190403015503467.png" alt></p>
<ul>
<li><strong>step5</strong> 在nginx服务器中（ubuntu）中启动worker</li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190403015706813.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<ul>
<li><strong>step6</strong> 然后在django后台修改数据，点击保存时即worker显示接收到任务，最后访问192.168.1.8（nginx服务器IP），查看静态页面是否更新，博主这里就修改主页中促销商品的显示顺序，index展示顺序</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190403015804937.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<ul>
<li><strong>step7</strong> 刷新主页静态页面<a href="http://192.168.1.8/" target="_blank" rel="noopener">http://192.168.1.8/</a>，结果页面没人任何数据，原因是在ubuntu中的项目配置的mysql数据库为本地，所以没说任何数据，之前在django管理页面添加数据为windows本地项目，所以需要在windows msyql中新建个用户用于ubuntu项目中进行访问数据，需要注意的是windows关闭防火墙</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grant all privileges on dailyfresh.* to &quot;taogang&quot;@&quot;%&quot; identified by &quot;123456&quot;</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/20190403030703374.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<ul>
<li><strong>step8</strong> 修改ubuntu项目中的settings配置文件mysql项</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190403030950547.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<ul>
<li><strong>step9</strong> 重新刷新<a href="http://192.168.1.8/主页静态页面后，成功显示出数据" target="_blank" rel="noopener">http://192.168.1.8/主页静态页面后，成功显示出数据</a></li>
</ul>
<p><fancybox><img src="https://img-blog.csdnimg.cn/20190403031242615.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></fancybox></p>
<ul>
<li><strong>step10</strong> 修改IndexPromotionBannerAdmin类为BaseModelAdmin，并定义其他模型管理类，继承于BaseModelAdmin，当管理员在后台对其他表数据进行修改时也同样调用我们重写的方法对数据进行更新，然后向worker发出任务，完成首页静态页面数据的更新</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseModelAdmin</span><span class="params">(admin.ModelAdmin)</span>:</span></span><br><span class="line">    <span class="string">"""重写父类中的save_model方法，该方法在后台管理页面对数据修改时时会调用此方法"""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">save_model</span><span class="params">(self, request, obj, form, change)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"11111111111"</span></span><br><span class="line">        <span class="comment"># 调用父类中国的save_model方法让数据完成更新</span></span><br><span class="line">        super(BaseModelAdmin, self).save_model(request,obj,form,change)</span><br><span class="line">        <span class="comment"># 向worker发出任务，重新生成更新数据后的页面</span></span><br><span class="line">        <span class="keyword">from</span> celery_tasks.tasks <span class="keyword">import</span> generate_static_index_page</span><br><span class="line">        generate_static_index_page.delay()</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete_model</span><span class="params">(self, request, obj)</span>:</span></span><br><span class="line">        <span class="string">"""对数据进行删除时会调用"""</span></span><br><span class="line">        super(BaseModelAdmin, self).delete_model(request, obj)</span><br><span class="line">        <span class="comment"># 向worker发出任务，重新生成更新数据后的页面</span></span><br><span class="line">        <span class="keyword">from</span> celery_tasks.tasks <span class="keyword">import</span> generate_static_index_page</span><br><span class="line">        generate_static_index_page.delay()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GoodsTypeAdmin</span><span class="params">(BaseModelAdmin)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GoodsSKUAdmin</span><span class="params">(BaseModelAdmin)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GoodsAdmin</span><span class="params">(BaseModelAdmin)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexGoodsBannerAdmin</span><span class="params">(BaseModelAdmin)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexPromotionBannerAdmin</span><span class="params">(BaseModelAdmin)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexTypeGoodsBannerAdmin</span><span class="params">(BaseModelAdmin)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="comment"># 注册商品类型模型类</span></span><br><span class="line">admin.site.register(GoodsType, GoodsTypeAdmin)</span><br><span class="line"><span class="comment"># 注册商品SKU模型类</span></span><br><span class="line">admin.site.register(GoodsSKU, GoodsSKUAdmin)</span><br><span class="line"><span class="comment"># 注册商品SPU模型类</span></span><br><span class="line">admin.site.register(Goods, GoodsAdmin)</span><br><span class="line"><span class="comment"># 注册首页幻灯片展示模型类</span></span><br><span class="line">admin.site.register(IndexGoodsBanner, IndexGoodsBannerAdmin)</span><br><span class="line"><span class="comment"># 注册首页促销活动模型类</span></span><br><span class="line">admin.site.register(IndexPromotionBanner, IndexPromotionBannerAdmin)</span><br><span class="line"><span class="comment"># 注册分类商品展示模型类</span></span><br><span class="line">admin.site.register(IndexTypeGoodsBanner, IndexTypeGoodsBannerAdmin)</span><br></pre></td></tr></table></figure>

<p><font style="color:red">8.关于静态页面与django类视图IndexView调度说明</font></p>
<ul>
<li><strong>step1</strong> <font style="color:red">前面所有的访问操作都是192.168.1.8（主页静态页面，通过Ubuntu nginx服务器返回）以及127.0.0.1:8000（主页动态页面，通过windows django服务器返回），即问题是当用户访问时网站主页时，怎么区分给用户访问静态主页还是动态主页且用户只能输入一个IP地址，不可能一个网站有两个域名IP吧，所以我们设定用户请求的网站地址为192.168.1.8，当用户直接在浏览器中输入<a href="http://192.168.1.8/时，就相当于访问" target="_blank" rel="noopener">http://192.168.1.8/时，就相当于访问</a> /  就向ngin服务器获取静态主页，当用户输入<a href="http://192.168.1.8/index时，就想当于访问" target="_blank" rel="noopener">http://192.168.1.8/index时，就想当于访问</a> /index 就向django服务器获取类视图中返回的动态主面，因此就可以来判断用户请求的是静态主页还是动态主页，那么为了完成用户请求地址的判断，则需要使用调度服务器（另一个nginx服务器作为请求地址的调度）</font>，示意图如下</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/201904031549048.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<ul>
<li><strong>step2</strong> 修改IndexView的url路由</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url(<span class="string">r"^/index$"</span>, IndexView.as_view(), name=<span class="string">"index"</span>),  <span class="comment"># 首页</span></span><br></pre></td></tr></table></figure>

<p>9.<font style="color:red">设置以及获取首页的缓存数据</font></p>
<ul>
<li><strong>step1</strong> 分析</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.把首页用到的数据存放到缓存中</span><br><span class="line">2.当用户请求首页页面数据时，就到redis数据中获取缓存数据</span><br><span class="line">3.如果数据获取不到时，再去数据进行查询，这样做就减少了数据库的查询操作</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step2</strong> 在IndexView视图函数中先去获取获取缓存数据，当返回的数据为空时， 则对数据库进行查询操作，并设置缓存数据</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request)</span>:</span></span><br><span class="line">    <span class="string">'''显示首页'''</span></span><br><span class="line">    <span class="comment"># 先从缓存中获取主页数据</span></span><br><span class="line">    context = cache.get(<span class="string">"index_page_data"</span>)</span><br><span class="line">    <span class="keyword">if</span> context <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="string">"""缓存中没有数据就去数据库查询获取并设置"""</span></span><br><span class="line">        print(<span class="string">"设置主页缓存数据"</span>)</span><br><span class="line">        <span class="comment"># 获取商品的种类信息</span></span><br><span class="line">        types = GoodsType.objects.all()</span><br><span class="line"> </span><br><span class="line">        <span class="comment"># 获取首页轮播商品信息</span></span><br><span class="line">        goods_banners = IndexGoodsBanner.objects.all().order_by(<span class="string">'index'</span>)</span><br><span class="line"> </span><br><span class="line">        <span class="comment"># 获取首页促销活动信息</span></span><br><span class="line">        promotion_banners = IndexPromotionBanner.objects.all().order_by(<span class="string">'index'</span>)</span><br><span class="line"> </span><br><span class="line">        <span class="comment"># 获取首页分类商品展示信息</span></span><br><span class="line">        <span class="keyword">for</span> type <span class="keyword">in</span> types: <span class="comment"># GoodsType</span></span><br><span class="line">            <span class="comment"># 获取type种类首页分类商品的图片展示信息</span></span><br><span class="line">            image_banners = IndexTypeGoodsBanner.objects.filter(type=type, display_type=<span class="number">1</span>).order_by(<span class="string">'index'</span>)</span><br><span class="line">            <span class="comment"># 获取type种类首页分类商品的文字展示信息</span></span><br><span class="line">            title_banners = IndexTypeGoodsBanner.objects.filter(type=type, display_type=<span class="number">0</span>).order_by(<span class="string">'index'</span>)</span><br><span class="line"> </span><br><span class="line">            <span class="comment"># 动态给type增加属性，分别保存首页分类商品的图片展示信息和文字展示信息</span></span><br><span class="line">            type.image_banners = image_banners</span><br><span class="line">            type.title_banners = title_banners</span><br><span class="line"> </span><br><span class="line">        context = &#123;<span class="string">'types'</span>: types,</span><br><span class="line">                   <span class="string">'goods_banners'</span>: goods_banners,</span><br><span class="line">                   <span class="string">'promotion_banners'</span>: promotion_banners&#125;</span><br><span class="line"> </span><br><span class="line">        <span class="comment"># 设置首页数据的缓存</span></span><br><span class="line">        cache.set(<span class="string">"index_page_data"</span>, context, <span class="number">3600</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step3</strong> 使用字段对象中的update方法，向content字段中设置购物车，这个方法是当字典中有这个cart_count键时，则不进行修改，没有这个键则进行添加操作</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">context.update(cart_count=cart_count)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step4</strong> 当第一次访问<a href="http://127.0.0.1:8000/index" target="_blank" rel="noopener">http://127.0.0.1:8000/index</a>主页页面时，查看django服务运行日志，成功打印出设置主页缓存数据，第二次访问则没有打印</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190403162723136.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<ul>
<li><strong>step5</strong> 查看redis数据</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20190403162931800.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzgyNDI1,size_16,color_FFFFFF,t_70" alt></p>
<p>10.更新首页缓存数据</p>
<ul>
<li><strong>step1</strong> 分析</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">什么时候需要更新首页中的缓存数据</span><br><span class="line">当后台管理员对主页表数据进行修改时，需要更新主页缓存数据</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>step2</strong> 在df_goods/admin中BaseModelAdmin中，进行缓存数据的清除</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 清除缓存数据</span></span><br><span class="line">cache.delete(<span class="string">"index_page_data"</span>)</span><br></pre></td></tr></table></figure>

<br>

<p>————————————————<br>版权声明：本文为CSDN博主「cdtaogang」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。<br>原文链接：<a href="https://blog.csdn.net/qq_41782425/article/details/88921322" target="_blank" rel="noopener">https://blog.csdn.net/qq_41782425/article/details/88921322</a></p>

      </div>
      
        <br>
        


  <section class='meta' id="footer-meta">
    <div class='new-meta-box'>
      
        
          <div class="new-meta-item date" itemprop="dateUpdated" datetime="2019-11-13T22:21:20+08:00">
  <a class='notlink'>
    <i class="fas fa-clock" aria-hidden="true"></i>
    <p>更新于 2019年11月13日</p>
  </a>
</div>

        
      
        
          
  
  <div class="new-meta-item meta-tags"><a class="tag" href="/tags/Python/" rel="nofollow"><i class="fas fa-tag" aria-hidden="true"></i><p>Python</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/Django/" rel="nofollow"><i class="fas fa-tag" aria-hidden="true"></i><p>Django</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/Django网站实战/" rel="nofollow"><i class="fas fa-tag" aria-hidden="true"></i><p>Django网站实战</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/Python-Web开发/" rel="nofollow"><i class="fas fa-tag" aria-hidden="true"></i><p>Python Web开发</p></a></div>


        
      
        
          
  <div class="new-meta-item share -mob-share-list">
  <div class="-mob-share-list share-body">
    
      
        <a class="-mob-share-qq" title="QQ好友" rel="external nofollow noopener noreferrer"
          
          href="http://connect.qq.com/widget/shareqq/index.html?url=https://hellotaogang.github.io/2019/11/07/Django项目之Web端电商网站的实战开发（四）/&title=Django项目之Web端电商网站的实战开发（四） | TG'S BLOG&summary=该篇文章是博主一字一码编写的，实属不易，请尊重原创，谢谢大家！温馨提示：需要项目源码的朋友，请添加博主微信进行获取！
&nbsp;&nbsp;本文目录
一丶Windows环境下安装FastDFS_Client
二丶Django二次开发对接FastDFS
三丶天天生鲜首页"
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/assets@19.1.9/logo/128/qq.png">
          
        </a>
      
    
      
        <a class="-mob-share-qzone" title="QQ空间" rel="external nofollow noopener noreferrer"
          
          href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://hellotaogang.github.io/2019/11/07/Django项目之Web端电商网站的实战开发（四）/&title=Django项目之Web端电商网站的实战开发（四） | TG'S BLOG&summary=该篇文章是博主一字一码编写的，实属不易，请尊重原创，谢谢大家！温馨提示：需要项目源码的朋友，请添加博主微信进行获取！
&nbsp;&nbsp;本文目录
一丶Windows环境下安装FastDFS_Client
二丶Django二次开发对接FastDFS
三丶天天生鲜首页"
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/assets@19.1.9/logo/128/qzone.png">
          
        </a>
      
    
      
        <a class='qrcode' rel="external nofollow noopener noreferrer" href='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQ4AAAEOCAAAAABd2qZ5AAAD9ElEQVR42u3aO5KjQBAFQN3/0lpbMQt6r6qZGCOxFFILmsQo6vN6xcf79vi55upf+dny/dx/83riwIEDBw4cR2/1autXl79fmf86464fAA4cOHDgOMRxfxtJAMsDZ0JwHzjzM7SPCgcOHDhw/D7Hfe5zv938nPkVk8CPAwcOHDj+Msc7Pq4gZtW5za3iwIEDB47f50huaZPC5aW9PKmbXf1YrRQHDhw4cHTxri4U/uXPj8x34MCBAweOODjNUrLk+1mgzUuH78WBAwcOHDj2HKcaPG2pcRb72lJge184cODAgeMUR16SmxXyWqA8kG9eFIaZKw4cOHDguOVo07A8jCUNp/zXNmznCd7Hehw4cODAseaYDRa0wa9ImYKr7IuJXx4tDhw4cOA4xNGmc7M0LA/bybU2owxfJgdx4MCBA8ei4VQEofWaTbBs63h1yMeBAwcOHIc4ZmlPPu6Qf5MH1zwA59/gwIEDB45THEm6tRmVm81ZbAYj2iTzowuHAwcOHDgWHHmKtU/SZjeTF/jur5undjhw4MCBY8PRls/yJtNstC5ZmR9tERMHDhw4cDzBkYTJ/F/JiENy5s3oQ1G4xIEDBw4ca479KMCpLeYhdtZ2Sh4MDhw4cOA4xVEseu7ywdnyxzBL83DgwIEDx54jT5nyUNq2lzaJX/tCMOxi4cCBAweOsneT3MCsFZQDtUXA9oWguBYOHDhw4Fhw7ANti1hM8I2KmJvz48CBAweOPcemhNemYXnAbhtUm53jwIEDB46zHLPBuPuwlydvs7G5tkyZ7xkHDhw4cJzi2BT1NsFy1mQ6tYf/rMSBAwcOHGuOtsSWh+c8cp0tMrY3HyVyOHDgwIEj5pj9LU/2zhbykgA8A8WBAwcOHGc58uRn1kxKttUOT7SlyQgUBw4cOHCsOTbt/4SjDc95M2mT2q0gcODAgQPH7XWTROtsKXAW1NthiDaof7x34MCBAweOxzjaZCwfI8gfwGxUIjnPK++G4cCBAweOkqNNmfatozwkJwleXnz8shMcOHDgwHGIIzl18uueoE0jZ2G+KA7iwIEDB44Rxz405kXAJwL5sfU4cODAgePQ+qSRk5f8EoLNpp+Y17h8+8CBAwcOHCXHuzxmydus6bU5w+xFAQcOHDhw7Dk2TaOELKds20V5CvpIeMaBAwcOHLccs+DaNpPaQDi71TbQ1k8eBw4cOHC0lcLRJfPztxG+LUQO66M4cODAgePPcOyHDIpRtiDZaxO/YsoDBw4cOHA8xjFbnxQQ8zV5uG1fBXDgwIEDxymONlzlsWnDMSs7blpZOHDgwIFjzzErpbVNnRlE3tzKBy/2CSoOHDhw4LjYzz/nQHvuJADOpgAAAABJRU5ErkJggg=='>
        
          <img src="https://cdn.jsdelivr.net/gh/xaoxuu/assets@19.1.9/logo/128/wechat.png">
        
        </a>
      
    
      
        <a class="-mob-share-weibo" title="微博" rel="external nofollow noopener noreferrer"
          
          href="http://service.weibo.com/share/share.php?url=https://hellotaogang.github.io/2019/11/07/Django项目之Web端电商网站的实战开发（四）/&title=Django项目之Web端电商网站的实战开发（四） | TG'S BLOG&summary=该篇文章是博主一字一码编写的，实属不易，请尊重原创，谢谢大家！温馨提示：需要项目源码的朋友，请添加博主微信进行获取！
&nbsp;&nbsp;本文目录
一丶Windows环境下安装FastDFS_Client
二丶Django二次开发对接FastDFS
三丶天天生鲜首页"
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/assets@19.1.9/logo/128/weibo.png">
          
        </a>
      
    
  </div>
</div>



        
      
    </div>
  </section>


      
      
          <div class="prev-next">
              
                  <section class="prev">
                      <span class="art-item-left">
                          <h6><i class="fas fa-chevron-left" aria-hidden="true"></i>&nbsp;上一页</h6>
                          <h4>
                              <a href="/2019/11/07/Django项目之Web端电商网站的实战开发（五）/" rel="prev" title="Django项目之Web端电商网站的实战开发（五）">
                                
                                    Django项目之Web端电商网站的实战开发（五）
                                
                              </a>
                          </h4>
                          
                              
                              <h6 class="tags">
                                  <a class="tag" href="/tags/Python/"><i class="fas fa-tag fa-fw" aria-hidden="true"></i> Python</a> <a class="tag" href="/tags/Django/"><i class="fas fa-tag fa-fw" aria-hidden="true"></i> Django</a> <a class="tag" href="/tags/Django网站实战/"><i class="fas fa-tag fa-fw" aria-hidden="true"></i> Django网站实战</a> <a class="tag" href="/tags/Python-Web开发/"><i class="fas fa-tag fa-fw" aria-hidden="true"></i> Python Web开发</a>
                              </h6>
                          
                      </span>
                  </section>
              
              
                  <section class="next">
                      <span class="art-item-right" aria-hidden="true">
                          <h6>下一页&nbsp;<i class="fas fa-chevron-right" aria-hidden="true"></i></h6>
                          <h4>
                              <a href="/2019/11/07/Django项目之Web端电商网站的实战开发（三）/" rel="prev" title="Django项目之Web端电商网站的实战开发（三）">
                                  
                                      Django项目之Web端电商网站的实战开发（三）
                                  
                              </a>
                          </h4>
                          
                              
                              <h6 class="tags">
                                  <a class="tag" href="/tags/Python/"><i class="fas fa-tag fa-fw" aria-hidden="true"></i> Python</a> <a class="tag" href="/tags/Django/"><i class="fas fa-tag fa-fw" aria-hidden="true"></i> Django</a> <a class="tag" href="/tags/Django网站实战/"><i class="fas fa-tag fa-fw" aria-hidden="true"></i> Django网站实战</a> <a class="tag" href="/tags/Python-Web开发/"><i class="fas fa-tag fa-fw" aria-hidden="true"></i> Python Web开发</a>
                              </h6>
                          
                      </span>
                  </section>
              
          </div>
      
    </section>
  </article>



  <!-- 显示推荐文章和评论 -->



  <article class="post white-box comments">
    <section class="article typo">
      <h4><i class="fas fa-comments fa-fw" aria-hidden="true"></i>&nbsp;评论</h4>
      
      
      
        <section id="comments">
          <div id="gitalk-container"></div>
        </section>
      
      
    </section>
  </article>






<!-- 根据页面mathjax变量决定是否加载MathJax数学公式js -->



  <script>
    window.subData = {
      title: 'Django项目之Web端电商网站的实战开发（四）',
      tools: true
    }
  </script>


</div>
<aside class='l_side'>
  
    
    
      
        
          
          
        
          
          
            
              
  <section class='widget toc-wrapper'>
    
<header class='pure'>
  <div><i class="fas fa-list fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;本文目录</div>
  
    <!-- <div class='wrapper'><a class="s-toc rightBtn" rel="external nofollow noopener noreferrer" href="javascript:void(0)"><i class="fas fa-thumbtack fa-fw"></i></a></div> -->
  
</header>

    <div class='content pure'>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#一丶Windows环境下安装FastDFS-Client"><span class="toc-text">一丶Windows环境下安装FastDFS_Client</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#二丶Django二次开发对接FastDFS"><span class="toc-text">二丶Django二次开发对接FastDFS</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#三丶天天生鲜首页"><span class="toc-text">三丶天天生鲜首页</span></a></li></ol>
    </div>
  </section>


            
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
      
    

  
</aside>

<footer id="footer" class="clearfix">
  
  
    <div class="social-wrapper">
      
        
          <a href="http://wpa.qq.com/msgrd?v=3&amp;uin=1126331350&amp;site=qq&amp;menu=yes"
            class="social fab fa-qq flat-btn flat-btn"
            target="_blank"
            rel="external nofollow noopener noreferrer">
          </a>
        
      
        
          <a href="https://cdn.jsdelivr.net/gh/Hellotaogang/cdn@4.4/about/wxhy.png"
            class="social fab fa-weixin flat-btn flat-btn"
            target="_blank"
            rel="external nofollow noopener noreferrer">
          </a>
        
      
        
          <a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=cdtaogang@163.com"
            class="social fas fa-envelope flat-btn"
            target="_blank"
            rel="external nofollow noopener noreferrer">
          </a>
        
      
        
          <a href="https://github.com/Hellotaogang"
            class="social fab fa-github flat-btn"
            target="_blank"
            rel="external nofollow noopener noreferrer">
          </a>
        
      
        
          <a href="https://blog.csdn.net/qq_41782425"
            class="social fab fa-cuttlefish flat-btn flat-btn"
            target="_blank"
            rel="external nofollow noopener noreferrer">
          </a>
        
      
    </div>
  
  <br>
  <div><p>Copyright <i class='far fa-copyright'></i> 2019-2020 <a style='color: #333333' href='https://www.cdtaogang.top/' target='_blank'>TG’BLOG</a>&nbsp;&nbsp;|&nbsp;&nbsp;<span id='timeDate'>载入天数…</span><span id='times'>载入时分秒…</span></p>
</div>
  <br>
  <div>
    <div class='github-badge'> <a style='color: #fff' href='https://hexo.io/'><span class='badge-subject'>框架</span><span class='badge-value bg-blue'>Hexo</span></a> </div> <div class='github-badge'> <a style='color: #fff' href='https://github.com/'><span class='badge-subject'>托管</span><span class='badge-value bg-brightgreen'>GitHub</span></a> </div> <div class='github-badge'> <a style='color: #fff' href='https://www.aliyun.com/'><span class='badge-subject'>域名</span><span class='badge-value bg-firebrick'>Aliyun</span></a> </div> <div class='github-badge'> <a style='color: #fff' href='https://www.jsdelivr.com/'><span class='badge-subject'>内容分发网络</span><span class='badge-value bg-orange'>jsDelivr</span></a> </div> <div class='github-badge'> <a style='color: #fff' href='https://996.icu/#/zh_CN'><span class='badge-subject'>链接</span><span class='badge-value bg-red'>996.ICU</span></a> </div> <div class='github-badge'> <a style='color: #fff' href='https://xaoxuu.com/wiki/material-x/'><span class='badge-subject'>主题</span><span class='badge-value bg-blue'>Material X</span></a> </div> <div class='github-badge'> <a style='color: #fff' href='https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh'><span class='badge-subject'>协议</span><span class='badge-value bg-pink'>BY-NC-SA 4.0</span></a> </div>
  </div>
<script>
    var now = new Date(); 
    function createtime() { 
        var grt= new Date("10/11/2019 21:38:00");//在此处修改你的建站时间
        now.setTime(now.getTime()+250); 
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days); 
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours); 
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum); 
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;} 
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum); 
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;} 
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 "; 
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒"; 
    } 
setInterval("createtime()",250);
</script>
</footer>
<script>setLoadingBarProgress(80);</script>



      <script>setLoadingBarProgress(60);</script>
    </div>
    <a class="s-top fas fa-arrow-up fa-fw" href='javascript:void(0)'></a>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>

  <script>
    var GOOGLE_CUSTOM_SEARCH_API_KEY = "";
    var GOOGLE_CUSTOM_SEARCH_ENGINE_ID = "";
    var ALGOLIA_API_KEY = "";
    var ALGOLIA_APP_ID = "";
    var ALGOLIA_INDEX_NAME = "";
    var AZURE_SERVICE_NAME = "";
    var AZURE_INDEX_NAME = "";
    var AZURE_QUERY_KEY = "";
    var BAIDU_API_ID = "";
    var SEARCH_SERVICE = "hexo" || "hexo";
    var ROOT = "/"||"/";
    if(!ROOT.endsWith('/'))ROOT += '/';
  </script>

<script src="//instant.page/1.2.2" type="module" integrity="sha384-2xV8M5griQmzyiY3CDqh1dn4z3llDVqZDqzjzcY+jCBCk/a5fXJmuZ/40JJAPeoU"></script>


  <script async src="https://cdn.jsdelivr.net/npm/scrollreveal@4.0.5/dist/scrollreveal.min.js"></script>
  <script type="text/javascript">
    $(function() {
      const $reveal = $('.reveal');
      if ($reveal.length === 0) return;
      const sr = ScrollReveal({ distance: 0 });
      sr.reveal('.reveal');
    });
  </script>


  <script src="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.js"></script>
  <script type="text/javascript">
    $(function() {
      Waves.attach('.flat-btn', ['waves-button']);
      Waves.attach('.float-btn', ['waves-button', 'waves-float']);
      Waves.attach('.float-btn-light', ['waves-button', 'waves-float', 'waves-light']);
      Waves.attach('.flat-box', ['waves-block']);
      Waves.attach('.float-box', ['waves-block', 'waves-float']);
      Waves.attach('.waves-image');
      Waves.init();
    });
  </script>


  <script async src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-busuanzi@2.3/js/busuanzi.pure.mini.js"></script>




  
  
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-backstretch/2.0.4/jquery.backstretch.min.js"></script>
    <script type="text/javascript">
      $(function(){
        if ('.cover') {
          $('.cover').backstretch(
          ["https://cdn.jsdelivr.net/gh/Hellotaogang/cdn@4.5.7/images/background_4.jpg", "https://cdn.jsdelivr.net/gh/Hellotaogang/cdn@4.5.7/images/background_5.jpg", "https://cdn.jsdelivr.net/gh/Hellotaogang/cdn@4.5.7/images/background_6.jpg"],
          {
            duration: "6000",
            fade: "2500"
          });
        } else {
          $.backstretch(
          ["https://cdn.jsdelivr.net/gh/Hellotaogang/cdn@4.5.7/images/background_4.jpg", "https://cdn.jsdelivr.net/gh/Hellotaogang/cdn@4.5.7/images/background_5.jpg", "https://cdn.jsdelivr.net/gh/Hellotaogang/cdn@4.5.7/images/background_6.jpg"],
          {
            duration: "6000",
            fade: "2500"
          });
        }
      });
    </script>
  







  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
  <script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js"></script>
  <script type="text/javascript">
    var gitalk = new Gitalk({
      clientID: "71020b6958cd6bbf65b7",
      clientSecret: "3cfeccd9125b8bac76f2bd8a7f6e30a601ae3a81",
      repo: "Hellotaogang.github.io",
      owner: "Hellotaogang",
      admin: "Hellotaogang",
      
        id: md5(location.pathname),      // Ensure uniqueness and length less than 50
      
      distractionFreeMode: false  // Facebook-like distraction free mode
    });
    gitalk.render('gitalk-container');
  </script>





  <script src="/js/app.js"></script>


  <script src="/js/search.js"></script>




<!-- 复制 -->
<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  let COPY_SUCCESS = "复制成功";
  let COPY_FAILURE = "复制失败";
  /*页面载入完成后，创建复制按钮*/
  !function (e, t, a) {
    /* code */
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '  <i class="fa fa-copy"></i><span>复制</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });

      clipboard.on('success', function(e) {
        //您可以加入成功提示
        console.info('Action:', e.action);
        console.info('Text:', e.text);
        console.info('Trigger:', e.trigger);
        success_prompt(COPY_SUCCESS);
        e.clearSelection();
      });
      clipboard.on('error', function(e) {
        //您可以加入失败提示
        console.error('Action:', e.action);
        console.error('Trigger:', e.trigger);
        fail_prompt(COPY_FAILURE);
      });
    }
    initCopyCode();

  }(window, document);

  /**
   * 弹出式提示框，默认1.5秒自动消失
   * @param message 提示信息
   * @param style 提示样式，有alert-success、alert-danger、alert-warning、alert-info
   * @param time 消失时间
   */
  var prompt = function (message, style, time)
  {
      style = (style === undefined) ? 'alert-success' : style;
      time = (time === undefined) ? 1500 : time*1000;
      $('<div>')
          .appendTo('body')
          .addClass('alert ' + style)
          .html(message)
          .show()
          .delay(time)
          .fadeOut();
  };

  // 成功提示
  var success_prompt = function(message, time)
  {
      prompt(message, 'alert-success', time);
  };

  // 失败提示
  var fail_prompt = function(message, time)
  {
      prompt(message, 'alert-danger', time);
  };

  // 提醒
  var warning_prompt = function(message, time)
  {
      prompt(message, 'alert-warning', time);
  };

  // 信息提示
  var info_prompt = function(message, time)
  {
      prompt(message, 'alert-info', time);
  };

</script>


<!-- fancybox -->
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
<script>
  let LAZY_LOAD_IMAGE = "";
  $(".article-entry").find("fancybox").find("img").each(function () {
      var element = document.createElement("a");
      $(element).attr("data-fancybox", "gallery");
      $(element).attr("href", $(this).attr("src"));
      /* 图片采用懒加载处理时,
       * 一般图片标签内会有个属性名来存放图片的真实地址，比如 data-original,
       * 那么此处将原本的属性名src替换为对应属性名data-original,
       * 修改如下
       */
       if (LAZY_LOAD_IMAGE) {
         $(element).attr("href", $(this).attr("data-original"));
       }
      $(this).wrap(element);
  });
</script>





  <script>setLoadingBarProgress(100);</script>
  <!-- 页面点击小红心 -->
  <!-- <script type="text/javascript" src="/js/love.js"></script> -->
  <!--单击显示文字-->
  <!-- <script type="text/javascript" src="/js/click_show_text.js"></script> -->
  <!-- 鼠标点击烟花 -->
  <!-- <canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" ></canvas> 
  <script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script> 
  <script type="text/javascript" src="/js/fireworks.js"></script> -->
  <!--浏览器搞笑标题-->
  <script type="text/javascript" src="\js\FunnyTitle.js"></script>
  <!--动态线条背景-->
  <script type="text/javascript"
color="0,0,0" opacity='0.7' zIndex="-2" count="200" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js">
  </script>
  <!-- 样式一（鼠标点击更换样式） -->
<!-- <script src="https://g.joyinshare.com/hc/ribbon.min.js" type="text/javascript"></script> -->
<!-- 样式二（飘动的彩带） -->
<!-- <script src="https://g.joyinshare.com/hc/piao.js" type="text/javascript"></script> -->
  <!-- 数字雨 -->
  <!-- <canvas id="canvas" width="1440" height="900" ></canvas>
  <script type="text/javascript" src="/js/DigitalRain.js"></script> -->
</body>
</html>
